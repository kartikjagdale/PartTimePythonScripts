var _requirejs=requirejs;requirejs=void 0;var _require=require;require=void 0;var _define=define;define=void 0,function(){function n(a){return void 0!==a}function ba(){}function ca(a){a.Qb=function(){return a.ef?a.ef:a.ef=new a}}function da(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ea(a){return"array"==da(a)}function fa(a){var b=da(a);return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){return"string"==typeof a}function ga(a){return"number"==typeof a}function ha(a){return"function"==da(a)}function ia(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function ja(a){return a.call.apply(a.bind,arguments)}function ka(a,b){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function q(){return q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ja:ka,q.apply(null,arguments)}function la(a){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();return b.push.apply(b,arguments),a.apply(this,b)}}function na(a,b){function c(){}c.prototype=b.prototype,a.oc=b.prototype,a.prototype=new c,a.Ag=function(a,c){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}}function oa(a){if(a=String(a),/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a)}function pa(){this.Id=void 0}function qa(a,b,c){switch(typeof b){case"string":ra(b,c);break;case"number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case"boolean":c.push(b);break;case"undefined":c.push("null");break;case"object":if(null==b){c.push("null");break}if(ea(b)){var d=b.length;c.push("[");for(var e="",f=0;d>f;f++)c.push(e),e=b[f],qa(a,a.Id?a.Id.call(b,String(f),e):e,c),e=",";c.push("]");break}c.push("{"),d="";for(f in b)Object.prototype.hasOwnProperty.call(b,f)&&(e=b[f],"function"!=typeof e&&(c.push(d),ra(f,c),c.push(":"),qa(a,a.Id?a.Id.call(b,f,e):e,c),d=","));c.push("}");break;case"function":break;default:throw Error("Unknown type: "+typeof b)}}function ra(a,b){b.push('"',a.replace(ta,function(a){if(a in sa)return sa[a];var b=a.charCodeAt(0),e="\\u";return 16>b?e+="000":256>b?e+="00":4096>b&&(e+="0"),sa[a]=e+b.toString(16)}),'"')}function ua(a){return"undefined"!=typeof JSON&&n(JSON.parse)?JSON.parse(a):oa(a)}function t(a){if("undefined"!=typeof JSON&&n(JSON.stringify))a=JSON.stringify(a);else{var b=[];qa(new pa,a,b),a=b.join("")}return a}function u(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function v(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0}function va(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function wa(a){var b={};return va(a,function(a,d){b[a]=d}),b}function xa(a){this.xc=a,this.Hd="firebase:"}function ya(){this.ha={}}function za(a){try{if("undefined"!=typeof window&&"undefined"!=typeof window[a]){var b=window[a];return b.setItem("firebase:sentinel","cache"),b.removeItem("firebase:sentinel"),new xa(b)}}catch(c){}return new ya}function Ca(a,b,c,d,e){this.host=a.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.Cb=b,this.yb=c,this.yg=d,this.Gd=e||"",this.Ka=Aa.get("host:"+a)||this.host}function Da(a,b){b!==a.Ka&&(a.Ka=b,"s-"===a.Ka.substr(0,2)&&Aa.set("host:"+a.host,a.Ka))}function Ea(){this.Ta=-1}function Fa(){this.Ta=-1,this.Ta=64,this.R=[],this.be=[],this.Af=[],this.Dd=[],this.Dd[0]=128;for(var a=1;a<this.Ta;++a)this.Dd[a]=0;this.Rd=this.Tb=0,this.reset()}function Ga(a,b,c){c||(c=0);var d=a.Af;if(p(b))for(var e=0;16>e;e++)d[e]=b.charCodeAt(c)<<24|b.charCodeAt(c+1)<<16|b.charCodeAt(c+2)<<8|b.charCodeAt(c+3),c+=4;else for(e=0;16>e;e++)d[e]=b[c]<<24|b[c+1]<<16|b[c+2]<<8|b[c+3],c+=4;for(e=16;80>e;e++){var f=d[e-3]^d[e-8]^d[e-14]^d[e-16];d[e]=4294967295&(f<<1|f>>>31)}b=a.R[0],c=a.R[1];for(var m,g=a.R[2],k=a.R[3],l=a.R[4],e=0;80>e;e++)40>e?20>e?(f=k^c&(g^k),m=1518500249):(f=c^g^k,m=1859775393):60>e?(f=c&g|k&(c|g),m=2400959708):(f=c^g^k,m=3395469782),f=(b<<5|b>>>27)+f+l+m+d[e]&4294967295,l=k,k=g,g=4294967295&(c<<30|c>>>2),c=b,b=f;a.R[0]=a.R[0]+b&4294967295,a.R[1]=a.R[1]+c&4294967295,a.R[2]=a.R[2]+g&4294967295,a.R[3]=a.R[3]+k&4294967295,a.R[4]=a.R[4]+l&4294967295}function Ha(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^ma()).toString(36)}function Oa(a,b){var c=Pa(a,b,void 0);return 0>c?null:p(a)?a.charAt(c):a[c]}function Pa(a,b,c){for(var d=a.length,e=p(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Qa(a,b){var c=Ia(a,b);c>=0&&w.splice.call(a,c,1)}function Ra(a){return w.splice.apply(a,Sa(arguments,1))}function Sa(a,b,c){return 2>=arguments.length?w.slice.call(a,b):w.slice.call(a,b,c)}function Ta(a,b){a.sort(b||Ua)}function Ua(a,b){return a>b?1:b>a?-1:0}function Ya(a){return-1!=Va.indexOf(a)}function fb(a,b){if(!fa(a))throw Error("encodeByteArray takes an array as a parameter");gb();for(var c=b?db:cb,d=[],e=0;e<a.length;e+=3){var f=a[e],g=e+1<a.length,k=g?a[e+1]:0,l=e+2<a.length,m=l?a[e+2]:0,r=f>>2,f=(3&f)<<4|k>>4,k=(15&k)<<2|m>>6,m=63&m;l||(m=64,g||(k=64)),d.push(c[r],c[f],c[k],c[m])}return d.join("")}function gb(){if(!cb){cb={},db={},eb={};for(var a=0;65>a;a++)cb[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a),db[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(a),eb[db[a]]=a}}function x(a,b){if(!a)throw ib(b)}function ib(a){return Error("Firebase INTERNAL ASSERT FAILED:"+a)}function jb(a){try{var b;if("undefined"!=typeof atob)b=atob(a);else{gb();for(var c=eb,d=[],e=0;e<a.length;){var f=c[a.charAt(e++)],g=e<a.length?c[a.charAt(e)]:0;++e;var k=e<a.length?c[a.charAt(e)]:64;++e;var l=e<a.length?c[a.charAt(e)]:64;if(++e,null==f||null==g||null==k||null==l)throw Error();d.push(f<<2|g>>4),64!=k&&(d.push(g<<4&240|k>>2),64!=l&&d.push(k<<6&192|l))}if(8192>d.length)b=String.fromCharCode.apply(null,d);else{for(a="",c=0;c<d.length;c+=8192)a+=String.fromCharCode.apply(null,Sa(d,c,c+8192));b=a}}return b}catch(m){kb("base64Decode failed: ",m)}return null}function lb(a){var b=mb(a);a=new Fa,a.update(b);var b=[],c=8*a.Rd;56>a.Tb?a.update(a.Dd,56-a.Tb):a.update(a.Dd,a.Ta-(a.Tb-56));for(var d=a.Ta-1;d>=56;d--)a.be[d]=255&c,c/=256;for(Ga(a,a.be),d=c=0;5>d;d++)for(var e=24;e>=0;e-=8)b[c]=a.R[d]>>e&255,++c;return fb(b)}function nb(){for(var b="",c=0;c<arguments.length;c++)b=fa(arguments[c])?b+nb.apply(null,arguments[c]):"object"==typeof arguments[c]?b+t(arguments[c]):b+arguments[c],b+=" ";return b}function kb(){if(!0===pb&&(pb=!1,null===ob&&!0===Ba.get("logging_enabled")&&qb(!0)),ob){var b=nb.apply(null,arguments);ob(b)}}function rb(a){return function(){kb(a,arguments)}}function sb(){if("undefined"!=typeof console){var b="FIREBASE INTERNAL ERROR: "+nb.apply(null,arguments);"undefined"!=typeof console.error?console.error(b):console.log(b)}}function tb(){var b=nb.apply(null,arguments);throw Error("FIREBASE FATAL ERROR: "+b)}function z(){if("undefined"!=typeof console){var b="FIREBASE WARNING: "+nb.apply(null,arguments);"undefined"!=typeof console.warn?console.warn(b):console.log(b)}}function ub(a){var b="",c="",d="",e=!0,f="https",g="";if(p(a)){var k=a.indexOf("//");k>=0&&(f=a.substring(0,k-1),a=a.substring(k+2)),k=a.indexOf("/"),-1===k&&(k=a.length),b=a.substring(0,k),a=a.substring(k+1);var l=b.split(".");if(3===l.length){for(k=l[2].indexOf(":"),e=k>=0?"https"===f||"wss"===f:!0,c=l[1],d=l[0],g="",a=("/"+a).split("/"),k=0;k<a.length;k++)if(0<a[k].length){l=a[k];try{l=decodeURIComponent(l.replace(/\+/g," "))}catch(m){}g+="/"+l}d=d.toLowerCase()}else 2===l.length&&(c=l[0])}return{host:b,domain:c,vg:d,Cb:e,scheme:f,Pc:g}}function vb(a){return ga(a)&&(a!=a||a==Number.POSITIVE_INFINITY||a==Number.NEGATIVE_INFINITY)}function wb(a){if("complete"===document.readyState)a();else{var b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}}function xb(a,b){if(a===b)return 0;if("[MIN_NAME]"===a||"[MAX_NAME]"===b)return-1;if("[MIN_NAME]"===b||"[MAX_NAME]"===a)return 1;var c=yb(a),d=yb(b);return null!==c?null!==d?0==c-d?a.length-b.length:c-d:-1:null!==d?1:b>a?-1:1}function zb(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+t(b))}function Ab(a){if("object"!=typeof a||null===a)return t(a);var c,b=[];for(c in a)b.push(c);b.sort(),c="{";for(var d=0;d<b.length;d++)0!==d&&(c+=","),c+=t(b[d]),c+=":",c+=Ab(a[b[d]]);return c+"}"}function Bb(a,b){if(a.length<=b)return[a];for(var c=[],d=0;d<a.length;d+=b)d+b>a?c.push(a.substring(d,a.length)):c.push(a.substring(d,d+b));return c}function Cb(a,b){if(ea(a))for(var c=0;c<a.length;++c)b(c,a[c]);else A(a,b)}function Db(a){x(!vb(a),"Invalid JSON number");var b,c,d,e;for(0===a?(d=c=0,b=-1/0===1/a?1:0):(b=0>a,a=Math.abs(a),a>=Math.pow(2,-1022)?(d=Math.min(Math.floor(Math.log(a)/Math.LN2),1023),c=d+1023,d=Math.round(a*Math.pow(2,52-d)-Math.pow(2,52))):(c=0,d=Math.round(a/Math.pow(2,-1074)))),e=[],a=52;a;a-=1)e.push(d%2?1:0),d=Math.floor(d/2);for(a=11;a;a-=1)e.push(c%2?1:0),c=Math.floor(c/2);for(e.push(b?1:0),e.reverse(),b=e.join(""),c="",a=0;64>a;a+=8)d=parseInt(b.substr(a,8),2).toString(16),1===d.length&&(d="0"+d),c+=d;return c.toLowerCase()}function yb(a){return Eb.test(a)&&(a=Number(a),a>=-2147483648&&2147483647>=a)?a:null}function Fb(a){try{a()}catch(b){setTimeout(function(){throw b},Math.floor(0))}}function B(a){if(ha(a)){var c=Array.prototype.slice.call(arguments,1).slice();Fb(function(){a.apply(null,c)})}}function Gb(a,b,c,d){this.me=b,this.Ld=c,this.Rc=d,this.nd=a}function Hb(a,b,c){this.me=a,this.error=b,this.path=c}function Ib(a,b,c){this.Kb=a,this.mb=b,this.vc=c||null}function Jb(a,b,c){this.ba=a,this.mb=b,this.vc=c}function mb(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);e>=55296&&56319>=e&&(e-=55296,d++,x(d<a.length,"Surrogate pair missing trail surrogate."),e=65536+(e<<10)+(a.charCodeAt(d)-56320)),128>e?b[c++]=e:(2048>e?b[c++]=e>>6|192:(65536>e?b[c++]=e>>12|224:(b[c++]=e>>18|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b}function D(a,b,c,d){var e;if(b>d?e="at least "+b:d>c&&(e=0===c?"none":"no more than "+c),e)throw Error(a+" failed: Was called with "+d+(1===d?" argument.":" arguments.")+" Expects "+e+".")}function E(a,b,c){var d="";switch(b){case 1:d=c?"first":"First";break;case 2:d=c?"second":"Second";break;case 3:d=c?"third":"Third";break;case 4:d=c?"fourth":"Fourth";break;default:throw Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return a=a+" failed: "+(d+" argument ")}function F(a,b,c,d){if((!d||n(c))&&!ha(c))throw Error(E(a,b,d)+"must be a valid function.")}function Nb(a,b,c){if(n(c)&&(!ia(c)||null===c))throw Error(E(a,b,!0)+"must be a valid context object.")}function Qb(a){return p(a)&&0!==a.length&&!Ob.test(a)}function Rb(a){return null===a||p(a)||ga(a)&&!vb(a)||ia(a)&&u(a,".sv")}function Sb(a,b,c){c&&!n(b)||Tb(E(a,1,c),b)}function Tb(a,b,c,d){if(c||(c=0),d=d||[],!n(b))throw Error(a+"contains undefined"+Ub(d));if(ha(b))throw Error(a+"contains a function"+Ub(d)+" with contents: "+b.toString());if(vb(b))throw Error(a+"contains "+b.toString()+Ub(d));if(c>1e3)throw new TypeError(a+"contains a cyclic object value ("+d.slice(0,100).join(".")+"...)");if(p(b)&&b.length>10485760/3&&10485760<mb(b).length)throw Error(a+"contains a string greater than 10485760 utf8 bytes"+Ub(d)+" ('"+b.substring(0,50)+"...')");if(ia(b))for(var e in b)if(u(b,e)){var f=b[e];if(".priority"!==e&&".value"!==e&&".sv"!==e&&!Qb(e))throw Error(a+" contains an invalid key ("+e+")"+Ub(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.push(e),Tb(a,f,c+1,d),d.pop()}}function Ub(a){return 0==a.length?"":" in property '"+a.join(".")+"'"}function Vb(a,b){if(!ia(b)||ea(b))throw Error(E(a,1,!1)+" must be an Object containing the children to replace.");Sb(a,b,!1)}function Wb(a,b,c){if(vb(c))throw Error(E(a,b,!1)+"is "+c.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Rb(c))throw Error(E(a,b,!1)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}function Xb(a,b,c){if(!c||n(b))switch(b){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw Error(E(a,1,c)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function Yb(a,b,c,d){if((!d||n(c))&&!Qb(c))throw Error(E(a,b,d)+'was an invalid key: "'+c+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Zb(a,b){if(!p(b)||0===b.length||Pb.test(b))throw Error(E(a,1,!1)+'was an invalid path: "'+b+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function $b(a,b){if(".info"===G(b))throw Error(a+" failed: Can't modify data under /.info/")}function ac(a,b){if(!p(b))throw Error(E(a,1,!1)+"must be a valid credential (a string).")}function bc(a,b,c){if(!p(c))throw Error(E(a,b,!1)+"must be a valid string.")}function cc(a,b,c,d){if(!(d&&!n(c)||ia(c)&&null!==c))throw Error(E(a,b,d)+"must be a valid object.")}function dc(a,b,c){if(!ia(b)||null===b||!u(b,c))throw Error(E(a,1,!1)+'must contain the key "'+c+'"');if(!p(v(b,c)))throw Error(E(a,1,!1)+'must contain the key "'+c+'" with type "string"')}function ec(a,b){return xb(a.name,b.name)}function fc(a,b){return xb(a,b)}function gc(){}function H(a){return q(a.compare,a)}function jc(a){this.Vb=a}function lc(){}function nc(){this.yc=this.na=this.nc=this.ga=this.ka=!1,this.xb=0,this.Hb="",this.Bc=null,this.Xb="",this.Ac=null,this.Ub="",this.m=L}function pc(a){return x(a.ga,"Only valid if start has been set"),a.Bc}function qc(a){return x(a.ga,"Only valid if start has been set"),a.nc?a.Xb:"[MIN_NAME]"}function rc(a){return x(a.na,"Only valid if end has been set"),a.Ac}function sc(a){return x(a.na,"Only valid if end has been set"),a.yc?a.Ub:"[MAX_NAME]"}function tc(a){return x(a.ka,"Only valid if limit has been set"),a.xb}function uc(a){var b=new nc;return b.ka=a.ka,b.xb=a.xb,b.ga=a.ga,b.Bc=a.Bc,b.nc=a.nc,b.Xb=a.Xb,b.na=a.na,b.Ac=a.Ac,b.yc=a.yc,b.Ub=a.Ub,b.m=a.m,b}function vc(a,b){var c=uc(a);return c.m=b,c}function wc(a){return!(a.ga||a.na||a.ka)}function M(a,b,c,d){this.g=a,this.path=b,this.w=c,this.dc=d}function xc(a){var b=null,c=null;if(a.ga&&(b=pc(a)),a.na&&(c=rc(a)),a.m===mc){if(a.ga){if("[MIN_NAME]"!=qc(a))throw Error("Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().");if(null!=b&&"string"!=typeof b)throw Error("Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.")}if(a.na){if("[MAX_NAME]"!=sc(a))throw Error("Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().");if(null!=c&&"string"!=typeof c)throw Error("Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.")}}else if(a.m===L){if(null!=b&&!Rb(b)||null!=c&&!Rb(c))throw Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(x(a.m instanceof jc,"unknown index type."),null!=b&&"object"==typeof b||null!=c&&"object"==typeof c)throw Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")}function yc(a){if(a.ga&&a.na&&a.ka&&(!a.ka||""===a.Hb))throw Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")}function zc(a,b){if(!0===a.dc)throw Error(b+": You can't combine multiple orderBy calls.")}function Dc(a){a=a.w;var b={};if(a.ga&&(b.sp=a.Bc,a.nc&&(b.sn=a.Xb)),a.na&&(b.ep=a.Ac,a.yc&&(b.en=a.Ub)),a.ka){b.l=a.xb;var c=a.Hb;""===c&&(c=a.ga?"l":"r"),b.vf=c}return a.m!==L&&(b.i=a.m.toString()),b}function Ac(a,b,c){var d={cancel:null,Ha:null};if(b&&c)d.cancel=b,F(a,3,d.cancel,!0),d.Ha=c,Nb(a,4,d.Ha);else if(b)if("object"==typeof b&&null!==b)d.Ha=b;else{if("function"!=typeof b)throw Error(E(a,3,!0)+" must either be a cancel callback or a context object.");d.cancel=b}return d}function P(a,b){if(1==arguments.length){this.n=a.split("/");for(var c=0,d=0;d<this.n.length;d++)0<this.n[d].length&&(this.n[c]=this.n[d],c++);this.n.length=c,this.aa=0}else this.n=a,this.aa=b}function G(a){return a.aa>=a.n.length?null:a.n[a.aa]}function Q(a){return a.n.length-a.aa}function R(a){var b=a.aa;return b<a.n.length&&b++,new P(a.n,b)}function T(a,b){var c=G(a);if(null===c)return b;if(c===G(b))return T(R(a),R(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function Ec(){this.children={},this.dd=0,this.value=null}function Fc(a,b,c){this.yd=a?a:"",this.Oc=b?b:null,this.D=c?c:new Ec}function Gc(a,b){for(var e,c=b instanceof P?b:new P(b),d=a;null!==(e=G(c));)d=new Fc(e,d,v(d.D.children,e)||new Ec),c=R(c);return d}function Hc(a,b){x("undefined"!=typeof b,"Cannot set value to undefined"),a.D.value=b,Ic(a)}function Jc(a,b,c,d){c&&!d&&b(a),a.ca(function(a){Jc(a,b,!0,d)}),c&&d&&b(a)}function Kc(a,b){for(var c=a.parent();null!==c&&!b(c);)c=c.parent()}function Ic(a){if(null!==a.Oc){var b=a.Oc,c=a.yd,d=a.e(),e=u(b.D.children,c);d&&e?(delete b.D.children[c],b.D.dd--,Ic(b)):d||e||(b.D.children[c]=a.D,b.D.dd++,Ic(b))}}function Lc(a,b){this.Ga=a,this.pa=b?b:Mc}function Nc(a,b){for(var c,d=a.pa,e=null;!d.e();){if(c=a.Ga(b,d.key),0===c){if(d.left.e())return e?e.key:null;for(d=d.left;!d.right.e();)d=d.right;return d.key}0>c?d=d.left:c>0&&(e=d,d=d.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}function Oc(a,b,c,d,e){for(this.qf=e||null,this.te=d,this.ac=[],e=1;!a.e();)if(e=b?c(a.key,b):1,d&&(e*=-1),0>e)a=this.te?a.left:a.right;else{if(0===e){this.ac.push(a);break}this.ac.push(a),a=this.te?a.right:a.left}}function U(a){if(0===a.ac.length)return null;var c,b=a.ac.pop();if(c=a.qf?a.qf(b.key,b.value):{key:b.key,value:b.value},a.te)for(b=b.left;!b.e();)a.ac.push(b),b=b.right;else for(b=b.right;!b.e();)a.ac.push(b),b=b.left;return c}function Pc(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:!0,this.left=null!=d?d:Mc,this.right=null!=e?e:Mc}function Qc(a){return a.left.e()?a:Qc(a.left)}function Sc(a){return a.left.e()?Mc:(a.left.$()||a.left.left.$()||(a=Tc(a)),a=a.W(null,null,null,Sc(a.left),null),Rc(a))}function Rc(a){return a.right.$()&&!a.left.$()&&(a=Wc(a)),a.left.$()&&a.left.left.$()&&(a=Uc(a)),a.left.$()&&a.right.$()&&(a=Vc(a)),a}function Tc(a){return a=Vc(a),a.right.left.$()&&(a=a.W(null,null,null,null,Uc(a.right)),a=Wc(a),a=Vc(a)),a}function Wc(a){return a.right.W(null,null,a.color,a.W(null,null,!0,null,a.right.left),null)}function Uc(a){return a.left.W(null,null,a.color,null,a.W(null,null,!0,a.left.right,null))}function Vc(a){return a.W(null,null,!a.color,a.left.W(null,null,!a.left.color,null,null),a.right.W(null,null,!a.right.color,null,null))}function Xc(){}function I(a,b){this.name=a,this.K=b}function Yc(a,b){return new I(a,b)}function Zc(a,b){this.A=a,x(null!==this.A,"LeafNode shouldn't be created with null value."),this.fa=b||K,$c(this.fa),this.wb=null}function dd(a,b){this.td=a,this.Wb=b}function ed(a,b,c){var d=fd(a.td,function(d,f){var g=v(a.Wb,f);if(x(g,"Missing index implementation for "+f),d===hc){if(g.se(b.K)){for(var k=[],l=c.Aa(Yc),m=U(l);m;)m.name!=b.name&&k.push(m),m=U(l);return k.push(b),gd(k,H(g))}return hc}return g=c.get(b.name),k=d,g&&(k=k.remove(new I(b.name,g))),k.Ja(b,b.K)});return new dd(d,a.Wb)}function hd(a,b,c){var d=fd(a.td,function(a){if(a===hc)return a;var d=c.get(b.name);return d?a.remove(new I(b.name,d)):a});return new dd(d,a.Wb)}function bd(a,b,c){this.j=a,(this.fa=b)&&$c(this.fa),this.sb=c,this.wb=null}function ld(a,b){var c;return c=(c=kd(a,b))?(c=c.Ic())&&c.name:a.j.Ic(),c?new I(c,a.j.get(c)):null}function md(a,b){var c;return c=(c=kd(a,b))?(c=c.Zb())&&c.name:a.j.Zb(),c?new I(c,a.j.get(c)):null}function kd(a,b){return b===mc?null:a.sb.get(b.toString())}function J(a,b){if(null===a)return K;var c=null;if("object"==typeof a&&".priority"in a?c=a[".priority"]:"undefined"!=typeof b&&(c=b),x(null===c||"string"==typeof c||"number"==typeof c||"object"==typeof c&&".sv"in c,"Invalid priority type found: "+typeof c),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new Zc(a,J(c));if(a instanceof Array){var d=K,e=a;return A(e,function(a,b){if(u(e,b)&&"."!==b.substring(0,1)){var c=J(a);(c.P()||!c.e())&&(d=d.I(b,c))}}),d.ib(J(c))}var f=[],g=!1,k=a;va(k,function(a){if("string"!=typeof a||"."!==a.substring(0,1)){var b=J(k[a]);b.e()||(g=g||!b.O().e(),f.push(new I(a,b)))}});var l=gd(f,ec,function(a){return a.name},fc);if(g){var m=gd(f,H(L));return new bd(l,J(c),new dd({".priority":m},{".priority":L}))}return new bd(l,J(c),id)}function qd(a){this.count=parseInt(Math.log(a+1)/pd,10),this.Ve=this.count-1,this.Jf=a+1&parseInt(Array(this.count+1).join("1"),2)}function rd(a){var b=!(a.Jf&1<<a.Ve);return a.Ve--,b}function gd(a,b,c,d){function e(b,d){var f=d-b;if(0==f)return null;if(1==f){var m=a[b],r=c?c(m):m;return new Pc(r,m.K,!1,null,null)}var m=parseInt(f/2,10)+b,f=e(b,m),s=e(m+1,d),m=a[m],r=c?c(m):m;return new Pc(r,m.K,!1,f,s)}a.sort(b);var f=function(b){function d(b,g){var k=r-b,s=r;r-=b;var s=e(k+1,s),k=a[k],y=c?c(k):k,s=new Pc(y,k.K,g,null,s);f?f.left=s:m=s,f=s}for(var f=null,m=null,r=a.length,s=0;s<b.count;++s){var y=rd(b),N=Math.pow(2,b.count-(s+1));y?d(N,!1):(d(N,!1),d(N,!0))}return m}(new qd(a.length));return null!==f?new Lc(d||b,f):new Lc(d||b)}function ad(a){return"number"==typeof a?"number:"+Db(a):"string:"+a}function $c(a){if(a.P()){var b=a.N();x("string"==typeof b||"number"==typeof b||"object"==typeof b&&u(b,".sv"),"Priority must be a string or number.")}else x(a===kc||a.e(),"priority of unexpected type.");x(a===kc||a.O().e(),"Priority nodes can't have a priority of their own.")}function sd(){bd.call(this,new Lc(fc),K,id)}function C(a,b,c){this.D=a,this.U=b,this.m=c}function td(a){x(ea(a)&&0<a.length,"Requires a non-empty array"),this.Bf=a,this.Gc={}}function ud(a,b){x(Oa(a.Bf,function(a){return a===b}),"Unknown event: "+b)}function vd(){td.call(this,["visible"]);var a,b;if("undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(b="visibilitychange",a="hidden"):"undefined"!=typeof document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):"undefined"!=typeof document.msHidden?(b="msvisibilitychange",a="msHidden"):"undefined"!=typeof document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.qc=!0,b){var c=this;document.addEventListener(b,function(){var b=!document[a];b!==c.qc&&(c.qc=b,c.Td("visible",b))},!1)}}function wd(){if(td.call(this,["online"]),this.Lc=!0,"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener){var a=this;window.addEventListener("online",function(){a.Lc||a.Td("online",!0),a.Lc=!0},!1),window.addEventListener("offline",function(){a.Lc&&a.Td("online",!1),a.Lc=!1},!1)}}function A(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function fd(a,b){var d,c={};for(d in a)c[d]=b.call(void 0,a[d],d,a);return c}function Mb(a,b){for(var c in a)if(!b.call(void 0,a[c],c,a))return!1;return!0}function Kb(a){var c,b=0;for(c in a)b++;return b}function Lb(a){for(var b in a)return b}function xd(a){var d,b=[],c=0;for(d in a)b[c++]=a[d];return b}function yd(a){var d,b=[],c=0;for(d in a)b[c++]=d;return b}function nd(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function zd(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d}function Ad(a,b){var c=zd(a,b,void 0);return c&&a[c]}function Bd(a){for(var b in a)return!1;return!0}function Cd(a,b){return b in a?a[b]:void 0}function od(a){var c,b={};for(c in a)b[c]=a[c];return b}function Ed(a){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Dd.length;f++)c=Dd[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Fd(){this.wc={}}function Gd(a,b,c){n(c)||(c=1),u(a.wc,b)||(a.wc[b]=0),a.wc[b]+=c}function Hd(a){this.Kf=a,this.vd=null}function Id(a,b){this.uf={},this.Nd=new Hd(a),this.S=b;var c=1e4+2e4*Math.random();setTimeout(q(this.nf,this),Math.floor(c))}function Ld(a){return a=a.toString(),Jd[a]||(Jd[a]=new Fd),Jd[a]}function Md(a,b){var c=a.toString();return Kd[c]||(Kd[c]=b()),Kd[c]}function Od(a,b,c){this.ie=a,this.f=rb(this.ie),this.frames=this.Cc=null,this.kb=this.lb=this.Oe=0,this.Qa=Ld(b),this.Za=(b.Cb?"wss://":"ws://")+b.Ka+"/.ws?v=5","undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(this.Za+="&r=f"),b.host!==b.Ka&&(this.Za=this.Za+"&ns="+b.yb),c&&(this.Za=this.Za+"&s="+c)}function Rd(a,b){if(a.frames.push(b),a.frames.length==a.Oe){var c=a.frames.join("");a.frames=null,c=ua(c),a.cg(c)}}function Qd(a){clearInterval(a.Cc),a.Cc=setInterval(function(){a.oa&&a.oa.send("0"),Qd(a)},Math.floor(45e3))}function Sd(a){this.cc=a,this.Fd=[],this.Mb=0,this.ge=-1,this.Ab=null}function Td(a,b,c){a.ge=b,a.Ab=c,a.ge<a.Mb&&(a.Ab(),a.Ab=null)}function Ud(a,b,c){for(a.Fd[b]=c;a.Fd[a.Mb];){var d=a.Fd[a.Mb];delete a.Fd[a.Mb];for(var e=0;e<d.length;++e)if(d[e]){var f=a;Fb(function(){f.cc(d[e])})}if(a.Mb===a.ge){a.Ab&&(clearTimeout(a.Ab),a.Ab(),a.Ab=null);break}a.Mb++}}function Vd(){this.set={}}function Wd(a,b){A(a.set,function(a,d){b(d,a)})}function Xd(a,b,c){this.ie=a,this.f=rb(a),this.kb=this.lb=0,this.Qa=Ld(b),this.Kd=c,this.zc=!1,this.bd=function(a){b.host!==b.Ka&&(a.ns=b.yb);var f,c=[];for(f in a)a.hasOwnProperty(f)&&c.push(f+"="+a[f]);return(b.Cb?"https://":"http://")+b.Ka+"/.lp?"+c.join("&")}}function ae(a,b){var c=t(b).length;a.kb+=c,Gd(a.Qa,"bytes_received",c)}function $d(a,b,c,d){if(this.bd=d,this.fb=c,this.Fe=new Vd,this.Qc=[],this.ke=Math.floor(1e8*Math.random()),this.Jd=!0,this.Ud=hb(),window["pLPCommand"+this.Ud]=a,window["pRTLPCB"+this.Ud]=b,a=document.createElement("iframe"),a.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(a);try{a.contentWindow.document||kb("No IE domain setting required")}catch(e){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}a.contentDocument?a.$a=a.contentDocument:a.contentWindow?a.$a=a.contentWindow.document:a.document&&(a.$a=a.document),this.va=a,a="",this.va.src&&"javascript:"===this.va.src.substr(0,11)&&(a='<script>document.domain="'+document.domain+'";</script>'),a="<html><body>"+a+"</body></html>";try{this.va.$a.open(),this.va.$a.write(a),this.va.$a.close()}catch(f){kb("frame writing exception"),f.stack&&kb(f.stack),kb(f)}}function ce(a){if(a.Zd&&a.Jd&&a.Fe.count()<(0<a.Qc.length?2:1)){a.ke++;var b={};b.id=a.Xf,b.pw=a.Yf,b.ser=a.ke;for(var b=a.bd(b),c="",d=0;0<a.Qc.length&&1870>=a.Qc[0].We.length+30+c.length;){var e=a.Qc.shift(),c=c+"&seg"+d+"="+e.og+"&ts"+d+"="+e.wg+"&d"+d+"="+e.We;d++}return de(a,b+c,a.ke),!0}return!1}function de(a,b,c){function d(){a.Fe.remove(c),ce(a)}a.Fe.add(c);var e=setTimeout(d,Math.floor(25e3));be(a,b,function(){clearTimeout(e),d()})}function be(a,b,c){setTimeout(function(){try{if(a.Jd){var d=a.va.$a.createElement("script");d.type="text/javascript",d.async=!0,d.src=b,d.onload=d.onreadystatechange=function(){var a=d.readyState;a&&"loaded"!==a&&"complete"!==a||(d.onload=d.onreadystatechange=null,d.parentNode&&d.parentNode.removeChild(d),c())},d.onerror=function(){kb("Long-poll script failed to load: "+b),a.Jd=!1,a.close()},a.va.$a.body.appendChild(d)}}catch(e){}},Math.floor(1))}function ee(a){fe(this,a)}function fe(a,b){var c=Od&&Od.isAvailable(),d=c&&!(Aa.ff||!0===Aa.get("previous_websocket_failure"));if(b.yg&&(c||z("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),d=!0),d)a.$c=[Od];else{var e=a.$c=[];Cb(ge,function(a,b){b&&b.isAvailable()&&e.push(b)})}}function he(a){if(0<a.$c.length)return a.$c[0];throw Error("No transports available")}function ie(a,b,c,d,e,f){this.id=a,this.f=rb("c:"+this.id+":"),this.cc=c,this.Kc=d,this.ea=e,this.De=f,this.Q=b,this.Ed=[],this.Se=0,this.xf=new ee(b),this.Pa=0,this.f("Connection created"),je(this)}function je(a){var b=he(a.xf);a.J=new b("c:"+a.id+":"+a.Se++,a.Q),a.He=b.responsesRequiredToBeHealthy||0;var c=ke(a,a.J),d=le(a,a.J);a.ad=a.J,a.Xc=a.J,a.C=null,a.vb=!1,setTimeout(function(){a.J&&a.J.open(c,d)},Math.floor(0)),b=b.healthyTimeout||0,b>0&&(a.rd=setTimeout(function(){a.rd=null,a.vb||(a.J&&102400<a.J.kb?(a.f("Connection exceeded healthy timeout but has received "+a.J.kb+" bytes.  Marking connection healthy."),a.vb=!0,a.J.wd()):a.J&&10240<a.J.lb?a.f("Connection exceeded healthy timeout but has sent "+a.J.lb+" bytes.  Leaving connection alive."):(a.f("Closing unhealthy connection after timeout."),a.close()))},Math.floor(b)))}function le(a,b){return function(c){b===a.J?(a.J=null,c||0!==a.Pa?1===a.Pa&&a.f("Realtime connection lost."):(a.f("Realtime connection failed."),"s-"===a.Q.Ka.substr(0,2)&&(Aa.remove("host:"+a.Q.host),a.Q.Ka=a.Q.host)),a.close()):b===a.C?(a.f("Secondary connection lost."),c=a.C,a.C=null,a.ad!==c&&a.Xc!==c||a.close()):a.f("closing an old connection")}}function ke(a,b){return function(c){if(2!=a.Pa)if(b===a.Xc){var d=zb("t",c);if(c=zb("d",c),"c"==d){if(d=zb("t",c),"d"in c)if(c=c.d,"h"===d){var d=c.ts,e=c.v,f=c.h;a.Kd=c.s,Da(a.Q,f),0==a.Pa&&(a.J.start(),me(a,a.J,d),"5"!==e&&z("Protocol version mismatch detected"),c=a.xf,(c=1<c.$c.length?c.$c[1]:null)&&ne(a,c))}else if("n"===d){for(a.f("recvd end transmission on primary"),a.Xc=a.C,c=0;c<a.Ed.length;++c)a.Bd(a.Ed[c]);a.Ed=[],oe(a)}else"s"===d?(a.f("Connection shutdown command received. Shutting down..."),a.De&&(a.De(c),a.De=null),a.ea=null,a.close()):"r"===d?(a.f("Reset packet received.  New host: "+c),Da(a.Q,c),1===a.Pa?a.close():(pe(a),je(a))):"e"===d?sb("Server Error: "+c):"o"===d?(a.f("got pong on primary."),qe(a),re(a)):sb("Unknown control packet command: "+d)}else"d"==d&&a.Bd(c)}else if(b===a.C)if(d=zb("t",c),c=zb("d",c),"c"==d)"t"in c&&(c=c.t,"a"===c?se(a):"r"===c?(a.f("Got a reset on secondary, closing it"),a.C.close(),a.ad!==a.C&&a.Xc!==a.C||a.close()):"o"===c&&(a.f("got pong on secondary."),a.tf--,se(a)));else{if("d"!=d)throw Error("Unknown protocol layer: "+d);a.Ed.push(c)}else a.f("message on old connection")}}function oe(a){a.ad===a.C&&a.Xc===a.C&&(a.f("cleaning up and promoting a connection: "+a.C.ie),a.J=a.C,a.C=null)}function se(a){0>=a.tf?(a.f("Secondary connection is healthy."),a.vb=!0,a.C.wd(),a.C.start(),a.f("sending client ack on secondary"),a.C.send({t:"c",d:{t:"a",d:{}}}),a.f("Ending transmission on primary"),a.J.send({t:"c",d:{t:"n",d:{}}}),a.ad=a.C,oe(a)):(a.f("sending ping on secondary."),a.C.send({t:"c",d:{t:"p",d:{}}}))}function qe(a){a.vb||(a.He--,0>=a.He&&(a.f("Primary connection is healthy."),a.vb=!0,a.J.wd()))}function ne(a,b){a.C=new b("c:"+a.id+":"+a.Se++,a.Q,a.Kd),a.tf=b.responsesRequiredToBeHealthy||0,a.C.open(ke(a,a.C),le(a,a.C)),setTimeout(function(){a.C&&(a.f("Timed out trying to upgrade."),a.C.close())},Math.floor(6e4))}function me(a,b,c){a.f("Realtime connection established."),a.J=b,a.Pa=1,a.Kc&&(a.Kc(c),a.Kc=null),0===a.He?(a.f("Primary connection is healthy."),a.vb=!0):setTimeout(function(){re(a)},Math.floor(5e3))}function re(a){a.vb||1!==a.Pa||(a.f("sending ping on primary."),te(a,{t:"c",d:{t:"p",d:{}}}))}function te(a,b){if(1!==a.Pa)throw"Connection is not connected";a.ad.send(b)}function pe(a){a.f("Shutting down all connections"),a.J&&(a.J.close(),a.J=null),a.C&&(a.C.close(),a.C=null),a.rd&&(clearTimeout(a.rd),a.rd=null)}function ue(a){var b={},c={},d={},e="";try{var f=a.split("."),b=ua(jb(f[0])||""),c=ua(jb(f[1])||""),e=f[2],d=c.d||{};
delete c.d}catch(g){}return{Bg:b,fe:c,data:d,sg:e}}function ve(a){return a=ue(a).fe,"object"==typeof a&&a.hasOwnProperty("iat")?v(a,"iat"):null}function we(a){a=ue(a);var b=a.fe;return!!a.sg&&!!b&&"object"==typeof b&&b.hasOwnProperty("iat")}function xe(a,b,c,d){this.id=ye++,this.f=rb("p:"+this.id+":"),this.Eb=!0,this.ua={},this.la=[],this.Nc=0,this.Jc=[],this.ia=!1,this.Va=1e3,this.xd=3e5,this.Cd=b,this.Ad=c,this.Ee=d,this.Q=a,this.Ke=null,this.Tc={},this.ng=0,this.Dc=this.ue=null,ze(this,0),vd.Qb().zb("visible",this.fg,this),-1===a.host.indexOf("fblocal")&&wd.Qb().zb("online",this.dg,this)}function Be(a,b,c,d,e){var f=b.Da(),g=b.path.toString();a.f("Listen called for "+g+" "+f),a.ua[g]=a.ua[g]||{},x(!a.ua[g][f],"listen() called twice for same path/queryId."),b={H:e,qd:c,kg:Dc(b),tag:d},a.ua[g][f]=b,a.ia&&Ce(a,g,f,b)}function Ce(a,b,c,d){a.f("Listen on "+b+" for "+c);var e={p:b};d.tag&&(e.q=d.kg,e.t=d.tag),e.h=d.qd(),a.wa("q",e,function(e){if((a.ua[b]&&a.ua[b][c])===d){a.f("listen response",e);var g=e.s;"ok"!==g&&De(a,b,c),e=e.d,d.H&&d.H(g,e)}})}function Ee(a){var b=a.Lb;a.ia&&b&&a.wa("auth",{cred:b.Mf},function(c){var d=c.s;c=c.d||"error","ok"!==d&&a.Lb===b&&delete a.Lb,b.Ye?"ok"!==d&&b.cd&&b.cd(d,c):(b.Ye=!0,b.sc&&b.sc(d,c))})}function Fe(a,b,c,d){a.ia?Ge(a,"o",b,c,d):a.Jc.push({Pc:b,action:"o",data:c,H:d})}function He(a,b,c,d){a.ia?Ge(a,"om",b,c,d):a.Jc.push({Pc:b,action:"om",data:c,H:d})}function Ge(a,b,c,d,e){c={p:c,d:d},a.f("onDisconnect "+b,c),a.wa(b,c,function(a){e&&setTimeout(function(){e(a.s,a.d)},Math.floor(0))})}function Ke(a,b,c,d){Ie(a,"m",b,c,d,void 0)}function Ie(a,b,c,d,e,f){d={p:c,d:d},n(f)&&(d.h=f),a.la.push({action:b,of:d,H:e}),a.Nc++,b=a.la.length-1,a.ia?Le(a,b):a.f("Buffering put: "+c)}function Le(a,b){var c=a.la[b].action,d=a.la[b].of,e=a.la[b].H;a.la[b].lg=a.ia,a.wa(c,d,function(d){a.f(c+" response",d),delete a.la[b],a.Nc--,0===a.Nc&&(a.la=[]),e&&e(d.s,d.d)})}function ze(a,b){x(!a.La,"Scheduling a connect when we're already connected/ing?"),a.Nb&&clearTimeout(a.Nb),a.Nb=setTimeout(function(){a.Nb=null,Oe(a)},Math.floor(b))}function Oe(a){if(a.Eb){a.f("Making a connection attempt"),a.ue=(new Date).getTime(),a.Dc=null;var b=q(a.Bd,a),c=q(a.Kc,a),d=q(a.jf,a),e=a.id+":"+Ae++;a.La=new ie(e,a.Q,b,c,d,function(b){z(b+" ("+a.Q.toString()+")"),a.Eb=!1})}}function Me(a,b,c){c=c?La(c,function(a){return Ab(a)}).join("$"):"default",(a=De(a,b,c))&&a.H&&a.H("permission_denied")}function De(a,b,c){b=new P(b).toString();var d=a.ua[b][c];return delete a.ua[b][c],0===Kb(a.ua[b])&&delete a.ua[b],d}function Ne(a){Ee(a),A(a.ua,function(b,d){A(b,function(b,c){Ce(a,d,c,b)})});for(var b=0;b<a.la.length;b++)a.la[b]&&Le(a,b);for(;a.Jc.length;)b=a.Jc.shift(),Ge(a,b.action,b.Pc,b.data,b.H)}function Pe(){this.j=this.A=null}function Qe(a,b){if(b.e())return a.A=null,a.j=null,!0;if(null!==a.A){if(a.A.P())return!1;var c=a.A;return a.A=null,c.ca(L,function(b,c){a.ic(new P(b),c)}),Qe(a,b)}return null!==a.j?(c=G(b),b=R(b),a.j.contains(c)&&Qe(a.j.get(c),b)&&a.j.remove(c),a.j.e()?(a.j=null,!0):!1):!0}function Re(a,b,c){null!==a.A?c(b,a.A):a.ca(function(a,e){var f=new P(b.toString()+"/"+a);Re(e,f,c)})}function Se(){this.Wc=K}function Te(){this.qb=[]}function Ue(a,b){for(var c=null,d=0;d<b.length;d++){var e=b[d],f=e.Rb();null===c||f.ja(c.Rb())||(a.qb.push(c),c=null),null===c&&(c=new Ve(f)),c.add(e)}c&&a.qb.push(c)}function Cc(a,b,c){Ue(a,c),We(a,function(a){return a.ja(b)})}function Xe(a,b,c){Ue(a,c),We(a,function(a){return a.contains(b)||b.contains(a)})}function We(a,b){for(var c=!0,d=0;d<a.qb.length;d++){var e=a.qb[d];if(e)if(e=e.Rb(),b(e)){for(var e=a.qb[d],f=0;f<e.od.length;f++){var g=e.od[f];if(null!==g){e.od[f]=null;var k=g.Pb();ob&&kb("event: "+g.toString()),Fb(k)}}a.qb[d]=null}else c=!1}c&&(a.qb=[])}function Ve(a){this.Ca=a,this.od=[]}function Ze(a,b,c){this.ed=a||{},this.Sd=b||{},this.lc=c||{},this.ed.remember||(this.ed.remember="default")}function af(a){var b={},c={};return va(a||{},function(a,e){0<=Ia($e,a)?b[a]=e:c[a]=e}),new Ze(b,{},c)}function V(a){var b=Error(v(bf,a),a);return b.code=a,b}function cf(){var b,a=window.opener.frames;for(b=a.length-1;b>=0;b--)try{if(a[b].location.protocol===window.location.protocol&&a[b].location.host===window.location.host&&"__winchan_relay_frame"===a[b].name)return a[b]}catch(c){}return null}function df(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,!1)}function ef(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener&&a.removeEventListener(b,c,!1)}function ff(a){/^https?:\/\//.test(a)||(a=window.location.href);var b=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(a);return b?b[1]:a}function gf(a){var b="";try{a=a.replace("#","");var c={},d=a.replace(/^\?/,"").split("&");for(a=0;a<d.length;a++)if(d[a]){var e=d[a].split("=");c[e[0]]=e[1]}c&&u(c,"__firebase_request_key")&&(b=v(c,"__firebase_request_key"))}catch(f){}return b}function hf(a){var c,b=[];for(c in a)if(u(a,c)){var d=v(a,c);if(ea(d))for(var e=0;e<d.length;e++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(d[e]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(v(a,c)))}return b.join("&")}function jf(){var a=ub(Ye);return a.scheme+"://"+a.host+"/v2"}function kf(){return!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(navigator.userAgent)}function lf(){var a=navigator.userAgent;if("Microsoft Internet Explorer"===navigator.appName){if((a=a.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/))&&1<a.length)return 8<=parseFloat(a[1])}else if(-1<a.indexOf("Trident")&&(a=a.match(/rv:([0-9]{2,2}[\.0-9]{0,})/))&&1<a.length)return 8<=parseFloat(a[1]);return!1}function mf(a){a=a||{},a.method||(a.method="GET"),a.headers||(a.headers={}),a.headers.content_type||(a.headers.content_type="application/json"),a.headers.content_type=a.headers.content_type.toLowerCase(),this.options=a}function nf(a){a=a||{},this.Uc=Ha()+Ha()+Ha(),this.kf=a||{}}function of(a){a=a||{},(!a.window_features||-1!==navigator.userAgent.indexOf("Fennec/")||-1!==navigator.userAgent.indexOf("Firefox/")&&-1!==navigator.userAgent.indexOf("Android"))&&(a.window_features=void 0),a.window_name||(a.window_name="_blank"),a.relay_url||(a.relay_url=jf()+"/auth/channel"),this.options=a}function pf(a){a=a||{},a.callback_parameter||(a.callback_parameter="callback"),this.options=a,window.__firebase_auth_jsonp=window.__firebase_auth_jsonp||{}}function qf(a,b,c){setTimeout(function(){try{var d=document.createElement("script");d.type="text/javascript",d.id=a,d.async=!0,d.src=b,d.onerror=function(){var b=document.getElementById(a);null!==b&&b.parentNode.removeChild(b),c&&c(V("NETWORK_ERROR"))};var e=document.getElementsByTagName("head");(e&&0!=e.length?e[0]:document.documentElement).appendChild(d)}catch(f){c&&c(V("NETWORK_ERROR"))}},0)}function rf(a,b){this.Ge=["session",a.Gd,a.yb].join(":"),this.Pd=b}function sf(a){a=a||{},this.Uc=Ha()+Ha()+Ha(),this.kf=a||{}}function tf(a,b,c,d){td.call(this,["auth_status"]),this.Q=a,this.Re=b,this.xg=c,this.Be=d,this.mc=new rf(a,[Aa,Ba]),this.jb=null,uf(this)}function uf(a){Ba.get("redirect_request_id")&&vf(a);var b=a.mc.get();b&&b.token?(wf(a,b),a.Re(b.token,function(c,d){xf(a,c,d,!1,b.token,b)},function(b,d){yf(a,"resumeSession()",b,d)})):wf(a,null)}function zf(a,b,c,d,e,f){"firebaseio-demo.com"===a.Q.domain&&z("Firebase authentication is not supported on demo Firebases (*.firebaseio-demo.com). To secure your Firebase, create a production Firebase at https://www.firebase.com."),a.Re(b,function(f,k){xf(a,f,k,!0,b,c,d||{},e)},function(b,c){yf(a,"auth()",b,c,f)})}function Af(a,b){a.mc.clear(),wf(a,null),a.xg(function(a,d){if("ok"===a)B(b,null);else{var e=(a||"error").toUpperCase(),f=e;d&&(f+=": "+d),f=Error(f),f.code=e,B(b,f)}})}function xf(a,b,c,d,e,f,g,k){"ok"===b?(d&&(b=c.auth,f.auth=b,f.expires=c.expires,f.token=we(e)?e:"",c=null,b&&u(b,"uid")?c=v(b,"uid"):u(f,"uid")&&(c=v(f,"uid")),f.uid=c,c="custom",b&&u(b,"provider")?c=v(b,"provider"):u(f,"provider")&&(c=v(f,"provider")),f.provider=c,a.mc.clear(),we(e)&&(g=g||{},c=Aa,"sessionOnly"===g.remember&&(c=Ba),"none"!==g.remember&&a.mc.set(f,c)),wf(a,f)),B(k,null,f)):(a.mc.clear(),wf(a,null),f=a=(b||"error").toUpperCase(),c&&(f+=": "+c),f=Error(f),f.code=a,B(k,f))}function yf(a,b,c,d,e){z(b+" was canceled: "+d),a.mc.clear(),wf(a,null),a=Error(d),a.code=c.toUpperCase(),B(e,a)}function Bf(a,b,c,d,e){Cf(a);var f=[mf,pf];c=new Ze(d||{},{},c||{}),Df(a,f,"/auth/"+b,c,e)}function Ef(a,b,c,d){Cf(a);var e=[of,nf];c=af(c),"anonymous"===b||"password"===b?setTimeout(function(){B(d,V("TRANSPORT_UNAVAILABLE"))},0):(c.Sd.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height=625,width=625,top="+("object"==typeof screen?.5*(screen.height-625):0)+",left="+("object"==typeof screen?.5*(screen.width-625):0),c.Sd.relay_url=jf()+"/"+a.Q.yb+"/auth/channel",c.Sd.requestWithCredential=q(a.Vc,a),Df(a,e,"/auth/"+b,c,d))}function vf(a){var b=Ba.get("redirect_request_id");if(b){var c=Ba.get("redirect_client_options");Ba.remove("redirect_request_id"),Ba.remove("redirect_client_options");var d=[mf,pf],b={requestId:b,requestKey:gf(document.location.hash)},c=new Ze(c,{},b);try{document.location.hash=document.location.hash.replace(/&__firebase_request_key=([a-zA-z0-9]*)/,"")}catch(e){}Df(a,d,"/auth/session",c)}}function Df(a,b,c,d,e){Ff(a,b,c,d,function(b,c){!b&&c&&c.token&&c.uid?zf(a,c.token,c,d.ed,function(a,b){a?B(e,a):B(e,null,b)}):B(e,b||V("UNKNOWN_ERROR"))})}function Ff(a,b,c,d,e){b=Ka(b,function(a){return"function"==typeof a.isAvailable&&a.isAvailable()}),0===b.length?setTimeout(function(){B(e,V("TRANSPORT_UNAVAILABLE"))},0):(b=new(b.shift())(d.Sd),d=wa(d.lc),d.v="js-2.0.6",d.transport=b.uc(),d.suppress_status_codes=!0,a=jf()+"/"+a.Q.yb+c,b.open(a,d,function(a,b){if(a)B(e,a);else if(b&&b.error){var c=Error(b.error.message);c.code=b.error.code,c.details=b.error.details,B(e,c)}else B(e,null,b)}))}function wf(a,b){var c=null!==a.jb||null!==b;a.jb=b,c&&a.Td("auth_status",b),a.Be(null!==b)}function Cf(a){var b=a.Q;if("firebaseio.com"!==b.domain&&"firebaseio-demo.com"!==b.domain&&"auth.firebase.com"===Ye)throw Error("This custom Firebase server ('"+a.Q.domain+"') does not support delegated login.")}function Gf(a,b){return a&&"object"==typeof a?(x(".sv"in a,"Unexpected leaf node or priority contents"),b[a[".sv"]]):a}function Hf(a,b){var c=new Pe;return Re(a,new P(""),function(a,e){c.ic(a,If(e,b))}),c}function If(a,b){var d,c=a.O().N(),c=Gf(c,b);if(a.P()){var e=Gf(a.ta(),b);return e!==a.ta()||c!==a.O().N()?new Zc(e,J(c)):a}return d=a,c!==a.O().N()&&(d=d.ib(new Zc(c))),a.ca(L,function(a,c){var e=If(c,b);e!==c&&(d=d.I(a,e))}),d}function W(a,b,c,d){this.type=a,this.Wa=b,this.nb=c,this.Rc=null,this.$f=d}function Jf(){}function Lf(a,b,c,d){var e,f;return f=X(c),e=X(b),d.e()?c.u?(a=[],e?e.ja(f)||(e.P()?a=Mf(f):f.P()?(a=[],e.P()||e.e()||a.push(new W("children_removed",e))):a=Nf(e,f),a.push(new W("value",f))):(a=Mf(f),a.push(new W("value",f))),0!==a.length||b.u||a.push(new W("value",f)),a):e?Nf(e,f):Mf(f):".priority"===G(d)?!c.u||e&&e.ja(f)?[]:[new W("value",f)]:c.u||1===Q(d)?(e=G(d),f=f.B(e),a.kd(b,c,e,f)):(e=G(d),f.Y(e)?(f=f.B(e),a.kd(b,c,e,f)):[])}function Mf(a){var b=[];return a.P()||a.e()||b.push(new W("children_added",a)),b}function Nf(a,b){var l,m,r,s,c=[],d=[],e=[],f=[],g={},k={};l=a.Aa(L),r=U(l),m=b.Aa(L),s=U(m);for(var y=H(L);null!==r||null!==s;){var N;N=r?s?y(r,s):-1:1,0>N?(N=v(g,r.name),n(N)?(f.push(d[N]),d[N]=null):(k[r.name]=e.length,e.push(r)),r=U(l)):(N>0?(N=v(k,s.name),n(N)?(f.push(s),e[N]=null):(g[s.name]=d.length,d.push(s))):((r=r.K.hash()!==s.K.hash())&&f.push(s),r=U(l)),s=U(m))}for(g=0;g<e.length;g++)(k=e[g])&&c.push(new W("child_removed",k.K,k.name));for(g=0;g<d.length;g++)(e=d[g])&&c.push(new W("child_added",e.K,e.name));for(g=0;g<f.length;g++)d=f[g],c.push(new W("child_changed",d.K,d.name,a.B(d.name)));return c}function Of(a,b,c){this.bb=a,this.Ma=c,this.m=b}function Pf(){}function Tf(a,b){Wf(a,b.F),Wf(a,b.o),Wf(a,b.u),Wf(a,b.X)}function Wf(a,b){x(!b||a.Yb(b),"Expected an indexed snap")}function Yf(a,b){var c=X(a),d=a.ab();return!!(c&&c.Y(b)||d&&d.Y(b))}function Zf(a){this.gb=a,this.index=a.m,this.gb.ga&&n(pc(this.gb))?(a=qc(this.gb),a=this.index.ye(pc(this.gb),a)):a=this.index.Ae(),this.Fb=a,this.gb.na&&n(rc(this.gb))?(a=sc(this.gb),a=this.index.ye(rc(this.gb),a)):a=this.index.ze(),this.pb=a}function $f(a){Zf.call(this,a),this.Ma=!(""===a.Hb?a.ga:"l"===a.Hb),this.bb=tc(a)}function ag(a,b,c,d,e,f){var k,g=H(a.index);k=a.Ma?function(a,b){return-1*g(a,b)}:g,b=X(b),x(b.Ua()===a.bb,"Limit should be full.");var l=new I(c,d),m=a.Ma?ld(b,a.index):md(b,a.index);x(null!=m,"Shouldn't be null, since oldEventCache shouldn't be empty.");var r=0>=H(a.index)(a.Fb,l)&&0>=H(a.index)(l,a.pb);return b.Y(c)?(f=e.de(f,m,1,a.Ma,a.index),e=null,0<f.length&&(e=f[0],e.name===c&&(e=2<=f.length?f[1]:null)),k=null==e?1:k(e,l),r&&!d.e()&&k>=0?b.I(c,d):(c=b.I(c,K),null!=e&&0>=H(a.index)(a.Fb,e)&&0>=H(a.index)(e,a.pb)?c.I(e.name,e.K):c)):d.e()?null:r?0<=k(m,l)?b.I(c,d).I(m.name,K):null:null}function bg(a){this.m=a}function cg(a){this.U=a,this.m=a.w.m}function dg(a,b,c,d){var e=[],f=a.m,g=La(Ka(b,function(a){return"child_changed"===a.type&&f.df(a.$f,a.Wa)}),function(a){return new W("child_moved",a.Wa,a.nb)}),k=Pa(b,function(a){return"child_removed"!==a.type&&"child_added"!==a.type});for(la(Ra,b,k,0).apply(null,g);0<b.length;){var g=b[0].type,k=eg(b,g),l=b.slice(0,k);b=b.slice(k),"value"===g||"children_added"===g||"children_removed"===g?x(1===l.length,"We should not have more than one of these at a view"):Ta(l,q(a.Lf,a)),e=e.concat(fg(a,d,l,c))}return e}function eg(a,b){var c=Pa(a,function(a){return a.type!==b});return-1===c?a.length:c}function fg(a,b,c,d){for(var e=[],f=0;f<c.length;++f)for(var g=c[f],k=null,l=null,m=0;m<b.length;++m){var r=b[m];if(r.pf(g.type)){if(!k&&!l)if("children_added"===g.type){var s=a,y=g.Wa,l=[];if(!y.P()&&!y.e())for(var s=y.Aa(s.m),y=null,N=U(s);N;){var Je=new W("child_added",N.K,N.name);Je.Rc=y,l.push(Je),y=N.name,N=U(s)}}else if("children_removed"===g.type){if(s=a,y=g.Wa,l=[],!y.P()&&!y.e())for(s=y.Aa(s.m),y=U(s);y;)l.push(new W("child_removed",y.K,y.name)),y=U(s)}else k=g,"value"!==k.type&&"child_removed"!==k.type&&(k.Rc=d.af(k.nb,k.Wa,a.m));if(k)e.push(r.createEvent(k,a.U));else for(s=0;s<l.length;++s)e.push(r.createEvent(l[s],a.U))}}return e}function gg(a,b){this.U=a;var c=a.w;wc(c)?(this.ec=new bg(c.m),this.ld=Kf):c.ka?(this.ec=new $f(c),this.ld=new Of(tc(c),c.m,this.ec.Ma)):(this.ec=new Zf(c),this.ld=Kf),c=this.ec,this.ha=new Uf(b.F&&c.G(b.F,!1),b.o&&c.G(b.o,!1),b.u&&c.G(b.u),b.X&&c.G(b.X)),this.ya=[],this.le=new cg(a)}function hg(a){return a.U}function Uf(a,b,c,d){this.F=a,this.o=b,this.u=c,this.X=d,x(null==a||null==b,"Only one of serverSnap / serverChildren can be non-null."),x(null==c||null==d,"Only one of eventSnap / eventChildren can be non-null.")}function X(a){return a.u||a.X}function jg(a,b){this.value=a,this.children=b||kg}function mg(a){var b=lg;return A(a,function(a,d){b=b.set(new P(d),a)}),b}function ng(a,b,c){if(null!=a.value&&c(a.value))return{path:S,value:a.value};if(b.e())return null;var d=G(b);return a=a.children.get(d),null!==a?(b=ng(a,R(b),c),null!=b?{path:new P(d).k(b.path),value:b.value}:null):null}function og(a,b){return ng(a,b,function(){return!0})}function pg(a,b,c){if(b.e())return c;var d=G(b);return b=pg(a.children.get(d)||lg,R(b),c),d=b.e()?a.children.remove(d):a.children.Ja(d,b),new jg(a.value,d)}function qg(a,b){return rg(a,S,b)}function rg(a,b,c){var d={};return a.children.Ba(function(a,f){d[a]=rg(f,b.k(a),c)}),c(b,a.value,d)}function sg(a,b,c){return tg(a,b,S,c)}function tg(a,b,c,d){var e=a.value?d(c,a.value):!1;return e?e:b.e()?null:(e=G(b),(a=a.children.get(e))?tg(a,R(b),c.k(e),d):null)}function ug(a,b,c){if(!b.e()){var d=!0;a.value&&(d=c(S,a.value)),!0===d&&(d=G(b),(a=a.children.get(d))&&vg(a,R(b),S.k(d),c))}}function vg(a,b,c,d){if(b.e())return a;a.value&&d(c,a.value);var e=G(b);return(a=a.children.get(e))?vg(a,R(b),c.k(e),d):lg}function Xf(a,b){wg(a,S,b)}function wg(a,b,c){a.children.Ba(function(a,e){wg(e,b.k(a),c)}),a.value&&c(b,a.value)}function xg(a,b){a.children.Ba(function(a,d){d.value&&b(a,d.value)})}function yg(){this.qa={}}function Ag(a){return Ka(xd(a.qa),function(a){return!wc(a.U.w)})}function Bg(a,b){if(wc(b.w))return zg(a);var c=b.Da();return v(a.qa,c)}function zg(a){return Ad(a.qa,function(a){return wc(a.U.w)})||null}function Cg(){this.V=lg,this.ra=[],this.Ec=-1}function Dg(a,b){var c=Pa(a.ra,function(a){return a.Xd===b});x(c>=0,"removeWrite called with nonexistent writeId.");var d=a.ra[c];a.ra.splice(c,1);for(var e=!1,f=!1,g=!1,k=a.ra.length-1;!e&&k>=0;){var l=a.ra[k];k>=c&&Eg(l,d.path)?e=!0:!f&&d.path.contains(l.path)&&(k>=c?f=!0:g=!0),k--}return e||(f||g?Fg(a):d.Oa?a.V=a.V.remove(d.path):A(d.children,function(b,c){a.V=a.V.remove(d.path.k(c))})),c=d.path,og(a.V,c)?g?c:(x(e,"Must have found a shadow"),null):c}function Eg(a,b){return a.Oa?a.path.contains(b):!!zd(a.children,function(c,d){return a.path.k(d).contains(b)})}function Fg(a){a.V=Gg(a.ra,Hg,S),a.Ec=0<a.ra.length?a.ra[a.ra.length-1].Xd:-1}function Hg(a){return a.visible}function Gg(a,b,c){for(var d=lg,e=0;e<a.length;++e){var f=a[e];if(b(f)){var k,g=f.path;f.Oa?(c.contains(g)?(k=T(c,g),f=f.Oa):(k=S,f=f.Oa.da(T(g,c))),d=Ig(d,k,f)):d=Jg(d,f.path,f.children)}}return d}function Ig(a,b,c){var d=og(a,b);if(d){var e=d.value,d=d.path;b=T(d,b),c=e.L(b,c),a=pg(a,d,new jg(c))}else a=pg(a,b,new jg(c));return a}function Jg(a,b,c){var d=og(a,b);if(d){var e=d.value,d=d.path,f=T(d,b),g=e;A(c,function(a,b){g=g.L(f.k(b),a)}),a=pg(a,d,new jg(g))}else A(c,function(c,d){a=pg(a,b.k(d),new jg(c))});return a}function Kg(a,b){this.Gb=a,this.Ib=b}function Lg(a,b,c){this.type=Qf,this.source=a,this.path=b,this.Oa=c}function Mg(a,b){this.type=Sf,this.source=Ng,this.path=a,this.sf=b}function Og(a,b){this.type=Vf,this.source=a,this.path=b}function Pg(a,b,c){this.type=Rf,this.source=a,this.path=b,this.children=c}function Qg(a,b,c,d){this.$e=a,this.Ze=b,this.fc=c,this.wf=d,x(!d||b,"Tagged queries must be from server.")}function Sg(a){this.ma=lg,this.Bb=new Cg,this.Zc={},this.gc={},this.Fc=a}function Ug(a,b,c,d){if(d=Cd(a.Zc,"_"+d),null!=d){var e=Vg(d);return d=e.path,e=e.fc,b=T(d,b),c=new Lg(new Qg(!1,!0,e,!0),b,c),Wg(a,d,c)}return[]}function Xg(a,b,c,d){if(d=Cd(a.Zc,"_"+d)){var e=Vg(d);return d=e.path,e=e.fc,b=T(d,b),c=mg(c),c=new Pg(new Qg(!1,!0,e,!0),b,c),Wg(a,d,c)}return[]}function ah(a){return qg(a,function(a,c,d){if(c&&null!=zg(c))return[zg(c)];var e=[];return c&&(e=Ag(c)),A(d,function(a){e=e.concat(a)}),e})}function dh(a,b){for(var c=0;c<b.length;++c){var d=b[c];if(!wc(d.w)){var d=Yg(d),e=a.gc[d];delete a.gc[d],delete a.Zc["_"+e]}}}function $g(a,b,c){var d=b.path,e=ch(a,b);if(c=bh(a,c),b=a.Fc.Le(b,e,c.qd,c.H),d=a.ma.subtree(d),e)x(null==zg(d.value),"If we're adding a query, it shouldn't be shadowed");else for(e=qg(d,function(a,b,c){if(!a.e()&&b&&null!=zg(b))return[hg(zg(b))];var d=[];return b&&(d=d.concat(La(Ag(b),function(a){return a.U}))),A(c,function(a){d=d.concat(a)}),d}),d=0;d<e.length;++d)c=e[d],a.Fc.Od(c,ch(a,c));return b}function bh(a,b){var c=b.U,d=ch(a,c);return{qd:function(){return(b.ab()||K).hash()},H:function(b,f){if("ok"===b){if(f&&"object"==typeof f&&u(f,"w")){var g=v(f,"w");ea(g)&&0<=Ia(g,"no_index")&&z("Using an unspecified index. Consider adding "+('".indexOn": "'+c.w.m.toString()+'"')+" at "+c.path.toString()+" to your security rules for better performance")}if(d){var k=c.path;if(g=Cd(a.Zc,"_"+d))var l=Vg(g),g=l.path,l=l.fc,k=T(g,k),k=new Og(new Qg(!1,!0,l,!0),k),g=Wg(a,g,k);else g=[]}else g=Tg(a,new Og(Rg,c.path));return g}return g="Unknown Error","too_big"===b?g="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==b?g="Client doesn't have permission to access the desired data.":"unavailable"==b&&(g="The service is unavailable"),g=Error(b+": "+g),g.code=b.toUpperCase(),a.hb(c,null,g)}}}function Yg(a){return a.path.toString()+"$"+a.Da()}function Vg(a){var b=a.indexOf("$");return x(-1!==b&&b<a.length-1,"Bad queryKey."),{fc:a.substr(b+1),path:new P(a.substr(0,b))}}function ch(a,b){var c=Yg(b);return v(a.gc,c)}function Wg(a,b,c){var d=a.ma.get(b);return x(d,"Missing sync point for query tag that we're tracking"),d.Xa(c,new Kg(b,a.Bb),null)}function Tg(a,b){return eh(a,b,a.ma,null,new Kg(S,a.Bb))}function eh(a,b,c,d,e){if(b.path.e())return fh(a,b,c,d,e);var f=c.get(S);null==d&&null!=f&&(d=f.za(S));var g=[],k=G(b.path),l=b.Mc(k);if((c=c.children.get(k))&&l)var m=d?d.B(k):null,k=e.k(k),g=g.concat(eh(a,l,c,m,k));return f&&(g=g.concat(f.Xa(b,e,d))),g}function fh(a,b,c,d,e){var f=c.get(S);null==d&&null!=f&&(d=f.za(S));var g=[];return c.children.Ba(function(c,f){var m=d?d.B(c):null,r=e.k(c),s=b.Mc(c);s&&(g=g.concat(fh(a,s,f,m,r)))}),f&&(g=g.concat(f.Xa(b,e,d))),g}function gh(a){this.Q=a,this.Qa=Ld(a),this.Z=new Te,this.zd=1,this.S=new xe(this.Q,q(this.Cd,this),q(this.Ad,this),q(this.Ee,this)),this.ug=Md(a,q(function(){return new Id(this.Qa,this.S)},this)),this.pc=new Fc,this.qe=new Se;var b=this;this.ud=new Sg({Le:function(a,d,e,f){return d=[],e=b.qe.Wc.da(a.path),e.e()||(d=b.ud.Sa(a.path,e),setTimeout(function(){f("ok")},0)),d},Od:ba}),hh(this,"connected",!1),this.ea=new Pe,this.T=new tf(a,q(this.S.T,this.S),q(this.S.Pe,this.S),q(this.Be,this)),this.jd=0,this.re=null,this.M=new Sg({Le:function(a,d,e,f){return Be(b.S,a,e,d,function(d,e){var l=f(d,e);Xe(b.Z,a.path,l)}),[]},Od:function(a,d){var e=b.S,f=a.path.toString(),g=a.Da();if(e.f("Unlisten called for "+f+" "+g),De(e,f,g)&&e.ia){var k=Dc(a);e.f("Unlisten on "+f+" for "+g),f={p:f},d&&(f.q=k,f.t=d),e.wa("n",f)}}})}function ih(a){var b=new P(".info/serverTimeOffset");return a=a.qe.Wc.da(b).N()||0,(new Date).getTime()+a}function jh(a){return a=a={timestamp:ih(a)},a.timestamp=a.timestamp||(new Date).getTime(),a}function hh(a,b,c){b=new P("/.info/"+b),c=J(c);var d=a.qe;d.Wc=d.Wc.L(b,c),c=a.ud.Sa(b,c),Xe(a.Z,b,c)}function lh(a){a.f("onDisconnectEvents");var b=jh(a),c=[];Re(Hf(a.ea,b),S,function(b,e){c=c.concat(a.M.Sa(b,e));var f=nh(a,b);kh(a,f)}),a.ea=new Pe,Xe(a.Z,S,c)}function oh(a,b,c,d){var e=J(c);Fe(a.S,b.toString(),e.N(!0),function(c,g){"ok"===c&&a.ea.ic(b,e),mh(d,c,g)})}function ph(a,b,c,d,e){var f=J(c,d);Fe(a.S,b.toString(),f.N(!0),function(c,d){"ok"===c&&a.ea.ic(b,f),mh(e,c,d)})}function qh(a,b,c,d){var f,e=!0;for(f in c)e=!1;e?(kb("onDisconnect().update() called with empty data.  Don't do anything."),mh(d,"ok")):He(a.S,b.toString(),c,function(e,f){if("ok"===e)for(var l in c){var m=J(c[l]);a.ea.ic(b.k(l),m)}mh(d,e,f)})}function Bc(a,b,c){c=".info"===G(b.path)?a.ud.Jb(b,c):a.M.Jb(b,c),Cc(a.Z,b.path,c)}function mh(a,b,c){a&&Fb(function(){if("ok"==b)a(null);else{var d=(b||"error").toUpperCase(),e=d;c&&(e+=": "+c),e=Error(e),e.code=d,a(e)}})}function rh(a,b,c,d,e){function f(){}a.f("transaction on "+b);var g=new O(a,b);if(g.zb("value",f),c={path:b,update:c,H:d,status:null,lf:hb(),Qe:e,rf:0,Vd:function(){g.bc("value",f)},Yd:null,sa:null,fd:null,gd:null,hd:null},d=a.M.xa(b,void 0)||K,c.fd=d,d=c.update(d.N()),n(d)){Tb("transaction failed: Data returned ",d),c.status=1,e=Gc(a.pc,b);var k=e.ta()||[];k.push(c),Hc(e,k),"object"==typeof d&&null!==d&&u(d,".priority")?(k=v(d,".priority"),x(Rb(k),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):k=(a.M.xa(b)||K).O().N(),e=jh(a),d=J(d,k),e=If(d,e),c.gd=d,c.hd=e,c.sa=a.zd++,c=a.M.Fa(b,e,c.sa,c.Qe),Xe(a.Z,b,c),sh(a)}else c.Vd(),c.gd=null,c.hd=null,c.H&&(a=new C(c.fd,new O(a,c.path),L),c.H(null,!1,a))}function sh(a,b){var c=b||a.pc;if(b||th(a,c),null!==c.ta()){var d=uh(a,c);x(0<d.length,"Sending zero length transaction queue"),Na(d,function(a){return 1===a.status})&&vh(a,c.path(),d)}else c.pd()&&c.ca(function(b){sh(a,b)})}function vh(a,b,c){for(var d=La(c,function(a){return a.sa}),e=a.M.xa(b,d)||K,d=e,e=e.hash(),f=0;f<c.length;f++){var g=c[f];x(1===g.status,"tryToSendTransactionQueue_: items in queue should all be run."),g.status=2,g.rf++;var k=T(b,g.path),d=d.L(k,g.gd)}d=d.N(!0),a.S.put(b.toString(),d,function(d){a.f("transaction put response",{path:b.toString(),status:d});var e=[];if("ok"===d){for(d=[],f=0;f<c.length;f++){if(c[f].status=3,e=e.concat(a.M.Ea(c[f].sa)),c[f].H){var g=c[f].hd,k=new O(a,c[f].path);d.push(q(c[f].H,null,null,!0,new C(g,k,L)))}c[f].Vd()}for(th(a,Gc(a.pc,b)),sh(a),Xe(a.Z,b,e),f=0;f<d.length;f++)Fb(d[f])}else{if("datastale"===d)for(f=0;f<c.length;f++)c[f].status=4===c[f].status?5:1;else for(z("transaction at "+b.toString()+" failed: "+d),f=0;f<c.length;f++)c[f].status=5,c[f].Yd=d;kh(a,b)}},e)}function kh(a,b){var c=wh(a,b),d=c.path(),c=uh(a,c);return xh(a,c,d),d}function xh(a,b,c){if(0!==b.length){for(var d=[],e=[],f=La(b,function(a){return a.sa}),g=0;g<b.length;g++){var r,k=b[g],l=T(c,k.path),m=!1;if(x(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),5===k.status)m=!0,r=k.Yd,e=e.concat(a.M.Ea(k.sa,!0));else if(1===k.status)if(25<=k.rf)m=!0,r="maxretry",e=e.concat(a.M.Ea(k.sa,!0));else{var s=a.M.xa(k.path,f)||K;k.fd=s;var y=b[g].update(s.N());n(y)?(Tb("transaction failed: Data returned ",y),l=J(y),"object"==typeof y&&null!=y&&u(y,".priority")||(l=l.ib(s.O())),s=k.sa,y=jh(a),y=If(l,y),k.gd=l,k.hd=y,k.sa=a.zd++,Qa(f,s),e=e.concat(a.M.Fa(k.path,y,k.sa,k.Qe)),e=e.concat(a.M.Ea(s,!0))):(m=!0,r="nodata",e=e.concat(a.M.Ea(k.sa,!0)))}Xe(a.Z,c,e),e=[],m&&(b[g].status=3,setTimeout(b[g].Vd,Math.floor(0)),b[g].H&&("nodata"===r?(k=new O(a,b[g].path),d.push(q(b[g].H,null,null,!1,new C(b[g].fd,k,L)))):d.push(q(b[g].H,null,Error(r),!1,null))))}for(th(a,a.pc),g=0;g<d.length;g++)Fb(d[g]);sh(a)}}function wh(a,b){for(var c,d=a.pc;null!==(c=G(b))&&null===d.ta();)d=Gc(d,c),b=R(b);return d}function uh(a,b){var c=[];return yh(a,b,c),c.sort(function(a,b){return a.lf-b.lf}),c}function yh(a,b,c){var d=b.ta();if(null!==d)for(var e=0;e<d.length;e++)c.push(d[e]);b.ca(function(b){yh(a,b,c)})}function th(a,b){var c=b.ta();if(c){for(var d=0,e=0;e<c.length;e++)3!==c[e].status&&(c[d]=c[e],d++);c.length=d,Hc(b,0<c.length?c:null)}b.ca(function(b){th(a,b)})}function nh(a,b){var c=wh(a,b).path(),d=Gc(a.pc,b);return Kc(d,function(b){zh(a,b)}),zh(a,d),Jc(d,function(b){zh(a,b)}),c}function zh(a,b){var c=b.ta();if(null!==c){for(var d=[],e=[],f=-1,g=0;g<c.length;g++)4!==c[g].status&&(2===c[g].status?(x(f===g-1,"All SENT items should be at beginning of queue."),f=g,c[g].status=4,c[g].Yd="set"):(x(1===c[g].status,"Unexpected transaction status in abort"),c[g].Vd(),e=e.concat(a.M.Ea(c[g].sa,!0)),c[g].H&&d.push(q(c[g].H,null,Error("set"),!1,null))));for(-1===f?Hc(b,null):c.length=f+1,Xe(a.Z,b.path(),e),g=0;g<d.length;g++)Fb(d[g])}}function Ah(){this.jc={}}function Bh(a){var b=this;if(this.tc=a,this.Qd="*",lf()?this.Hc=this.sd=cf():(this.Hc=window.opener,this.sd=window),!b.Hc)throw"Unable to find relay frame";df(this.sd,"message",q(this.cc,this)),df(this.sd,"message",q(this.hf,this));try{Ch(this,{a:"ready"})}catch(c){df(this.Hc,"load",function(){Ch(b,{a:"ready"})})}df(window,"unload",q(this.eg,this))}function Ch(a,b){b=t(b),lf()?a.Hc.doPost(b,a.Qd):a.Hc.postMessage(b,a.Qd)}function Z(a,b){this.Sc=a,this.Ca=b}function O(a,b){var c,d,e;if(a instanceof gh)c=a,d=b;else{D("new Firebase",1,2,arguments.length),d=ub(arguments[0]),c=d.vg,"firebase"===d.domain&&tb(d.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),c||tb("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),d.Cb||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&z("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),c=new Ca(d.host,d.Cb,c,"ws"===d.scheme||"wss"===d.scheme),d=new P(d.Pc),e=d.toString();var f;if(!(f=!p(c.host)||0===c.host.length||!Qb(c.yb))&&(f=0!==e.length)&&(e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),f=!(p(e)&&0!==e.length&&!Pb.test(e))),f)throw Error(E("new Firebase",1,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".');if(b)if(b instanceof Ah)e=b;else{if(!p(b))throw Error("Expected a valid Firebase.Context for second argument to new Firebase()");e=Ah.Qb(),c.Gd=b}else e=Ah.Qb();f=c.toString();var g=v(e.jc,f);g||(g=new gh(c),e.jc[f]=g),c=g}M.call(this,c,d,oc,!1)}function qb(a,b){x(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?("undefined"!=typeof console&&("function"==typeof console.log?ob=q(console.log,console):"object"==typeof console.log&&(ob=function(a){console.log(a)})),b&&Ba.set("logging_enabled",!0)):a?ob=a:(ob=null,Ba.remove("logging_enabled"))}var h,aa=this,ma=Date.now||function(){return+new Date},sa={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},ta=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;h=xa.prototype,h.set=function(a,b){null==b?this.xc.removeItem(this.Hd+a):this.xc.setItem(this.Hd+a,t(b))},h.get=function(a){return a=this.xc.getItem(this.Hd+a),null==a?null:ua(a)},h.remove=function(a){this.xc.removeItem(this.Hd+a)},h.ff=!1,h.toString=function(){return this.xc.toString()},ya.prototype.set=function(a,b){null==b?delete this.ha[a]:this.ha[a]=b},ya.prototype.get=function(a){return u(this.ha,a)?this.ha[a]:null},ya.prototype.remove=function(a){delete this.ha[a]},ya.prototype.ff=!0;var Aa=za("localStorage"),Ba=za("sessionStorage");Ca.prototype.toString=function(){var a=(this.Cb?"https://":"http://")+this.host;return this.Gd&&(a+="<"+this.Gd+">"),a},na(Fa,Ea),Fa.prototype.reset=function(){this.R[0]=1732584193,this.R[1]=4023233417,this.R[2]=2562383102,this.R[3]=271733878,this.R[4]=3285377520,this.Rd=this.Tb=0},Fa.prototype.update=function(a,b){n(b)||(b=a.length);for(var c=b-this.Ta,d=0,e=this.be,f=this.Tb;b>d;){if(0==f)for(;c>=d;)Ga(this,a,d),d+=this.Ta;if(p(a)){for(;b>d;)if(e[f]=a.charCodeAt(d),++f,++d,f==this.Ta){Ga(this,e),f=0;break}}else for(;b>d;)if(e[f]=a[d],++f,++d,f==this.Ta){Ga(this,e),f=0;break}}this.Tb=f,this.Rd+=b};var w=Array.prototype,Ia=w.indexOf?function(a,b,c){return w.indexOf.call(a,b,c)}:function(a,b,c){if(c=null==c?0:0>c?Math.max(0,a.length+c):c,p(a))return p(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ja=w.forEach?function(a,b,c){w.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=p(a)?a.split(""):a,f=0;d>f;f++)f in e&&b.call(c,e[f],f,a)},Ka=w.filter?function(a,b,c){return w.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=p(a)?a.split(""):a,k=0;d>k;k++)if(k in g){var l=g[k];b.call(c,l,k,a)&&(e[f++]=l)}return e},La=w.map?function(a,b,c){return w.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=p(a)?a.split(""):a,g=0;d>g;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Ma=w.reduce?function(a,b,c,d){return d&&(b=q(b,d)),w.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;return Ja(a,function(c,g){e=b.call(d,e,c,g,a)}),e},Na=w.every?function(a,b,c){return w.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=p(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},Va;a:{var Wa=aa.navigator;if(Wa){var Xa=Wa.userAgent;if(Xa){Va=Xa;break a}}Va=""}var Za=Ya("Opera")||Ya("OPR"),$a=Ya("Trident")||Ya("MSIE"),ab=Ya("Gecko")&&-1==Va.toLowerCase().indexOf("webkit")&&!(Ya("Trident")||Ya("MSIE")),bb=-1!=Va.toLowerCase().indexOf("webkit");!function(){var b,a="";return Za&&aa.opera?(a=aa.opera.version,ha(a)?a():a):(ab?b=/rv\:([^\);]+)(\)|;)/:$a?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:bb&&(b=/WebKit\/(\S+)/),b&&(a=(a=b.exec(Va))?a[1]:""),$a&&(b=(b=aa.document)?b.documentMode:void 0,b>parseFloat(a))?String(b):a)}();var cb=null,db=null,eb=null,hb=function(){var a=1;return function(){return a++}}(),ob=null,pb=!0,Eb=/^-?\d{1,10}$/;Gb.prototype.Rb=function(){var a=this.Ld.hc();return"value"===this.nd?a.path:a.parent().path},Gb.prototype.oe=function(){return this.nd},Gb.prototype.Pb=function(){return this.me.Pb(this)},Gb.prototype.toString=function(){return this.Rb().toString()+":"+this.nd+":"+t(this.Ld.Xe())},Hb.prototype.Rb=function(){return this.path},Hb.prototype.oe=function(){return"cancel"},Hb.prototype.Pb=function(){return this.me.Pb(this)},Hb.prototype.toString=function(){return this.path.toString()+":cancel"},h=Ib.prototype,h.pf=function(a){return"value"===a},h.createEvent=function(a,b){var c=b.w.m;return new Gb("value",this,new C(a.Wa,b.hc(),c))},h.Pb=function(a){var b=this.vc;if("cancel"===a.oe()){x(this.mb,"Raising a cancel event on a listener with no cancel callback");var c=this.mb;return function(){c.call(b,a.error)}}var d=this.Kb;return function(){d.call(b,a.Ld)}},h.Te=function(a,b){return this.mb?new Hb(this,a,b):null},h.matches=function(a){return a instanceof Ib&&(!a.Kb||!this.Kb||a.Kb===this.Kb)&&a.vc===this.vc
},h.cf=function(){return null!==this.Kb},h=Jb.prototype,h.pf=function(a){return a="children_added"===a?"child_added":a,("children_removed"===a?"child_removed":a)in this.ba},h.Te=function(a,b){return this.mb?new Hb(this,a,b):null},h.createEvent=function(a,b){var c=b.hc().k(a.nb);return new Gb(a.type,this,new C(a.Wa,c,b.w.m),a.Rc)},h.Pb=function(a){var b=this.vc;if("cancel"===a.oe()){x(this.mb,"Raising a cancel event on a listener with no cancel callback");var c=this.mb;return function(){c.call(b,a.error)}}var d=this.ba[a.nd];return function(){d.call(b,a.Ld,a.Rc)}},h.matches=function(a){if(a instanceof Jb){if(this.ba&&a.ba){var b=Kb(a.ba);if(b===Kb(this.ba)){if(1===b){var b=Lb(a.ba),c=Lb(this.ba);return!(c!==b||a.ba[b]&&this.ba[c]&&a.ba[b]!==this.ba[c])}return Mb(this.ba,function(b,c){return a.ba[c]===b})}return!1}return!0}return!1},h.cf=function(){return null!==this.ba};var Ob=/[\[\].#$\/\u0000-\u001F\u007F]/,Pb=/[\[\].#$\u0000-\u001F\u007F]/,hc={};gc.prototype.df=function(a,b){return 0!==this.compare(new I("[MIN_NAME]",a),new I("[MIN_NAME]",b))},gc.prototype.Ae=function(){return ic},na(jc,gc),h=jc.prototype,h.se=function(a){return!a.B(this.Vb).e()},h.compare=function(a,b){var c=a.K.B(this.Vb),d=b.K.B(this.Vb),c=c.he(d);return 0===c?xb(a.name,b.name):c},h.ye=function(a,b){var c=J(a),c=K.I(this.Vb,c);return new I(b,c)},h.ze=function(){var a=K.I(this.Vb,kc);return new I("[MAX_NAME]",a)},h.toString=function(){return this.Vb};var L=new jc(".priority");na(lc,gc),h=lc.prototype,h.compare=function(a,b){return xb(a.name,b.name)},h.se=function(){throw ib("KeyIndex.isDefinedOn not expected to be called.")},h.df=function(){return!1},h.Ae=function(){return ic},h.ze=function(){return new I("[MAX_NAME]",K)},h.ye=function(a){return x(p(a),"KeyIndex indexValue must always be a string."),new I(a,K)},h.toString=function(){return".key"};var mc=new lc,oc=new nc;h=nc.prototype,h.ve=function(a){var b=uc(this);return b.ka=!0,b.xb=a,b.Hb="",b},h.we=function(a){var b=uc(this);return b.ka=!0,b.xb=a,b.Hb="l",b},h.xe=function(a){var b=uc(this);return b.ka=!0,b.xb=a,b.Hb="r",b},h.Md=function(a,b){var c=uc(this);return c.ga=!0,c.Bc=a,null!=b?(c.nc=!0,c.Xb=b):(c.nc=!1,c.Xb=""),c},h.md=function(a,b){var c=uc(this);return c.na=!0,c.Ac=a,n(b)?(c.yc=!0,c.Ub=b):(c.Dg=!1,c.Ub=""),c},M.prototype.hc=function(){return D("Query.ref",0,0,arguments.length),new O(this.g,this.path)},M.prototype.ref=M.prototype.hc,M.prototype.zb=function(a,b,c,d){D("Query.on",2,4,arguments.length),Xb("Query.on",a,!1),F("Query.on",2,b,!1);var e=Ac("Query.on",c,d);if("value"===a)Bc(this.g,this,new Ib(b,e.cancel||null,e.Ha||null));else{var f={};f[a]=b,Bc(this.g,this,new Jb(f,e.cancel,e.Ha))}return b},M.prototype.on=M.prototype.zb,M.prototype.bc=function(a,b,c){D("Query.off",0,3,arguments.length),Xb("Query.off",a,!0),F("Query.off",2,b,!0),Nb("Query.off",3,c);var d=null,e=null;"value"===a?d=new Ib(b||null,null,c||null):a&&(b&&(e={},e[a]=b),d=new Jb(e,null,c||null)),e=this.g,d=".info"===G(this.path)?e.ud.hb(this,d):e.M.hb(this,d),Cc(e.Z,this.path,d)},M.prototype.off=M.prototype.bc,M.prototype.gg=function(a,b){function c(g){f&&(f=!1,e.bc(a,c),b.call(d.Ha,g))}D("Query.once",2,4,arguments.length),Xb("Query.once",a,!1),F("Query.once",2,b,!1);var d=Ac("Query.once",arguments[2],arguments[3]),e=this,f=!0;this.zb(a,c,function(b){e.bc(a,c),d.cancel&&d.cancel.call(d.Ha,b)})},M.prototype.once=M.prototype.gg,M.prototype.ve=function(a){if(z("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),D("Query.limit",1,1,arguments.length),!ga(a)||Math.floor(a)!==a||0>=a)throw Error("Query.limit: First argument must be a positive integer.");if(this.w.ka)throw Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var b=this.w.ve(a);return yc(b),new M(this.g,this.path,b,this.dc)},M.prototype.limit=M.prototype.ve,M.prototype.we=function(a){if(D("Query.limitToFirst",1,1,arguments.length),!ga(a)||Math.floor(a)!==a||0>=a)throw Error("Query.limitToFirst: First argument must be a positive integer.");if(this.w.ka)throw Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new M(this.g,this.path,this.w.we(a),this.dc)},M.prototype.limitToFirst=M.prototype.we,M.prototype.xe=function(a){if(D("Query.limitToLast",1,1,arguments.length),!ga(a)||Math.floor(a)!==a||0>=a)throw Error("Query.limitToLast: First argument must be a positive integer.");if(this.w.ka)throw Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new M(this.g,this.path,this.w.xe(a),this.dc)},M.prototype.limitToLast=M.prototype.xe,M.prototype.hg=function(a){if(D("Query.orderByChild",1,1,arguments.length),"$key"===a)throw Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===a)throw Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');Yb("Query.orderByChild",1,a,!1),zc(this,"Query.orderByChild");var b=vc(this.w,new jc(a));return xc(b),new M(this.g,this.path,b,!0)},M.prototype.orderByChild=M.prototype.hg,M.prototype.ig=function(){D("Query.orderByKey",0,0,arguments.length),zc(this,"Query.orderByKey");var a=vc(this.w,mc);return xc(a),new M(this.g,this.path,a,!0)},M.prototype.orderByKey=M.prototype.ig,M.prototype.jg=function(){D("Query.orderByPriority",0,0,arguments.length),zc(this,"Query.orderByPriority");var a=vc(this.w,L);return xc(a),new M(this.g,this.path,a,!0)},M.prototype.orderByPriority=M.prototype.jg,M.prototype.Md=function(a,b){D("Query.startAt",0,2,arguments.length),Sb("Query.startAt",a,!0),Yb("Query.startAt",2,b,!0);var c=this.w.Md(a,b);if(yc(c),xc(c),this.w.ga)throw Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return n(a)||(b=a=null),new M(this.g,this.path,c,this.dc)},M.prototype.startAt=M.prototype.Md,M.prototype.md=function(a,b){D("Query.endAt",0,2,arguments.length),Sb("Query.endAt",a,!0),Yb("Query.endAt",2,b,!0);var c=this.w.md(a,b);if(yc(c),xc(c),this.w.na)throw Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new M(this.g,this.path,c,this.dc)},M.prototype.endAt=M.prototype.md,M.prototype.Of=function(a,b){if(D("Query.equalTo",1,2,arguments.length),Sb("Query.equalTo",a,!1),Yb("Query.equalTo",2,b,!0),this.w.ga)throw Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.w.na)throw Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.Md(a,b).md(a,b)},M.prototype.equalTo=M.prototype.Of,M.prototype.Da=function(){var a=Ab(Dc(this));return"{}"===a?"default":a},P.prototype.toString=function(){for(var a="",b=this.aa;b<this.n.length;b++)""!==this.n[b]&&(a+="/"+this.n[b]);return a||"/"},P.prototype.parent=function(){if(this.aa>=this.n.length)return null;for(var a=[],b=this.aa;b<this.n.length-1;b++)a.push(this.n[b]);return new P(a,0)},P.prototype.k=function(a){for(var b=[],c=this.aa;c<this.n.length;c++)b.push(this.n[c]);if(a instanceof P)for(c=a.aa;c<a.n.length;c++)b.push(a.n[c]);else for(a=a.split("/"),c=0;c<a.length;c++)0<a[c].length&&b.push(a[c]);return new P(b,0)},P.prototype.e=function(){return this.aa>=this.n.length};var S=new P("");P.prototype.ja=function(a){if(Q(this)!==Q(a))return!1;for(var b=this.aa,c=a.aa;b<=this.n.length;b++,c++)if(this.n[b]!==a.n[c])return!1;return!0},P.prototype.contains=function(a){var b=this.aa,c=a.aa;if(Q(this)>Q(a))return!1;for(;b<this.n.length;){if(this.n[b]!==a.n[c])return!1;++b,++c}return!0},h=Fc.prototype,h.ta=function(){return this.D.value},h.clear=function(){this.D.value=null,this.D.children={},this.D.dd=0,Ic(this)},h.pd=function(){return 0<this.D.dd},h.e=function(){return null===this.ta()&&!this.pd()},h.ca=function(a){var b=this;A(this.D.children,function(c,d){a(new Fc(d,b,c))})},h.path=function(){return new P(null===this.Oc?this.yd:this.Oc.path()+"/"+this.yd)},h.name=function(){return this.yd},h.parent=function(){return this.Oc},h=Lc.prototype,h.Ja=function(a,b){return new Lc(this.Ga,this.pa.Ja(a,b,this.Ga).W(null,null,!1,null,null))},h.remove=function(a){return new Lc(this.Ga,this.pa.remove(a,this.Ga).W(null,null,!1,null,null))},h.get=function(a){for(var b,c=this.pa;!c.e();){if(b=this.Ga(a,c.key),0===b)return c.value;0>b?c=c.left:b>0&&(c=c.right)}return null},h.e=function(){return this.pa.e()},h.count=function(){return this.pa.count()},h.Ic=function(){return this.pa.Ic()},h.Zb=function(){return this.pa.Zb()},h.Ba=function(a){return this.pa.Ba(a)},h.Aa=function(a){return new Oc(this.pa,null,this.Ga,!1,a)},h.rb=function(a,b){return new Oc(this.pa,a,this.Ga,!1,b)},h.Sb=function(a,b){return new Oc(this.pa,a,this.Ga,!0,b)},h.bf=function(a){return new Oc(this.pa,null,this.Ga,!0,a)},h=Pc.prototype,h.W=function(a,b,c,d,e){return new Pc(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)},h.count=function(){return this.left.count()+1+this.right.count()},h.e=function(){return!1},h.Ba=function(a){return this.left.Ba(a)||a(this.key,this.value)||this.right.Ba(a)},h.Ic=function(){return Qc(this).key},h.Zb=function(){return this.right.e()?this.key:this.right.Zb()},h.Ja=function(a,b,c){var d,e;return e=this,d=c(a,e.key),e=0>d?e.W(null,null,null,e.left.Ja(a,b,c),null):0===d?e.W(null,b,null,null,null):e.W(null,null,null,null,e.right.Ja(a,b,c)),Rc(e)},h.remove=function(a,b){var c,d;if(c=this,0>b(a,c.key))c.left.e()||c.left.$()||c.left.left.$()||(c=Tc(c)),c=c.W(null,null,null,c.left.remove(a,b),null);else{if(c.left.$()&&(c=Uc(c)),c.right.e()||c.right.$()||c.right.left.$()||(c=Vc(c),c.left.left.$()&&(c=Uc(c),c=Vc(c))),0===b(a,c.key)){if(c.right.e())return Mc;d=Qc(c.right),c=c.W(d.key,d.value,null,null,Sc(c.right))}c=c.W(null,null,null,null,c.right.remove(a,b))}return Rc(c)},h.$=function(){return this.color},h=Xc.prototype,h.W=function(){return this},h.Ja=function(a,b){return new Pc(a,b,null)},h.remove=function(){return this},h.count=function(){return 0},h.e=function(){return!0},h.Ba=function(){return!1},h.Ic=function(){return null},h.Zb=function(){return null},h.$=function(){return!1};var Mc=new Xc;h=Zc.prototype,h.P=function(){return!0},h.O=function(){return this.fa},h.ib=function(a){return new Zc(this.A,a)},h.B=function(a){return".priority"===a?this.fa:K},h.da=function(a){return a.e()?this:".priority"===G(a)?this.fa:K},h.Y=function(){return!1},h.af=function(){return null},h.I=function(a,b){return".priority"===a?this.ib(b):K.I(a,b).ib(this.fa)},h.L=function(a,b){var c=G(a);return null===c?b:(x(".priority"!==c||1===Q(a),".priority must be the last token in a path"),this.I(c,K.L(R(a),b)))},h.e=function(){return!1},h.Ua=function(){return 0},h.N=function(a){return a&&!this.O().e()?{".value":this.ta(),".priority":this.O().N()}:this.ta()},h.hash=function(){if(null===this.wb){var a="";this.fa.e()||(a+="priority:"+ad(this.fa.N())+":");var b=typeof this.A,a=a+(b+":"),a="number"===b?a+Db(this.A):a+this.A;this.wb=lb(a)}return this.wb},h.ta=function(){return this.A},h.he=function(a){if(a===K)return 1;if(a instanceof bd)return-1;x(a.P(),"Unknown node type");var b=typeof a.A,c=typeof this.A,d=Ia(cd,b),e=Ia(cd,c);return x(d>=0,"Unknown leaf type: "+b),x(e>=0,"Unknown leaf type: "+c),d===e?"object"===c?0:this.A<a.A?-1:this.A===a.A?0:1:e-d};var cd=["object","boolean","number","string"];Zc.prototype.Wd=function(){return this},Zc.prototype.Yb=function(){return!0},Zc.prototype.ja=function(a){return a===this?!0:a.P()?this.A===a.A&&this.fa.ja(a.fa):!1},Zc.prototype.toString=function(){return"string"==typeof this.A?this.A:'"'+this.A+'"'},dd.prototype.get=function(a){var b=v(this.td,a);if(!b)throw Error("No index defined for "+a);return b===hc?null:b};var id=new dd({".priority":hc},{".priority":L});h=bd.prototype,h.P=function(){return!1},h.O=function(){return this.fa||K},h.ib=function(a){return new bd(this.j,a,this.sb)},h.B=function(a){return".priority"===a?this.O():(a=this.j.get(a),null===a?K:a)},h.da=function(a){var b=G(a);return null===b?this:this.B(b).da(R(a))},h.Y=function(a){return null!==this.j.get(a)},h.I=function(a,b){if(x(b,"We should always be passing snapshot nodes"),".priority"===a)return this.ib(b);var d,c=new I(a,b);return b.e()?(d=this.j.remove(a),c=hd(this.sb,c,this.j)):(d=this.j.Ja(a,b),c=ed(this.sb,c,this.j)),new bd(d,this.fa,c)},h.L=function(a,b){var c=G(a);if(null===c)return b;x(".priority"!==G(a)||1===Q(a),".priority must be the last token in a path");var d=this.B(c).L(R(a),b);return this.I(c,d)},h.e=function(){return this.j.e()},h.Ua=function(){return this.j.count()};var jd=/^(0|[1-9]\d*)$/;h=bd.prototype,h.N=function(a){if(this.e())return null;var b={},c=0,d=0,e=!0;if(this.ca(L,function(f,g){b[f]=g.N(a),c++,e&&jd.test(f)?d=Math.max(d,Number(f)):e=!1}),!a&&e&&2*c>d){var g,f=[];for(g in b)f[g]=b[g];return f}return a&&!this.O().e()&&(b[".priority"]=this.O().N()),b},h.hash=function(){if(null===this.wb){var a="";this.O().e()||(a+="priority:"+ad(this.O().N())+":"),this.ca(L,function(b,c){var d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.wb=""===a?"":lb(a)}return this.wb},h.af=function(a,b,c){return(c=kd(this,c))?(a=Nc(c,new I(a,b)))?a.name:null:Nc(this.j,a)},h.ca=function(a,b){var c=kd(this,a);return c?c.Ba(function(a){return b(a.name,a.K)}):this.j.Ba(b)},h.Aa=function(a){return this.rb(a.Ae(),a)},h.rb=function(a,b){var c=kd(this,b);return c?c.rb(a,function(a){return a}):this.j.rb(a.name,Yc)},h.bf=function(a){return this.Sb(a.ze(),a)},h.Sb=function(a,b){var c=kd(this,b);return c?c.Sb(a,function(a){return a}):this.j.Sb(a.name,Yc)},h.he=function(a){return this.e()?a.e()?0:-1:a.P()||a.e()?1:a===kc?-1:0},h.Wd=function(a){if(a===mc||nd(this.sb.Wb,a.toString()))return this;var b=this.sb,c=this.j;x(a!==mc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var d=[],e=!1,c=c.Aa(Yc),f=U(c);f;)e=e||a.se(f.K),d.push(f),f=U(c);return d=e?gd(d,H(a)):hc,e=a.toString(),c=od(b.Wb),c[e]=a,a=od(b.td),a[e]=d,new bd(this.j,this.fa,new dd(a,c))},h.Yb=function(a){return a===mc||nd(this.sb.Wb,a.toString())},h.ja=function(a){if(a===this)return!0;if(a.P())return!1;if(this.O().ja(a.O())&&this.j.count()===a.j.count()){var b=this.Aa(L);a=a.Aa(L);for(var c=U(b),d=U(a);c&&d;){if(c.name!==d.name||!c.K.ja(d.K))return!1;c=U(b),d=U(a)}return null===c&&null===d}return!1},h.toString=function(){var a="{",b=!0;return this.ca(L,function(c,d){b?b=!1:a+=", ",a+='"'+c+'" : '+d.toString()}),a+="}"};var pd=Math.log(2),K=new bd(new Lc(fc),null,id);na(sd,bd),h=sd.prototype,h.he=function(a){return a===this?0:1},h.ja=function(a){return a===this},h.O=function(){throw ib("Why is this called?")},h.B=function(){return K},h.e=function(){return!1};var kc=new sd,ic=new I("[MIN_NAME]",K);C.prototype.N=function(){return D("Firebase.DataSnapshot.val",0,0,arguments.length),this.D.N()},C.prototype.val=C.prototype.N,C.prototype.Xe=function(){return D("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.D.N(!0)},C.prototype.exportVal=C.prototype.Xe,C.prototype.Qf=function(){return D("Firebase.DataSnapshot.exists",0,0,arguments.length),!this.D.e()},C.prototype.exists=C.prototype.Qf,C.prototype.k=function(a){D("Firebase.DataSnapshot.child",0,1,arguments.length),ga(a)&&(a=String(a)),Zb("Firebase.DataSnapshot.child",a);var b=new P(a),c=this.U.k(b);return new C(this.D.da(b),c,L)},C.prototype.child=C.prototype.k,C.prototype.Y=function(a){D("Firebase.DataSnapshot.hasChild",1,1,arguments.length),Zb("Firebase.DataSnapshot.hasChild",a);var b=new P(a);return!this.D.da(b).e()},C.prototype.hasChild=C.prototype.Y,C.prototype.O=function(){return D("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.D.O().N()},C.prototype.getPriority=C.prototype.O,C.prototype.forEach=function(a){if(D("Firebase.DataSnapshot.forEach",1,1,arguments.length),F("Firebase.DataSnapshot.forEach",1,a,!1),this.D.P())return!1;var b=this;return!!this.D.ca(this.m,function(c,d){return a(new C(d,b.U.k(c),L))})},C.prototype.forEach=C.prototype.forEach,C.prototype.pd=function(){return D("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),this.D.P()?!1:!this.D.e()},C.prototype.hasChildren=C.prototype.pd,C.prototype.name=function(){return z("Firebase.DataSnapshot.name() being deprecated. Please use Firebase.DataSnapshot.key() instead."),D("Firebase.DataSnapshot.name",0,0,arguments.length),this.key()},C.prototype.name=C.prototype.name,C.prototype.key=function(){return D("Firebase.DataSnapshot.key",0,0,arguments.length),this.U.key()},C.prototype.key=C.prototype.key,C.prototype.Ua=function(){return D("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.D.Ua()},C.prototype.numChildren=C.prototype.Ua,C.prototype.hc=function(){return D("Firebase.DataSnapshot.ref",0,0,arguments.length),this.U},C.prototype.ref=C.prototype.hc,td.prototype.Td=function(a){for(var c=this.Gc[a]||[],d=0;d<c.length;d++)c[d].sc.apply(c[d].Ha,Array.prototype.slice.call(arguments,1))},td.prototype.zb=function(a,b,c){ud(this,a),this.Gc[a]=this.Gc[a]||[],this.Gc[a].push({sc:b,Ha:c}),(a=this.pe(a))&&b.apply(c,a)},td.prototype.bc=function(a,b,c){ud(this,a),a=this.Gc[a]||[];for(var d=0;d<a.length;d++)if(a[d].sc===b&&(!c||c===a[d].Ha)){a.splice(d,1);break}},na(vd,td),ca(vd),vd.prototype.pe=function(a){return x("visible"===a,"Unknown event type: "+a),[this.qc]},na(wd,td),ca(wd),wd.prototype.pe=function(a){return x("online"===a,"Unknown event type: "+a),[this.Lc]};var Dd="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");Fd.prototype.get=function(){return od(this.wc)},Hd.prototype.get=function(){var a=this.Kf.get(),b=od(a);if(this.vd)for(var c in this.vd)b[c]-=this.vd[c];return this.vd=a,b},Id.prototype.nf=function(){var d,a=this.Nd.get(),b={},c=!1;for(d in a)0<a[d]&&u(this.uf,d)&&(b[d]=a[d],c=!0);c&&(a=this.S,a.ia&&(b={c:b},a.f("reportStats",b),a.wa("s",b))),setTimeout(q(this.nf,this),Math.floor(6e5*Math.random()))};var Jd={},Kd={},Nd=null;"undefined"!=typeof MozWebSocket?Nd=MozWebSocket:"undefined"!=typeof WebSocket&&(Nd=WebSocket);var Pd;Od.prototype.open=function(a,b){this.fb=b,this.cg=a,this.f("Websocket connecting to "+this.Za),this.zc=!1,Aa.set("previous_websocket_failure",!0);try{this.oa=new Nd(this.Za)}catch(c){this.f("Error instantiating WebSocket.");var d=c.message||c.data;return d&&this.f(d),this.eb(),void 0}var e=this;this.oa.onopen=function(){e.f("Websocket connected."),e.zc=!0},this.oa.onclose=function(){e.f("Websocket connection was disconnected."),e.oa=null,e.eb()},this.oa.onmessage=function(a){if(null!==e.oa)if(a=a.data,e.kb+=a.length,Gd(e.Qa,"bytes_received",a.length),Qd(e),null!==e.frames)Rd(e,a);else{a:{if(x(null===e.frames,"We already have a frame buffer"),6>=a.length){var b=Number(a);if(!isNaN(b)){e.Oe=b,e.frames=[],a=null;break a}}e.Oe=1,e.frames=[]}null!==a&&Rd(e,a)}},this.oa.onerror=function(a){e.f("WebSocket error.  Closing connection."),(a=a.message||a.data)&&e.f(a),e.eb()}},Od.prototype.start=function(){},Od.isAvailable=function(){var a=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&1<b.length&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==Nd&&!Pd},Od.responsesRequiredToBeHealthy=2,Od.healthyTimeout=3e4,h=Od.prototype,h.wd=function(){Aa.remove("previous_websocket_failure")},h.send=function(a){Qd(this),a=t(a),this.lb+=a.length,Gd(this.Qa,"bytes_sent",a.length),a=Bb(a,16384),1<a.length&&this.oa.send(String(a.length));for(var b=0;b<a.length;b++)this.oa.send(a[b])},h.Yc=function(){this.ub=!0,this.Cc&&(clearInterval(this.Cc),this.Cc=null),this.oa&&(this.oa.close(),this.oa=null)},h.eb=function(){this.ub||(this.f("WebSocket is closing itself"),this.Yc(),this.fb&&(this.fb(this.zc),this.fb=null))},h.close=function(){this.ub||(this.f("WebSocket is being closed"),this.Yc())},h=Vd.prototype,h.add=function(a,b){this.set[a]=null!==b?b:!0},h.contains=function(a){return u(this.set,a)},h.get=function(a){return this.contains(a)?this.set[a]:void 0},h.remove=function(a){delete this.set[a]},h.clear=function(){this.set={}},h.e=function(){return Bd(this.set)},h.count=function(){return Kb(this.set)};var Yd,Zd;Xd.prototype.open=function(a,b){this.Ue=0,this.ea=b,this.gf=new Sd(a),this.ub=!1;var c=this;this.ob=setTimeout(function(){c.f("Timed out trying to connect."),c.eb(),c.ob=null},Math.floor(3e4)),wb(function(){if(!c.ub){c.Na=new $d(function(a,b,d){if(ae(c,arguments),c.Na)if(c.ob&&(clearTimeout(c.ob),c.ob=null),c.zc=!0,"start"==a)c.id=b,c.mf=d;else{if("close"!==a)throw Error("Unrecognized command received: "+a);b?(c.Na.Jd=!1,Td(c.gf,b,function(){c.eb()})):c.eb()}},function(a,b){ae(c,arguments),Ud(c.gf,a,b)},function(){c.eb()},c.bd);var a={start:"t"};a.ser=Math.floor(1e8*Math.random()),c.Na.Ud&&(a.cb=c.Na.Ud),a.v="5",c.Kd&&(a.s=c.Kd),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(a.r="f"),a=c.bd(a),c.f("Connecting via long-poll to "+a),be(c.Na,a,function(){})}})},Xd.prototype.start=function(){var a=this.Na,b=this.mf;for(a.Xf=this.id,a.Yf=b,a.Zd=!0;ce(a););a=this.id,b=this.mf,this.$b=document.createElement("iframe");var c={dframe:"t"};c.id=a,c.pw=b,this.$b.src=this.bd(c),this.$b.style.display="none",document.body.appendChild(this.$b)},Xd.isAvailable=function(){return!(Zd||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.zg)},h=Xd.prototype,h.wd=function(){},h.Yc=function(){this.ub=!0,this.Na&&(this.Na.close(),this.Na=null),this.$b&&(document.body.removeChild(this.$b),this.$b=null),this.ob&&(clearTimeout(this.ob),this.ob=null)},h.eb=function(){this.ub||(this.f("Longpoll is closing itself"),this.Yc(),this.ea&&(this.ea(this.zc),this.ea=null))},h.close=function(){this.ub||(this.f("Longpoll is being closed."),this.Yc())},h.send=function(a){a=t(a),this.lb+=a.length,Gd(this.Qa,"bytes_sent",a.length),a=mb(a),a=fb(a,!0),a=Bb(a,1840);for(var b=0;b<a.length;b++){var c=this.Na;c.Qc.push({og:this.Ue,wg:a.length,We:a[b]}),c.Zd&&ce(c),this.Ue++}},$d.prototype.close=function(){if(this.Zd=!1,this.va){this.va.$a.body.innerHTML="";var a=this;setTimeout(function(){null!==a.va&&(document.body.removeChild(a.va),a.va=null)},Math.floor(0))}var b=this.fb;b&&(this.fb=null,b())};var ge=[Xd,Od];ie.prototype.wa=function(a){te(this,{t:"d",d:a})},ie.prototype.Bd=function(a){qe(this),this.cc(a)},ie.prototype.close=function(){2!==this.Pa&&(this.f("Closing realtime connection."),this.Pa=2,pe(this),this.ea&&(this.ea(),this.ea=null))};var ye=0,Ae=0;h=xe.prototype,h.wa=function(a,b,c){var d=++this.ng;a={r:d,a:a,b:b},this.f(t(a)),x(this.ia,"sendRequest call when we're not connected not allowed."),this.La.wa(a),c&&(this.Tc[d]=c)},h.T=function(a,b,c){this.Lb={Mf:a,Ye:!1,sc:b,cd:c},this.f("Authenticating using credential: "+a),Ee(this),(b=40==a.length)||(a=ue(a).fe,b="object"==typeof a&&!0===v(a,"admin")),b&&(this.f("Admin auth credential detected.  Reducing max reconnect time."),this.xd=3e4)},h.Pe=function(a){delete this.Lb,this.ia&&this.wa("unauth",{},function(b){a(b.s,b.d)})},h.Ce=function(a,b){this.ia?Ge(this,"oc",a,null,b):this.Jc.push({Pc:a,action:"oc",data:null,H:b})},h.put=function(a,b,c,d){Ie(this,"p",a,b,c,d)},h.Bd=function(a){if("r"in a){this.f("from server: "+t(a));var b=a.r,c=this.Tc[b];c&&(delete this.Tc[b],c(a.b))}else{if("error"in a)throw"A server-side error has occurred: "+a.error;"a"in a&&(b=a.a,c=a.b,this.f("handleServerMessage",b,c),"d"===b?this.Cd(c.p,c.d,!1,c.t):"m"===b?this.Cd(c.p,c.d,!0,c.t):"c"===b?Me(this,c.p,c.q):"ac"===b?(a=c.s,b=c.d,c=this.Lb,delete this.Lb,c&&c.cd&&c.cd(a,b)):"sd"===b?this.Ke?this.Ke(c):"msg"in c&&"undefined"!=typeof console&&console.log("FIREBASE: "+c.msg.replace("\n","\nFIREBASE: ")):sb("Unrecognized action received from server: "+t(b)+"\nAre you using the latest client?"))}},h.Kc=function(a){this.f("connection ready"),this.ia=!0,this.Dc=(new Date).getTime(),this.Ee({serverTimeOffset:a-(new Date).getTime()}),Ne(this),this.Ad(!0)},h.fg=function(a){a&&!this.qc&&this.Va===this.xd&&(this.f("Window became visible.  Reducing delay."),this.Va=1e3,this.La||ze(this,0)),this.qc=a},h.dg=function(a){a?(this.f("Browser went online.  Reconnecting."),this.Va=1e3,this.Eb=!0,this.La||ze(this,0)):(this.f("Browser went offline.  Killing connection; don't reconnect."),this.Eb=!1,this.La&&this.La.close())},h.jf=function(){this.f("data client disconnected"),this.ia=!1,this.La=null;for(var a=0;a<this.la.length;a++){var b=this.la[a];b&&"h"in b.of&&b.lg&&(b.H&&b.H("disconnect"),delete this.la[a],this.Nc--)}if(0===this.Nc&&(this.la=[]),this.Eb)this.qc?this.Dc&&(3e4<(new Date).getTime()-this.Dc&&(this.Va=1e3),this.Dc=null):(this.f("Window isn't visible.  Delaying reconnect."),this.Va=this.xd,this.ue=(new Date).getTime()),a=Math.max(0,this.Va-((new Date).getTime()-this.ue)),a*=Math.random(),this.f("Trying to reconnect in "+a+"ms"),ze(this,a),this.Va=Math.min(this.xd,1.3*this.Va);else for(var c in this.Tc)delete this.Tc[c];this.Ad(!1)},h.tb=function(){this.Eb=!1,this.La?this.La.close():(this.Nb&&(clearTimeout(this.Nb),this.Nb=null),this.ia&&this.jf())},h.kc=function(){this.Eb=!0,this.Va=1e3,this.La||ze(this,0)},Pe.prototype.ic=function(a,b){if(a.e())this.A=b,this.j=null;else if(null!==this.A)this.A=this.A.L(a,b);else{null==this.j&&(this.j=new Vd);var c=G(a);this.j.contains(c)||this.j.add(c,new Pe),c=this.j.get(c),a=R(a),c.ic(a,b)}},Pe.prototype.ca=function(a){null!==this.j&&Wd(this.j,function(b,c){a(b,c)})},Se.prototype.toString=function(){return this.Wc.toString()},Ve.prototype.add=function(a){this.od.push(a)},Ve.prototype.Rb=function(){return this.Ca};var Ye="auth.firebase.com",$e=["remember","redirectTo"],bf={NETWORK_ERROR:"Unable to contact the Firebase server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."};mf.prototype.open=function(a,b,c){function d(){c&&(c(V("REQUEST_INTERRUPTED")),c=null)}var g,e=new XMLHttpRequest,f=this.options.method.toUpperCase();if(df(window,"beforeunload",d),e.onreadystatechange=function(){if(c&&4===e.readyState){var a;if(200<=e.status&&300>e.status){try{a=ua(e.responseText)}catch(b){}c(null,a)}else 500<=e.status&&600>e.status?c(V("SERVER_ERROR")):c(V("NETWORK_ERROR"));c=null,ef(window,"beforeunload",d)}},"GET"===f)a+=(/\?/.test(a)?"":"?")+hf(b),g=null;else{var k=this.options.headers.content_type;"application/json"===k&&(g=t(b)),"application/x-www-form-urlencoded"===k&&(g=hf(b))}e.open(f,a,!0),a={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"},Ed(a,this.options.headers);for(var l in a)e.setRequestHeader(l,a[l]);e.send(g)},mf.isAvailable=function(){return!!window.XMLHttpRequest&&"string"==typeof(new XMLHttpRequest).responseType&&(!(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/))||lf())},mf.prototype.uc=function(){return"json"},nf.prototype.open=function(a,b,c){function d(){c&&(c(V("USER_CANCELLED")),c=null)}var g,e=this,f=ub(Ye);b.requestId=this.Uc,b.redirectTo=f.scheme+"://"+f.host+"/blank/page.html",a+=/\?/.test(a)?"":"?",a+=hf(b),(g=window.open(a,"_blank","location=no"))&&ha(g.addEventListener)?(g.addEventListener("loadstart",function(a){var b;if(b=a&&a.url)a:{var f=a.url;try{var r=document.createElement("a");r.href=f,b=r.host===ub(Ye).host&&"/blank/page.html"===r.pathname;break a}catch(s){}b=!1}b&&(a=gf(a.url),g.removeEventListener("exit",d),g.close(),a=new Ze(null,null,{requestId:e.Uc,requestKey:a}),e.kf.requestWithCredential("/auth/session",a,c),c=null)}),g.addEventListener("exit",d)):c(V("TRANSPORT_UNAVAILABLE"))},nf.isAvailable=function(){return kf()},nf.prototype.uc=function(){return"redirect"},of.prototype.open=function(a,b,c){function d(a){if(g&&(document.body.removeChild(g),g=void 0),r&&(r=clearInterval(r)),ef(window,"message",e),ef(window,"unload",d),m&&!a)try{m.close()}catch(b){k.postMessage("die",l)}m=k=void 0}function e(a){if(a.origin===l)try{var b=ua(a.data);"ready"===b.a?k.postMessage(s,l):"error"===b.a?(d(!1),c&&(c(b.d),c=null)):"response"===b.a&&(d(b.forceKeepWindowOpen),c&&(c(null,b.d),c=null))}catch(e){}}var g,k,f=lf(),l=ff(a);if(l!==ff(this.options.relay_url))c&&setTimeout(function(){c(Error("invalid arguments: origin of url and relay_url must match"))},0);else{f&&(g=document.createElement("iframe"),g.setAttribute("src",this.options.relay_url),g.style.display="none",g.setAttribute("name","__winchan_relay_frame"),document.body.appendChild(g),k=g.contentWindow),a+=(/\?/.test(a)?"":"?")+hf(b);var m=window.open(a,this.options.window_name,this.options.window_features);k||(k=m);var r=setInterval(function(){m&&m.closed&&(d(!1),c&&(c(V("USER_CANCELLED")),c=null))},500),s=t({a:"request",d:b});df(window,"unload",d),df(window,"message",e)}},of.isAvailable=function(){return"postMessage"in window&&!/^file:\//.test(location.href)&&!(kf()||navigator.userAgent.match(/Windows Phone/)||window.Windows&&/^ms-appx:/.test(location.href)||navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||navigator.userAgent.match(/CriOS/)||navigator.userAgent.match(/Twitter for iPhone/)||navigator.userAgent.match(/FBAN\/FBIOS/)||window.navigator.standalone)&&!navigator.userAgent.match(/PhantomJS/)},of.prototype.uc=function(){return"popup"},pf.prototype.open=function(a,b,c){function d(){c&&(c(V("REQUEST_INTERRUPTED")),c=null)}function e(){setTimeout(function(){window.__firebase_auth_jsonp[f]=void 0,Bd(window.__firebase_auth_jsonp)&&(window.__firebase_auth_jsonp=void 0);try{var a=document.getElementById(f);a&&a.parentNode.removeChild(a)}catch(b){}},1),ef(window,"beforeunload",d)}var f="fn"+(new Date).getTime()+Math.floor(99999*Math.random());b[this.options.callback_parameter]="__firebase_auth_jsonp."+f,a+=(/\?/.test(a)?"":"?")+hf(b),df(window,"beforeunload",d),window.__firebase_auth_jsonp[f]=function(a){c&&(c(null,a),c=null),e()},qf(f,a,c)},pf.isAvailable=function(){return!kf()},pf.prototype.uc=function(){return"json"},rf.prototype.set=function(a,b){if(!b){if(!this.Pd.length)throw Error("fb.login.SessionManager : No storage options available!");b=this.Pd[0]}b.set(this.Ge,a)},rf.prototype.get=function(){var a=La(this.Pd,q(this.Tf,this)),a=Ka(a,function(a){return null!==a});return Ta(a,function(a,c){return ve(c.token)-ve(a.token)}),0<a.length?a.shift():null},rf.prototype.Tf=function(a){try{var b=a.get(this.Ge);if(b&&b.token)return b}catch(c){}return null},rf.prototype.clear=function(){var a=this;Ja(this.Pd,function(b){b.remove(a.Ge)})},sf.prototype.open=function(a,b){Ba.set("redirect_request_id",this.Uc),b.requestId=this.Uc,b.redirectTo=b.redirectTo||window.location.href,a+=(/\?/.test(a)?"":"?")+hf(b),window.location=a},sf.isAvailable=function(){return!/^file:\//.test(location.href)&&!kf()},sf.prototype.uc=function(){return"redirect"},na(tf,td),h=tf.prototype,h.ne=function(){return this.jb||null},h.je=function(a,b){Cf(this);var c=af(a);c.lc._method="POST",this.Vc("/users",c,function(a,c){a?B(b,a):B(b,a,c)})},h.Ie=function(a,b){var c=this;Cf(this);var d="/users/"+encodeURIComponent(a.email),e=af(a);e.lc._method="DELETE",this.Vc(d,e,function(a,d){!a&&d&&d.uid&&c.jb&&c.jb.uid&&c.jb.uid===d.uid&&Af(c),B(b,a)})},h.ee=function(a,b){Cf(this);var c="/users/"+encodeURIComponent(a.email)+"/password",d=af(a);d.lc._method="PUT",d.lc.password=a.newPassword,this.Vc(c,d,function(a){B(b,a)})},h.Je=function(a,b){Cf(this);var c="/users/"+encodeURIComponent(a.email)+"/password",d=af(a);d.lc._method="POST",this.Vc(c,d,function(a){B(b,a)})},h.Vc=function(a,b,c){Ff(this,[mf,pf],a,b,c)},h.pe=function(a){return x("auth_status"===a,'initial event must be of type "auth_status"'),[this.jb]};var Kf=new Jf;Jf.prototype.kd=function(a,b,c,d){return(a=X(a))?a.Y(c)?(a=a.B(c),c=a.ja(d)?[]:d.e()?[new W("child_removed",a,c)]:[new W("child_changed",d,c,a)]):c=d.e()?[]:[new W("child_added",d,c)]:c=d.e()?[]:[new W("child_added",d,c)],0<c.length&&b.u&&c.push(new W("value",X(b))),c},na(Of,Jf),Of.prototype.kd=function(a,b,c,d){var e=X(a)||K,f=X(b)||K;if(e.Ua()<this.bb||f.Ua()<this.bb)return Of.oc.kd.call(this,a,b,c,d);x(!e.P()&&!f.P(),"If it's a leaf node, we should have hit the above case."),a=[];var g=e.B(c);return g.e()?f.Y(c)&&(e=this.Ma?ld(e,this.m):md(e,this.m),a.push(new W("child_removed",e.K,e.name)),a.push(new W("child_added",d,c))):f.Y(c)?d.ja(g)||a.push(new W("child_changed",d,c,e.B(c))):(a.push(new W("child_removed",g,c)),e=this.Ma?ld(f,this.m):md(f,this.m),a.push(new W("child_added",e.K,e.name))),0<a.length&&b.u&&a.push(new W("value",f)),a},h=Pf.prototype,h.Xa=function(a,b,c,d){var e;if(b.type===Qf)return b.source.$e?this.Fa(a,b.path,b.Oa,c,d):(x(b.source.Ze,"Unknown source."),e=b.source.wf,this.Sa(a,b.path,b.Oa,c,d,e));
if(b.type===Rf)return b.source.$e?this.ae(a,b.path,b.children,c,d):(x(b.source.Ze,"Unknown source."),e=b.source.wf,this.$d(a,b.path,b.children,c,d,e));if(b.type===Sf){if(b.sf)a:{var f=b.path;if(Tf(this,a),b=a.u,e=a.X,a.F){x(a.u,"Must have event snap if we have server snap");var g=c.Ya(f,a.u,a.F);if(g){if(b=a.u.L(f,g),!f.e()){e=G(f),b=b.B(e),a=this.Ra(a,e,b,a.F,a.o,c,d);break a}b=this.G(b)}}else if(a.o)a.u?(d=c.Ob())?b=this.G(d):(c=c.Ya(f,a.u,a.o))&&(b=this.G(b.L(f,c))):(x(a.X,"We must at least have complete children"),x(!f.e(),"If the path were empty, we would have an event snap from the set"),(c=c.Ya(f,a.X,a.o))&&(e=a.X.L(f,c),e=this.G(e)));else if(a.u)(c=c.Ob())&&(b=this.G(c));else if(a.X){if(x(!f.e(),"If the path was empty, we would have an event snap"),g=G(f),a.X.Y(g)){a=(b=c.Ib.Ob(c.Gb.k(g)))?this.Ra(a,g,b,a.F,a.o,c,d):this.Ra(a,g,K,a.F,a.o,c,null);break a}x(1<Q(f),"Must be a deep set being reverted")}a=new Uf(a.F,a.o,b,e)}else a=this.Ea(a,b.path,c,d);return a}if(b.type===Vf)return b=b.path,Tf(this,a),this.Sa(a,b,(a.ab()||K).da(b),c,d,!1);throw ib("Unknown operation type: "+b.type)},h.Fa=function(a,b,c,d,e){if(Tf(this,a),b.e())return b=this.G(c),new Uf(a.F,a.o,b,null);var f=X(a)||K,g=G(b);return 1===Q(b)||a.u||f.Y(g)?(c=f.B(G(b)).L(R(b),c),this.Ra(a,G(b),c,a.F,a.o,d,e)):a},h.ae=function(a,b,c,d,e){Tf(this,a);var f=this,g=a;return Xf(c,function(c,l){var m=b.k(c);Yf(a,G(m))&&(g=f.Fa(g,m,l,d,e))}),Xf(c,function(c,l){var m=b.k(c);Yf(a,G(m))||(g=f.Fa(g,m,l,d,e))}),g},h.Ea=function(a,b,c,d){var g,e=a.u,f=a.X;if(Tf(this,a),a.F){x(e,"If we have a server snap, we must have an event snap");var k=c.Ya(b,a.u,a.F);if(k){if(!b.e())return g=G(b),b=e.L(b,k).B(g),this.Ra(a,g,b,a.F,a.o,c,d);e=this.G(k)}}else if(a.o)if(e){var l=!1;a.o.ca(L,function(a,b){l||e.B(a).ja(b)||(l=!0),l&&(e=e.I(a,b))}),l&&(e=this.G(e))}else if(f&&(x(0<Q(b),"If it were an empty path, we would have an event snap"),g=G(b),1===Q(b)||f.Y(g))&&(k=c.Ya(b,f,a.o)))return b=f.L(b,k).B(g),this.Ra(a,g,b,a.F,a.o,c,d);return new Uf(a.F,a.o,e,f)},h.Sa=function(a,b,c,d,e,f){var g;Tf(this,a);var k=a.F,l=a.o;if(a.F)k=b.e()?this.G(c,f):this.G(a.F.L(b,c),f);else if(b.e())k=this.G(c,f),l=null;else if(1!==Q(b)||!a.o&&c.e()){if(a.o&&(g=G(b),a.o.Y(g)))var m=a.o.B(g).L(R(b),c),l=this.G(a.o.I(g,m),f)}else l=a.o||this.Ia(K),l=this.G(l.L(b,c),f);if(g=!1,f=a.u,m=a.X,k!==a.F||l!==a.o)if(k&&!f)f=this.G(d.xa(k)),m=null;else if(k&&f&&!c.e()&&k.da(b).ja(f.da(b)))g=!0;else if(c=d.Ya(b,f,k||l)){if(!b.e()){g=G(b),b=R(b);a:{if(f=g,a.u)m=a.u.B(f);else if(a.X)a.X.Y(f)?m=a.X.B(f):(x(b.e(),"According to precondition, this must be true"),m=K);else{if(b.e()){m=c;break a}x(a.F||a.o,"If we do not have event data, we must have server data"),m=(a.F||a.o).B(f)}m=m.e()&&a.ab()?a.ab().B(f).L(b,c):m.L(b,c)}return this.Ra(a,g,m,k,l,d,e)}f=this.G(c),m=null}else g=!0;return x(!g||f===a.u&&m===a.X,"We thought we could skip diffing, but we changed the eventCache."),new Uf(k,l,f,m)},h.$d=function(a,b,c,d,e,f){if(!a.F&&!a.o&&b.e())return a;Tf(this,a);var g=this,k=a;return Xf(c,function(c,m){var r=b.k(c);Yf(a,G(r))&&(k=g.Sa(k,r,m,d,e,f))}),Xf(c,function(c,m){var r=b.k(c);Yf(a,G(r))||(k=g.Sa(k,r,m,d,e,f))}),k},h.Ra=function(a,b,c,d,e){var f=a.u;return a=a.X,f?f=this.G(f.I(b,c)):(a||(a=this.Ia(K)),a=this.G(a.I(b,c))),new Uf(d,e,f,a)},h.G=function(a){return this.Ia(a)},na(Zf,Pf),Zf.prototype.Ia=function(a){return a.Wd(this.index)},Zf.prototype.Yb=function(a){return a.Yb(this.index)},Zf.prototype.G=function(a,b){if(!1===b)return Zf.oc.G.call(this,a,!1);if(a.P())return this.Ia(K);for(var c=this.Ia(a),d=this.Fb,e=this.pb,f=H(this.index),g=c.Aa(this.index),k=U(g);k&&0<f(d,k);)c=c.I(k.name,K),k=U(g);for(g=c.rb(e,this.index),(k=U(g))&&0>=f(k,e)&&(k=U(g));k;)c=c.I(k.name,K),k=U(g);return c},Zf.prototype.Fa=function(a,b,c,d,e){if(Tf(this,a),1<Q(b)){var f=G(b);if((null!==X(a)?X(a):K).Y(f))return Zf.oc.Fa.call(this,a,b,c,d,e);var g=null!==e?e:a.ab(),g=null!==g&&g.Y(f)?g.B(f):null,g=d.k(f).xa(g);return null!==g?(b=g.L(R(b),c),this.Ra(a,f,b,a.F,a.o,d,e)):a}return Zf.oc.Fa.call(this,a,b,c,d,e)},na($f,Zf),$f.prototype.G=function(a,b){if(!1===b)return $f.oc.G.call(this,a,!1);if(a.P())return this.Ia(K);var d,e,f,g,c=this.Ia(a);if(2*this.bb<a.Ua())for(d=this.Ia(K.ib(a.O())),c=this.Ma?c.Sb(this.pb,this.index):c.rb(this.Fb,this.index),e=U(c),f=0;e&&f<this.bb&&(g=this.Ma?0>=H(this.index)(this.Fb,e):0>=H(this.index)(e,this.pb));)d=d.I(e.name,e.K),f++,e=U(c);else{d=this.Ia(a);var k,l,m=H(this.index);if(this.Ma){c=c.bf(this.index),k=this.pb,l=this.Fb;var r=m,m=function(a,b){return-1*r(a,b)}}else c=c.Aa(this.index),k=this.Fb,l=this.pb;f=0;var s=!1;for(e=U(c);e;)!s&&0>=m(k,e)&&(s=!0),(g=s&&f<this.bb&&0>=m(e,l))?f++:d=d.I(e.name,K),e=U(c)}return d},$f.prototype.Ra=function(a,b,c,d,e,f,g){var k=X(a);return!k||k.Ua()<this.bb?$f.oc.Ra.call(this,a,b,c,d,e,f,g):(b=ag(this,a,b,c,f,g||d))?a.u?new Uf(d,e,b,null):new Uf(d,e,null,b):new Uf(d,e,a.u,a.X)},na(bg,Pf),bg.prototype.Ia=function(a){return a.Wd(this.m)},bg.prototype.Yb=function(a){return a.Yb(this.m)},cg.prototype.Lf=function(a,b){if(null==a.nb||null==b.nb)throw ib("Should only compare child_ events.");return this.m.compare(new I(a.nb,a.Wa),new I(b.nb,b.Wa))},h=gg.prototype,h.ab=function(){return this.ha.ab()},h.za=function(a){var b=this.ha.za();return b&&(wc(this.U.w)||!a.e()&&!b.B(G(a)).e())?b.da(a):null},h.e=function(){return 0===this.ya.length},h.Jb=function(a){this.ya.push(a)},h.hb=function(a,b){var c=[];if(b){x(null==a,"A cancel should cancel all event registrations.");var d=this.U.path;Ja(this.ya,function(a){(a=a.Te(b,d))&&c.push(a)})}if(a){for(var e=[],f=0;f<this.ya.length;++f){var g=this.ya[f];if(g.matches(a)){if(a.cf()){e=e.concat(this.ya.slice(f+1));break}}else e.push(g)}this.ya=e}else this.ya=[];return c},h.Xa=function(a,b,c){a.type===Rf&&null!==a.source.fc&&(x(this.ha.za(),"We should always have a full cache before handling merges"),x(!!this.ha.u,"Missing event cache, even though we have a server cache"));var d=this.ha;return b=this.ec.Xa(d,a,b,c),Tf(this.ec,b),this.ha=b,X(b)!==X(d)?(a=Lf(this.ld,d,b,a.path),d=X(b),dg(this.le,a,d,this.ya)):b.u&&!d.u?(x(X(b)===X(d),"Caches should be the same."),d=X(b),dg(this.le,[new W("value",d)],d,this.ya)):[]},Uf.prototype.ab=function(){return this.F||this.o},Uf.prototype.za=function(){return this.F};var ig=new Uf(null,null,null,null),kg=new Lc(function(a,b){return a===b?0:b>a?-1:1}),lg=new jg(null);h=jg.prototype,h.e=function(){return null===this.value&&this.children.e()},h.subtree=function(a){if(a.e())return this;var b=this.children.get(G(a));return null!==b?b.subtree(R(a)):lg},h.set=function(a,b){if(a.e())return new jg(b,this.children);var c=G(a),d=(this.children.get(c)||lg).set(R(a),b),c=this.children.Ja(c,d);return new jg(this.value,c)},h.remove=function(a){if(a.e())return this.children.e()?lg:new jg(null,this.children);var b=G(a),c=this.children.get(b);return c?(a=c.remove(R(a)),b=a.e()?this.children.remove(b):this.children.Ja(b,a),null===this.value&&b.e()?lg:new jg(this.value,b)):this},h.get=function(a){if(a.e())return this.value;var b=this.children.get(G(a));return b?b.get(R(a)):null},h=yg.prototype,h.e=function(){return Bd(this.qa)},h.Xa=function(a,b,c){var d=a.source.fc;if(null!==d)return d=v(this.qa,d),x(null!=d,"SyncTree gave us an op for an invalid query."),d.Xa(a,b,c);var e=[];return A(this.qa,function(d){e=e.concat(d.Xa(a,b,c))}),e},h.Jb=function(a,b,c,d,e){var f=a.Da(),g=v(this.qa,f);return g||(c=(g=c.xa(d))?null:c.ce(e),d=new Uf(d,e,g,c),g=new gg(a,d),this.qa[f]=g),g.Jb(b),a=g,(f=X(a.ha))?(d=Lf(a.ld,ig,a.ha,S),b=dg(a.le,d,f,b?[b]:a.ya)):b=[],b},h.hb=function(a,b,c){var d=a.Da(),e=[],f=[],g=null!=zg(this);if("default"===d){var k=this;A(this.qa,function(a,d){f=f.concat(a.hb(b,c)),a.e()&&(delete k.qa[d],wc(a.U.w)||e.push(a.U))})}else{var l=v(this.qa,d);l&&(f=f.concat(l.hb(b,c)),l.e()&&(delete this.qa[d],wc(l.U.w)||e.push(l.U)))}return g&&null==zg(this)&&e.push(new O(a.g,a.path)),{mg:e,Pf:f}},h.za=function(a){var b=null;return A(this.qa,function(c){b=b||c.za(a)}),b},h=Cg.prototype,h.Ob=function(a){var b=og(this.V,a);if(b){var c=b.value;return a=T(b.path,a),c.da(a)}return null},h.xa=function(a,b,c,d){var e,f;return c||d?(e=this.V.subtree(a),!d&&e.e()?b:d||null!==b||null!==e.value?(e=Gg(this.ra,function(b){return!(!b.visible&&!d||c&&0<=Ia(c,b.Xd)||!b.path.contains(a)&&!a.contains(b.path))},a),f=b||K,Xf(e,function(a,b){f=f.L(a,b)}),f):null):(e=og(this.V,a))?(b=T(e.path,a),e.value.da(b)):(e=this.V.subtree(a),e.e()?b:b||e.value?(f=b||K,Xf(e,function(a,b){f=f.L(a,b)}),f):null)},h.ce=function(a,b){var c=!1,d=K,e=this.Ob(a);return e?(e.P()||e.ca(L,function(a,b){d=d.I(a,b)}),d):b?(d=b,xg(this.V.subtree(a),function(a,b){d=d.I(a,b)}),d):(xg(this.V.subtree(a),function(a,b){c=!0,d=d.I(a,b)}),c?d:null)},h.Ya=function(a,b,c,d){if(x(c||d,"Either existingEventSnap or existingServerSnap must exist"),a=a.k(b),og(this.V,a))return null;if(a=this.V.subtree(a),a.e())return d.da(b);var e=d.da(b);return Xf(a,function(a,b){e=e.L(a,b)}),e},h.de=function(a,b,c,d,e,f){var g;if(a=this.V.subtree(a),a.value?g=a.value:b&&(g=b,Xf(a,function(a,b){g=g.L(a,b)})),g){for(b=[],g=g.Wd(f),a=H(f),e=e?g.Sb(c,f):g.rb(c,f),f=U(e);f&&b.length<d;)0!==a(f,c)&&b.push(f),f=U(e);return b}return[]},h=Kg.prototype,h.Ob=function(){return this.Ib.Ob(this.Gb)},h.xa=function(a,b,c){return this.Ib.xa(this.Gb,a,b,c)},h.ce=function(a){return this.Ib.ce(this.Gb,a)},h.Ya=function(a,b,c){return this.Ib.Ya(this.Gb,a,b,c)},h.de=function(a,b,c,d,e){return this.Ib.de(this.Gb,a,b,c,d,e)},h.k=function(a){return new Kg(this.Gb.k(a),this.Ib)},Lg.prototype.Mc=function(a){return this.path.e()?new Lg(this.source,S,this.Oa.B(a)):new Lg(this.source,R(this.path),this.Oa)},Mg.prototype.Mc=function(){return this.path.e()?this:new Mg(R(this.path),this.sf)},Og.prototype.Mc=function(){return this.path.e()?new Og(this.source,S):new Og(this.source,R(this.path))},Pg.prototype.Mc=function(a){return this.path.e()?(a=this.children.subtree(new P(a)),a.e()?null:a.value?new Lg(this.source,S,a.value):new Pg(this.source,S,a)):(x(G(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new Pg(this.source,R(this.path),this.children))};var Qf=0,Rf=1,Sf=2,Vf=3,Ng=new Qg(!0,!1,null,!1),Rg=new Qg(!1,!0,null,!1);h=Sg.prototype,h.Fa=function(a,b,c,d){var e=this.Bb,f=d;return x(c>e.Ec,"Stacking an older write on top of newer ones"),n(f)||(f=!0),e.ra.push({path:a,Oa:b,Xd:c,visible:f}),f&&(e.V=Ig(e.V,a,b)),e.Ec=c,d?Tg(this,new Lg(Ng,a,b)):[]},h.ae=function(a,b,c){var d=this.Bb;return x(c>d.Ec,"Stacking an older merge on top of newer ones"),d.ra.push({path:a,children:b,Xd:c,visible:!0}),d.V=Jg(d.V,a,b),d.Ec=c,b=mg(b),Tg(this,new Pg(Ng,a,b))},h.Ea=function(a,b){b=b||!1;var c=Dg(this.Bb,a);return null==c?[]:Tg(this,new Mg(c,b))},h.Sa=function(a,b){return Tg(this,new Lg(Rg,a,b))},h.$d=function(a,b){var c=mg(b);return Tg(this,new Pg(Rg,a,c))},h.Jb=function(a,b){var c=a.path,d=null,e=!1;ug(this.ma,c,function(a,b){var f=T(a,c);return d=b.za(f),e=e||null!=zg(b),!d});var f=this.ma.get(c);f?(e=e||null!=zg(f),d=d||f.za(S)):(f=new yg,this.ma=this.ma.set(c,f));var g=null;if(!d){var k=!1,g=K;xg(this.ma.subtree(c),function(a,b){var c=b.za(S);c&&(k=!0,g=g.I(a,c))}),k||(g=null)}var l=null!=Bg(f,a);if(!l&&!wc(a.w)){var m=Yg(a);x(!(m in this.gc),"View does not exist, but we have a tag");var r=Zg++;this.gc[m]=r,this.Zc["_"+r]=m}return m=f.Jb(a,b,new Kg(c,this.Bb),d,g),l||e||(f=Bg(f,a),m=m.concat($g(this,a,f))),m},h.hb=function(a,b,c){var d=a.path,e=this.ma.get(d),f=[];if(e&&("default"===a.Da()||null!=Bg(e,a))){f=e.hb(a,b,c),e.e()&&(this.ma=this.ma.remove(d)),e=f.mg,f=f.Pf,b=-1!==Pa(e,function(a){return wc(a.w)});var g=sg(this.ma,d,function(a,b){return null!=zg(b)});if(b&&!g&&(d=this.ma.subtree(d),!d.e()))for(var d=ah(d),k=0;k<d.length;++k){var l=d[k],m=l.U,l=bh(this,l);this.Fc.Le(m,ch(this,m),l.qd,l.H)}if(!g&&0<e.length&&!c)if(b)this.Fc.Od(a,null);else{var r=this;Ja(e,function(a){a.Da();var b=r.gc[Yg(a)];r.Fc.Od(a,b)})}dh(this,e)}return f},h.xa=function(a,b){var c=this.Bb,d=sg(this.ma,a,function(b,c){var d=T(b,a);return(d=c.za(d))?d:void 0});return c.xa(a,d,b,!0)};var Zg=1;h=gh.prototype,h.toString=function(){return(this.Q.Cb?"https://":"http://")+this.Q.host},h.name=function(){return this.Q.yb},h.Cd=function(a,b,c,d){this.jd++;var e=new P(a);b=this.re?this.re(a,b):b,a=[],d?c?(b=fd(b,function(a){return J(a)}),a=Xg(this.M,e,b,d)):(b=J(b),a=Ug(this.M,e,b,d)):c?(d=fd(b,function(a){return J(a)}),a=this.M.$d(e,d)):(d=J(b),a=this.M.Sa(e,d)),d=e,0<a.length&&(d=kh(this,e)),Xe(this.Z,d,a)},h.Ad=function(a){hh(this,"connected",a),!1===a&&lh(this)},h.Ee=function(a){var b=this;Cb(a,function(a,d){hh(b,d,a)})},h.Be=function(a){hh(this,"authenticated",a)},h.Db=function(a,b,c,d){this.f("set",{path:a.toString(),value:b,Cg:c});var e=jh(this);b=J(b,c);var e=If(b,e),f=this.zd++,e=this.M.Fa(a,e,f,!0);Ue(this.Z,e);var g=this;this.S.put(a.toString(),b.N(!0),function(b,c){var e="ok"===b;e||z("set at "+a+" failed: "+b),e=g.M.Ea(f,!e),Xe(g.Z,a,e),mh(d,b,c)}),e=nh(this,a),kh(this,e),Xe(this.Z,e,[])},h.update=function(a,b,c){this.f("update",{path:a.toString(),value:b});var d=!0,e=jh(this),f={};if(A(b,function(a,b){d=!1;var c=J(a);f[b]=If(c,e)}),d)kb("update() called with empty data.  Don't do anything."),mh(c,"ok");else{var g=this.zd++,k=this.M.ae(a,f,g);Ue(this.Z,k);var l=this;Ke(this.S,a.toString(),b,function(b,d){x("ok"===b||"permission_denied"===b,"merge at "+a+" failed.");var e="ok"===b;e||z("update at "+a+" failed: "+b);var e=l.M.Ea(g,!e),f=a;0<e.length&&(f=kh(l,a)),Xe(l.Z,f,e),mh(c,b,d)}),b=nh(this,a),kh(this,b),Xe(this.Z,a,[])}},h.Ce=function(a,b){var c=this;this.S.Ce(a.toString(),function(d,e){"ok"===d&&Qe(c.ea,a),mh(b,d,e)})},h.tb=function(){this.S.tb()},h.kc=function(){this.S.kc()},h.Me=function(a){if("undefined"!=typeof console){a?(this.Nd||(this.Nd=new Hd(this.Qa)),a=this.Nd.get()):a=this.Qa.get();var c,b=Ma(yd(a),function(a,b){return Math.max(b.length,a)},0);for(c in a){for(var d=a[c],e=c.length;b+2>e;e++)c+=" ";console.log(c+d)}}},h.Ne=function(a){Gd(this.Qa,a),this.ug.uf[a]=!0},h.f=function(){kb("r:"+this.S.id+":",arguments)},ca(Ah),Ah.prototype.tb=function(){for(var a in this.jc)this.jc[a].tb()},Ah.prototype.interrupt=Ah.prototype.tb,Ah.prototype.kc=function(){for(var a in this.jc)this.jc[a].kc()},Ah.prototype.resume=Ah.prototype.kc,Bh.prototype.cc=function(a){var c,b=this;try{c=ua(a.data)}catch(d){}c&&"request"===c.a&&(ef(window,"message",this.cc),this.Qd=a.origin,this.tc&&setTimeout(function(){b.tc(b.Qd,c.d,function(a,c){b.If=!c,b.tc=void 0,Ch(b,{a:"response",d:a,forceKeepWindowOpen:c})})},0))},Bh.prototype.eg=function(){try{ef(this.sd,"message",this.hf)}catch(a){}this.tc&&(Ch(this,{a:"error",d:"unknown closed window"}),this.tc=void 0);try{window.close()}catch(b){}},Bh.prototype.hf=function(a){if(this.If&&"die"===a.data)try{window.close()}catch(b){}};var Y={Rf:function(){Yd=Pd=!0}};Y.forceLongPolling=Y.Rf,Y.Sf=function(){Zd=!0},Y.forceWebSockets=Y.Sf,Y.rg=function(a,b){a.g.S.Ke=b},Y.setSecurityDebugCallback=Y.rg,Y.Me=function(a,b){a.g.Me(b)},Y.stats=Y.Me,Y.Ne=function(a,b){a.g.Ne(b)},Y.statsIncrementCounter=Y.Ne,Y.jd=function(a){return a.g.jd},Y.dataUpdateCount=Y.jd,Y.Vf=function(a,b){a.g.re=b},Y.interceptServerData=Y.Vf,Y.bg=function(a){new Bh(a)},Y.onPopupOpen=Y.bg,Y.pg=function(a){Ye=a},Y.setAuthenticationServer=Y.pg,Z.prototype.cancel=function(a){D("Firebase.onDisconnect().cancel",0,1,arguments.length),F("Firebase.onDisconnect().cancel",1,a,!0),this.Sc.Ce(this.Ca,a||null)},Z.prototype.cancel=Z.prototype.cancel,Z.prototype.remove=function(a){D("Firebase.onDisconnect().remove",0,1,arguments.length),$b("Firebase.onDisconnect().remove",this.Ca),F("Firebase.onDisconnect().remove",1,a,!0),oh(this.Sc,this.Ca,null,a)},Z.prototype.remove=Z.prototype.remove,Z.prototype.set=function(a,b){D("Firebase.onDisconnect().set",1,2,arguments.length),$b("Firebase.onDisconnect().set",this.Ca),Sb("Firebase.onDisconnect().set",a,!1),F("Firebase.onDisconnect().set",2,b,!0),oh(this.Sc,this.Ca,a,b)},Z.prototype.set=Z.prototype.set,Z.prototype.Db=function(a,b,c){D("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),$b("Firebase.onDisconnect().setWithPriority",this.Ca),Sb("Firebase.onDisconnect().setWithPriority",a,!1),Wb("Firebase.onDisconnect().setWithPriority",2,b),F("Firebase.onDisconnect().setWithPriority",3,c,!0),ph(this.Sc,this.Ca,a,b,c)},Z.prototype.setWithPriority=Z.prototype.Db,Z.prototype.update=function(a,b){if(D("Firebase.onDisconnect().update",1,2,arguments.length),$b("Firebase.onDisconnect().update",this.Ca),ea(a)){for(var c={},d=0;d<a.length;++d)c[""+d]=a[d];a=c,z("Passing an Array to Firebase.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Vb("Firebase.onDisconnect().update",a),F("Firebase.onDisconnect().update",2,b,!0),qh(this.Sc,this.Ca,a,b)},Z.prototype.update=Z.prototype.update;var $={};$.rc=xe,$.DataConnection=$.rc,xe.prototype.tg=function(a,b){this.wa("q",{p:a},b)},$.rc.prototype.simpleListen=$.rc.prototype.tg,xe.prototype.Nf=function(a,b){this.wa("echo",{d:a},b)},$.rc.prototype.echo=$.rc.prototype.Nf,xe.prototype.interrupt=xe.prototype.tb,$.zf=ie,$.RealTimeConnection=$.zf,ie.prototype.sendRequest=ie.prototype.wa,ie.prototype.close=ie.prototype.close,$.Uf=function(a){var b=xe.prototype.put;return xe.prototype.put=function(c,d,e,f){n(f)&&(f=a()),b.call(this,c,d,e,f)},function(){xe.prototype.put=b}},$.hijackHash=$.Uf,$.yf=Ca,$.ConnectionTarget=$.yf,$.Da=function(a){return a.Da()},$.queryIdentifier=$.Da,$.Wf=function(a){return a.g.S.ua},$.listens=$.Wf;var Dh=function(){var a=0,b=[];return function(c){var d=c===a;a=c;for(var e=Array(8),f=7;f>=0;f--)e[f]="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(c%64),c=Math.floor(c/64);if(x(0===c,"Cannot push at time == 0"),c=e.join(""),d){for(f=11;f>=0&&63===b[f];f--)b[f]=0;b[f]++}else for(f=0;12>f;f++)b[f]=Math.floor(64*Math.random());for(f=0;12>f;f++)c+="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(b[f]);return x(20===c.length,"NextPushId: Length should be 20."),c}}();na(O,M);var Eh=O,Fh=["Firebase"],Gh=aa;Fh[0]in Gh||!Gh.execScript||Gh.execScript("var "+Fh[0]);for(var Hh;Fh.length&&(Hh=Fh.shift());)!Fh.length&&n(Eh)?Gh[Hh]=Eh:Gh=Gh[Hh]?Gh[Hh]:Gh[Hh]={};O.prototype.name=function(){return z("Firebase.name() being deprecated. Please use Firebase.key() instead."),D("Firebase.name",0,0,arguments.length),this.key()},O.prototype.name=O.prototype.name,O.prototype.key=function(){D("Firebase.key",0,0,arguments.length);var a;return this.path.e()?a=null:(a=this.path,a=a.aa<a.n.length?a.n[a.n.length-1]:null),a},O.prototype.key=O.prototype.key,O.prototype.k=function(a){if(D("Firebase.child",1,1,arguments.length),ga(a))a=String(a);else if(!(a instanceof P))if(null===G(this.path)){var b=a;b&&(b=b.replace(/^\/*\.info(\/|$)/,"/")),Zb("Firebase.child",b)}else Zb("Firebase.child",a);return new O(this.g,this.path.k(a))},O.prototype.child=O.prototype.k,O.prototype.parent=function(){D("Firebase.parent",0,0,arguments.length);var a=this.path.parent();return null===a?null:new O(this.g,a)},O.prototype.parent=O.prototype.parent,O.prototype.root=function(){D("Firebase.ref",0,0,arguments.length);for(var a=this;null!==a.parent();)a=a.parent();return a},O.prototype.root=O.prototype.root,O.prototype.toString=function(){D("Firebase.toString",0,0,arguments.length);var a;if(null===this.parent())a=this.g.toString();else{a=this.parent().toString()+"/";var b=this.key();a+=encodeURIComponent(String(b))}return a},O.prototype.toString=O.prototype.toString,O.prototype.set=function(a,b){D("Firebase.set",1,2,arguments.length),$b("Firebase.set",this.path),Sb("Firebase.set",a,!1),F("Firebase.set",2,b,!0),this.g.Db(this.path,a,null,b||null)},O.prototype.set=O.prototype.set,O.prototype.update=function(a,b){if(D("Firebase.update",1,2,arguments.length),$b("Firebase.update",this.path),ea(a)){for(var c={},d=0;d<a.length;++d)c[""+d]=a[d];a=c,z("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}if(Vb("Firebase.update",a),F("Firebase.update",2,b,!0),u(a,".priority"))throw Error("update() does not currently support updating .priority.");this.g.update(this.path,a,b||null)},O.prototype.update=O.prototype.update,O.prototype.Db=function(a,b,c){if(D("Firebase.setWithPriority",2,3,arguments.length),$b("Firebase.setWithPriority",this.path),Sb("Firebase.setWithPriority",a,!1),Wb("Firebase.setWithPriority",2,b),F("Firebase.setWithPriority",3,c,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.setWithPriority failed: "+this.key()+" is a read-only object.";this.g.Db(this.path,a,b,c||null)},O.prototype.setWithPriority=O.prototype.Db,O.prototype.remove=function(a){D("Firebase.remove",0,1,arguments.length),$b("Firebase.remove",this.path),F("Firebase.remove",1,a,!0),this.set(null,a)},O.prototype.remove=O.prototype.remove,O.prototype.transaction=function(a,b,c){if(D("Firebase.transaction",1,3,arguments.length),$b("Firebase.transaction",this.path),F("Firebase.transaction",1,a,!1),F("Firebase.transaction",2,b,!0),n(c)&&"boolean"!=typeof c)throw Error(E("Firebase.transaction",3,!0)+"must be a boolean.");if(".length"===this.key()||".keys"===this.key())throw"Firebase.transaction failed: "+this.key()+" is a read-only object.";"undefined"==typeof c&&(c=!0),rh(this.g,this.path,a,b||null,c)},O.prototype.transaction=O.prototype.transaction,O.prototype.qg=function(a,b){D("Firebase.setPriority",1,2,arguments.length),$b("Firebase.setPriority",this.path),Wb("Firebase.setPriority",1,a),F("Firebase.setPriority",2,b,!0),this.g.Db(this.path.k(".priority"),a,null,b)},O.prototype.setPriority=O.prototype.qg,O.prototype.push=function(a,b){D("Firebase.push",0,2,arguments.length),$b("Firebase.push",this.path),Sb("Firebase.push",a,!0),F("Firebase.push",2,b,!0);var c=ih(this.g),c=Dh(c),c=this.k(c);return"undefined"!=typeof a&&null!==a&&c.set(a,b),c},O.prototype.push=O.prototype.push,O.prototype.fb=function(){return $b("Firebase.onDisconnect",this.path),new Z(this.g,this.path)},O.prototype.onDisconnect=O.prototype.fb,O.prototype.T=function(a,b,c){z("FirebaseRef.auth() being deprecated. Please use FirebaseRef.authWithCustomToken() instead."),D("Firebase.auth",1,3,arguments.length),ac("Firebase.auth",a),F("Firebase.auth",2,b,!0),F("Firebase.auth",3,b,!0),zf(this.g.T,a,{},{remember:"none"},b,c)},O.prototype.auth=O.prototype.T,O.prototype.Pe=function(a){D("Firebase.unauth",0,1,arguments.length),F("Firebase.unauth",1,a,!0),Af(this.g.T,a)},O.prototype.unauth=O.prototype.Pe,O.prototype.ne=function(){return D("Firebase.getAuth",0,0,arguments.length),this.g.T.ne()},O.prototype.getAuth=O.prototype.ne,O.prototype.ag=function(a,b){D("Firebase.onAuth",1,2,arguments.length),F("Firebase.onAuth",1,a,!1),Nb("Firebase.onAuth",2,b),this.g.T.zb("auth_status",a,b)},O.prototype.onAuth=O.prototype.ag,O.prototype.Zf=function(a,b){D("Firebase.offAuth",1,2,arguments.length),F("Firebase.offAuth",1,a,!1),Nb("Firebase.offAuth",2,b),this.g.T.bc("auth_status",a,b)},O.prototype.offAuth=O.prototype.Zf,O.prototype.Df=function(a,b,c){D("Firebase.authWithCustomToken",2,3,arguments.length),ac("Firebase.authWithCustomToken",a),F("Firebase.authWithCustomToken",2,b,!1),cc("Firebase.authWithCustomToken",3,c,!0),zf(this.g.T,a,{},c||{},b)},O.prototype.authWithCustomToken=O.prototype.Df,O.prototype.Ef=function(a,b,c){D("Firebase.authWithOAuthPopup",2,3,arguments.length),bc("Firebase.authWithOAuthPopup",1,a),F("Firebase.authWithOAuthPopup",2,b,!1),cc("Firebase.authWithOAuthPopup",3,c,!0),Ef(this.g.T,a,c,b)},O.prototype.authWithOAuthPopup=O.prototype.Ef,O.prototype.Ff=function(a,b,c){D("Firebase.authWithOAuthRedirect",2,3,arguments.length),bc("Firebase.authWithOAuthRedirect",1,a),F("Firebase.authWithOAuthRedirect",2,b,!1),cc("Firebase.authWithOAuthRedirect",3,c,!0);var d=this.g.T;Cf(d);var e=[sf],f=af(c);"anonymous"===a||"firebase"===a?B(b,V("TRANSPORT_UNAVAILABLE")):(Ba.set("redirect_client_options",f.ed),Df(d,e,"/auth/"+a,f,b))},O.prototype.authWithOAuthRedirect=O.prototype.Ff,O.prototype.Gf=function(a,b,c,d){D("Firebase.authWithOAuthToken",3,4,arguments.length),bc("Firebase.authWithOAuthToken",1,a),F("Firebase.authWithOAuthToken",3,c,!1),cc("Firebase.authWithOAuthToken",4,d,!0),p(b)?(bc("Firebase.authWithOAuthToken",2,b),Bf(this.g.T,a+"/token",{access_token:b},d,c)):(cc("Firebase.authWithOAuthToken",2,b,!1),Bf(this.g.T,a+"/token",b,d,c))},O.prototype.authWithOAuthToken=O.prototype.Gf,O.prototype.Cf=function(a,b){D("Firebase.authAnonymously",1,2,arguments.length),F("Firebase.authAnonymously",1,a,!1),cc("Firebase.authAnonymously",2,b,!0),Bf(this.g.T,"anonymous",{},b,a)},O.prototype.authAnonymously=O.prototype.Cf,O.prototype.Hf=function(a,b,c){D("Firebase.authWithPassword",2,3,arguments.length),cc("Firebase.authWithPassword",1,a,!1),dc("Firebase.authWithPassword",a,"email"),dc("Firebase.authWithPassword",a,"password"),F("Firebase.authAnonymously",2,b,!1),cc("Firebase.authAnonymously",3,c,!0),Bf(this.g.T,"password",a,c,b)},O.prototype.authWithPassword=O.prototype.Hf,O.prototype.je=function(a,b){D("Firebase.createUser",2,2,arguments.length),cc("Firebase.createUser",1,a,!1),dc("Firebase.createUser",a,"email"),dc("Firebase.createUser",a,"password"),F("Firebase.createUser",2,b,!1),this.g.T.je(a,b)},O.prototype.createUser=O.prototype.je,O.prototype.Ie=function(a,b){D("Firebase.removeUser",2,2,arguments.length),cc("Firebase.removeUser",1,a,!1),dc("Firebase.removeUser",a,"email"),dc("Firebase.removeUser",a,"password"),F("Firebase.removeUser",2,b,!1),this.g.T.Ie(a,b)},O.prototype.removeUser=O.prototype.Ie,O.prototype.ee=function(a,b){D("Firebase.changePassword",2,2,arguments.length),cc("Firebase.changePassword",1,a,!1),dc("Firebase.changePassword",a,"email"),dc("Firebase.changePassword",a,"oldPassword"),dc("Firebase.changePassword",a,"newPassword"),F("Firebase.changePassword",2,b,!1),this.g.T.ee(a,b)},O.prototype.changePassword=O.prototype.ee,O.prototype.Je=function(a,b){D("Firebase.resetPassword",2,2,arguments.length),cc("Firebase.resetPassword",1,a,!1),dc("Firebase.resetPassword",a,"email"),F("Firebase.resetPassword",2,b,!1),this.g.T.Je(a,b)},O.prototype.resetPassword=O.prototype.Je,O.goOffline=function(){D("Firebase.goOffline",0,0,arguments.length),Ah.Qb().tb()},O.goOnline=function(){D("Firebase.goOnline",0,0,arguments.length),Ah.Qb().kc()},O.enableLogging=qb,O.ServerValue={TIMESTAMP:{".sv":"timestamp"}},O.SDK_VERSION="2.0.6",O.INTERNAL=Y,O.Context=Ah,O.TEST_ACCESS=$}(),/*!
 * Firepad is an open-source, collaborative code and text editor. It was designed
 * to be embedded inside larger applications. Since it uses Firebase as a backend,
 * it requires no server-side code and can be added to any web app simply by
 * including a couple JavaScript files.
 *
 * Firepad 1.1.0
 * http://www.firepad.io/
 * License: MIT
 * Copyright: 2014 Firebase
 * With code from ot.js (Copyright 2012-2013 Tim Baumann)
 */
function(name,definition,context){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof context.define&&context.define.amd?define(definition):context[name]=definition()}("Firepad",function(){var firepad=firepad||{};firepad.utils={},firepad.utils.makeEventEmitter=function(clazz,opt_allowedEVents){clazz.prototype.allowedEvents_=opt_allowedEVents,clazz.prototype.on=function(eventType,callback,context){this.validateEventType_(eventType),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[eventType]=this.eventListeners_[eventType]||[],this.eventListeners_[eventType].push({callback:callback,context:context})},clazz.prototype.off=function(eventType,callback){this.validateEventType_(eventType),this.eventListeners_=this.eventListeners_||{};for(var listeners=this.eventListeners_[eventType]||[],i=0;i<listeners.length;i++)if(listeners[i].callback===callback)return listeners.splice(i,1),void 0},clazz.prototype.trigger=function(eventType){this.eventListeners_=this.eventListeners_||{};for(var listeners=this.eventListeners_[eventType]||[],i=0;i<listeners.length;i++)listeners[i].callback.apply(listeners[i].context,Array.prototype.slice.call(arguments,1))},clazz.prototype.validateEventType_=function(eventType){if(this.allowedEvents_){for(var allowed=!1,i=0;i<this.allowedEvents_.length;i++)if(this.allowedEvents_[i]===eventType){allowed=!0;break}if(!allowed)throw new Error('Unknown event "'+eventType+'"')}}},firepad.utils.elt=function(tag,content,attrs){var e=document.createElement(tag);if("string"==typeof content)firepad.utils.setTextContent(e,content);else if(content)for(var i=0;i<content.length;++i)e.appendChild(content[i]);for(var attr in attrs||{})e.setAttribute(attr,attrs[attr]);return e},firepad.utils.setTextContent=function(e,str){e.innerHTML="",e.appendChild(document.createTextNode(str))},firepad.utils.on=function(emitter,type,f,capture){emitter.addEventListener?emitter.addEventListener(type,f,capture||!1):emitter.attachEvent&&emitter.attachEvent("on"+type,f)},firepad.utils.off=function(emitter,type,f,capture){emitter.removeEventListener?emitter.removeEventListener(type,f,capture||!1):emitter.detachEvent&&emitter.detachEvent("on"+type,f)},firepad.utils.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},firepad.utils.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},firepad.utils.stopEvent=function(e){firepad.utils.preventDefault(e),firepad.utils.stopPropagation(e)},firepad.utils.stopEventAnd=function(fn){return function(e){return fn(e),firepad.utils.stopEvent(e),!1}},firepad.utils.trim=function(str){return str.replace(/^\s+/g,"").replace(/\s+$/g,"")},firepad.utils.stringEndsWith=function(str,suffix){for(var list="string"==typeof suffix?[suffix]:suffix,i=0;i<list.length;i++){var suffix=list[i];if(-1!==str.indexOf(suffix,str.length-suffix.length))return!0}return!1},firepad.utils.assert=function(b,msg){if(!b)throw new Error(msg||"assertion error")},firepad.utils.log=function(){if("undefined"!=typeof console&&"undefined"!=typeof console.log){for(var args=["Firepad:"],i=0;i<arguments.length;i++)args.push(arguments[i]);console.log.apply(console,args)}};var firepad=firepad||{};firepad.Span=function(){function Span(pos,length){this.pos=pos,this.length=length}return Span.prototype.end=function(){return this.pos+this.length},Span}();var firepad=firepad||{};firepad.TextOp=function(){function TextOp(type){this.type=type,this.chars=null,this.text=null,this.attributes=null,"insert"===type?(this.text=arguments[1],utils.assert("string"==typeof this.text),this.attributes=arguments[2]||{},utils.assert("object"==typeof this.attributes)):"delete"===type?(this.chars=arguments[1],utils.assert("number"==typeof this.chars)):"retain"===type&&(this.chars=arguments[1],utils.assert("number"==typeof this.chars),this.attributes=arguments[2]||{},utils.assert("object"==typeof this.attributes))}var utils=firepad.utils;return TextOp.prototype.isInsert=function(){return"insert"===this.type},TextOp.prototype.isDelete=function(){return"delete"===this.type},TextOp.prototype.isRetain=function(){return"retain"===this.type},TextOp.prototype.equals=function(other){return this.type===other.type&&this.text===other.text&&this.chars===other.chars&&this.attributesEqual(other.attributes)},TextOp.prototype.attributesEqual=function(otherAttributes){for(var attr in this.attributes)if(this.attributes[attr]!==otherAttributes[attr])return!1;for(attr in otherAttributes)if(this.attributes[attr]!==otherAttributes[attr])return!1;return!0},TextOp.prototype.hasEmptyAttributes=function(){var empty=!0;for(var attr in this.attributes){empty=!1;break}return empty},TextOp}();var firepad=firepad||{};firepad.TextOperation=function(){"use strict";function TextOperation(){return this&&this.constructor===TextOperation?(this.ops=[],this.baseLength=0,this.targetLength=0,void 0):new TextOperation}function getSimpleOp(operation){var ops=operation.ops;switch(ops.length){case 1:return ops[0];case 2:return ops[0].isRetain()?ops[1]:ops[1].isRetain()?ops[0]:null;case 3:if(ops[0].isRetain()&&ops[2].isRetain())return ops[1]}return null}function getStartIndex(operation){return operation.ops[0].isRetain()?operation.ops[0].chars:0}var TextOp=firepad.TextOp,utils=firepad.utils;return TextOperation.prototype.equals=function(other){if(this.baseLength!==other.baseLength)return!1;if(this.targetLength!==other.targetLength)return!1;if(this.ops.length!==other.ops.length)return!1;for(var i=0;i<this.ops.length;i++)if(!this.ops[i].equals(other.ops[i]))return!1;return!0},TextOperation.prototype.retain=function(n,attributes){if("number"!=typeof n||0>n)throw new Error("retain expects a positive integer.");if(0===n)return this;this.baseLength+=n,this.targetLength+=n,attributes=attributes||{};var prevOp=this.ops.length>0?this.ops[this.ops.length-1]:null;return prevOp&&prevOp.isRetain()&&prevOp.attributesEqual(attributes)?prevOp.chars+=n:this.ops.push(new TextOp("retain",n,attributes)),this},TextOperation.prototype.insert=function(str,attributes){if("string"!=typeof str)throw new Error("insert expects a string");if(""===str)return this;attributes=attributes||{},this.targetLength+=str.length;var prevOp=this.ops.length>0?this.ops[this.ops.length-1]:null,prevPrevOp=this.ops.length>1?this.ops[this.ops.length-2]:null;return prevOp&&prevOp.isInsert()&&prevOp.attributesEqual(attributes)?prevOp.text+=str:prevOp&&prevOp.isDelete()?prevPrevOp&&prevPrevOp.isInsert()&&prevPrevOp.attributesEqual(attributes)?prevPrevOp.text+=str:(this.ops[this.ops.length-1]=new TextOp("insert",str,attributes),this.ops.push(prevOp)):this.ops.push(new TextOp("insert",str,attributes)),this},TextOperation.prototype["delete"]=function(n){if("string"==typeof n&&(n=n.length),"number"!=typeof n||0>n)throw new Error("delete expects a positive integer or a string");if(0===n)return this;this.baseLength+=n;var prevOp=this.ops.length>0?this.ops[this.ops.length-1]:null;return prevOp&&prevOp.isDelete()?prevOp.chars+=n:this.ops.push(new TextOp("delete",n)),this},TextOperation.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()},TextOperation.prototype.clone=function(){for(var clone=new TextOperation,i=0;i<this.ops.length;i++)this.ops[i].isRetain()?clone.retain(this.ops[i].chars,this.ops[i].attributes):this.ops[i].isInsert()?clone.insert(this.ops[i].text,this.ops[i].attributes):clone["delete"](this.ops[i].chars);return clone},TextOperation.prototype.toString=function(){var map=Array.prototype.map||function(fn){for(var arr=this,newArr=[],i=0,l=arr.length;l>i;i++)newArr[i]=fn(arr[i]);return newArr};return map.call(this.ops,function(op){return op.isRetain()?"retain "+op.chars:op.isInsert()?"insert '"+op.text+"'":"delete "+op.chars}).join(", ")},TextOperation.prototype.toJSON=function(){for(var ops=[],i=0;i<this.ops.length;i++)this.ops[i].hasEmptyAttributes()||ops.push(this.ops[i].attributes),"retain"===this.ops[i].type?ops.push(this.ops[i].chars):"insert"===this.ops[i].type?ops.push(this.ops[i].text):"delete"===this.ops[i].type&&ops.push(-this.ops[i].chars);return 0===ops.length&&ops.push(0),ops},TextOperation.fromJSON=function(ops){for(var o=new TextOperation,i=0,l=ops.length;l>i;i++){var op=ops[i],attributes={};"object"==typeof op&&(attributes=op,i++,op=ops[i]),"number"==typeof op?op>0?o.retain(op,attributes):o["delete"](-op):(utils.assert("string"==typeof op),o.insert(op,attributes))}return o},TextOperation.prototype.apply=function(str,oldAttributes,newAttributes){var operation=this;if(oldAttributes=oldAttributes||[],newAttributes=newAttributes||[],str.length!==operation.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var k,attr,newStringParts=[],j=0,oldIndex=0,ops=this.ops,i=0,l=ops.length;l>i;i++){var op=ops[i];if(op.isRetain()){if(oldIndex+op.chars>str.length)throw new Error("Operation can't retain more characters than are left in the string.");for(newStringParts[j++]=str.slice(oldIndex,oldIndex+op.chars),k=0;k<op.chars;k++){var currAttributes=oldAttributes[oldIndex+k]||{},updatedAttributes={};for(attr in currAttributes)updatedAttributes[attr]=currAttributes[attr],utils.assert(updatedAttributes[attr]!==!1);for(attr in op.attributes)op.attributes[attr]===!1?delete updatedAttributes[attr]:updatedAttributes[attr]=op.attributes[attr],utils.assert(updatedAttributes[attr]!==!1);newAttributes.push(updatedAttributes)}oldIndex+=op.chars}else if(op.isInsert())for(newStringParts[j++]=op.text,k=0;k<op.text.length;k++){var insertedAttributes={};for(attr in op.attributes)insertedAttributes[attr]=op.attributes[attr],utils.assert(insertedAttributes[attr]!==!1);newAttributes.push(insertedAttributes)}else oldIndex+=op.chars}if(oldIndex!==str.length)throw new Error("The operation didn't operate on the whole string.");var newString=newStringParts.join("");return utils.assert(newString.length===newAttributes.length),newString},TextOperation.prototype.invert=function(str){for(var strIndex=0,inverse=new TextOperation,ops=this.ops,i=0,l=ops.length;l>i;i++){var op=ops[i];op.isRetain()?(inverse.retain(op.chars),strIndex+=op.chars):op.isInsert()?inverse["delete"](op.text.length):(inverse.insert(str.slice(strIndex,strIndex+op.chars)),strIndex+=op.chars)}return inverse},TextOperation.prototype.compose=function(operation2){function composeAttributes(first,second,firstOpIsInsert){var attr,merged={};for(attr in first)merged[attr]=first[attr];for(attr in second)firstOpIsInsert&&second[attr]===!1?delete merged[attr]:merged[attr]=second[attr];return merged}var operation1=this;if(operation1.targetLength!==operation2.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");for(var attributes,operation=new TextOperation,ops1=operation1.clone().ops,ops2=operation2.clone().ops,i1=0,i2=0,op1=ops1[i1++],op2=ops2[i2++];;){if("undefined"==typeof op1&&"undefined"==typeof op2)break;if(op1&&op1.isDelete())operation["delete"](op1.chars),op1=ops1[i1++];else if(op2&&op2.isInsert())operation.insert(op2.text,op2.attributes),op2=ops2[i2++];else{if("undefined"==typeof op1)throw new Error("Cannot compose operations: first operation is too short.");if("undefined"==typeof op2)throw new Error("Cannot compose operations: first operation is too long.");if(op1.isRetain()&&op2.isRetain())attributes=composeAttributes(op1.attributes,op2.attributes),op1.chars>op2.chars?(operation.retain(op2.chars,attributes),op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(operation.retain(op1.chars,attributes),op1=ops1[i1++],op2=ops2[i2++]):(operation.retain(op1.chars,attributes),op2.chars-=op1.chars,op1=ops1[i1++]);else if(op1.isInsert()&&op2.isDelete())op1.text.length>op2.chars?(op1.text=op1.text.slice(op2.chars),op2=ops2[i2++]):op1.text.length===op2.chars?(op1=ops1[i1++],op2=ops2[i2++]):(op2.chars-=op1.text.length,op1=ops1[i1++]);else if(op1.isInsert()&&op2.isRetain())attributes=composeAttributes(op1.attributes,op2.attributes,!0),op1.text.length>op2.chars?(operation.insert(op1.text.slice(0,op2.chars),attributes),op1.text=op1.text.slice(op2.chars),op2=ops2[i2++]):op1.text.length===op2.chars?(operation.insert(op1.text,attributes),op1=ops1[i1++],op2=ops2[i2++]):(operation.insert(op1.text,attributes),op2.chars-=op1.text.length,op1=ops1[i1++]);else{if(!op1.isRetain()||!op2.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(op1)+", op2: "+JSON.stringify(op2));op1.chars>op2.chars?(operation["delete"](op2.chars),op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(operation["delete"](op2.chars),op1=ops1[i1++],op2=ops2[i2++]):(operation["delete"](op1.chars),op2.chars-=op1.chars,op1=ops1[i1++])}}}return operation},TextOperation.prototype.shouldBeComposedWith=function(other){if(this.isNoop()||other.isNoop())return!0;var startA=getStartIndex(this),startB=getStartIndex(other),simpleA=getSimpleOp(this),simpleB=getSimpleOp(other);return simpleA&&simpleB?simpleA.isInsert()&&simpleB.isInsert()?startA+simpleA.text.length===startB:simpleA.isDelete()&&simpleB.isDelete()?startB+simpleB.chars===startA||startA===startB:!1:!1},TextOperation.prototype.shouldBeComposedWithInverted=function(other){if(this.isNoop()||other.isNoop())return!0;var startA=getStartIndex(this),startB=getStartIndex(other),simpleA=getSimpleOp(this),simpleB=getSimpleOp(other);return simpleA&&simpleB?simpleA.isInsert()&&simpleB.isInsert()?startA+simpleA.text.length===startB||startA===startB:simpleA.isDelete()&&simpleB.isDelete()?startB+simpleB.chars===startA:!1:!1},TextOperation.transformAttributes=function(attributes1,attributes2){var attr,attributes1prime={},attributes2prime={},allAttrs={};for(attr in attributes1)allAttrs[attr]=!0;for(attr in attributes2)allAttrs[attr]=!0;for(attr in allAttrs){var attr1=attributes1[attr],attr2=attributes2[attr];utils.assert(null!=attr1||null!=attr2),null==attr1?attributes2prime[attr]=attr2:null==attr2?attributes1prime[attr]=attr1:attr1===attr2||(attributes1prime[attr]=attr1)}return[attributes1prime,attributes2prime]},TextOperation.transform=function(operation1,operation2){if(operation1.baseLength!==operation2.baseLength)throw new Error("Both operations have to have the same base length");for(var operation1prime=new TextOperation,operation2prime=new TextOperation,ops1=operation1.clone().ops,ops2=operation2.clone().ops,i1=0,i2=0,op1=ops1[i1++],op2=ops2[i2++];;){if("undefined"==typeof op1&&"undefined"==typeof op2)break;if(op1&&op1.isInsert())operation1prime.insert(op1.text,op1.attributes),operation2prime.retain(op1.text.length),op1=ops1[i1++];else if(op2&&op2.isInsert())operation1prime.retain(op2.text.length),operation2prime.insert(op2.text,op2.attributes),op2=ops2[i2++];else{if("undefined"==typeof op1)throw new Error("Cannot transform operations: first operation is too short.");if("undefined"==typeof op2)throw new Error("Cannot transform operations: first operation is too long.");var minl;if(op1.isRetain()&&op2.isRetain()){var attributesPrime=TextOperation.transformAttributes(op1.attributes,op2.attributes);op1.chars>op2.chars?(minl=op2.chars,op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(minl=op2.chars,op1=ops1[i1++],op2=ops2[i2++]):(minl=op1.chars,op2.chars-=op1.chars,op1=ops1[i1++]),operation1prime.retain(minl,attributesPrime[0]),operation2prime.retain(minl,attributesPrime[1])}else if(op1.isDelete()&&op2.isDelete())op1.chars>op2.chars?(op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(op1=ops1[i1++],op2=ops2[i2++]):(op2.chars-=op1.chars,op1=ops1[i1++]);else if(op1.isDelete()&&op2.isRetain())op1.chars>op2.chars?(minl=op2.chars,op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(minl=op2.chars,op1=ops1[i1++],op2=ops2[i2++]):(minl=op1.chars,op2.chars-=op1.chars,op1=ops1[i1++]),operation1prime["delete"](minl);else{if(!op1.isRetain()||!op2.isDelete())throw new Error("The two operations aren't compatible");op1.chars>op2.chars?(minl=op2.chars,op1.chars-=op2.chars,op2=ops2[i2++]):op1.chars===op2.chars?(minl=op1.chars,op1=ops1[i1++],op2=ops2[i2++]):(minl=op1.chars,op2.chars-=op1.chars,op1=ops1[i1++]),operation2prime["delete"](minl)}}}return[operation1prime,operation2prime]},TextOperation}();var firepad=firepad||{};firepad.AnnotationList=function(){function assert(bool,text){if(!bool)throw new Error("AnnotationList assertion failed"+(text?": "+text:""))}function OldAnnotatedSpan(pos,node){this.pos=pos,this.length=node.length,this.annotation=node.annotation,this.attachedObject_=node.attachedObject}function NewAnnotatedSpan(pos,node){this.pos=pos,this.length=node.length,this.annotation=node.annotation,this.node_=node}function AnnotationList(changeHandler){this.head_=new Node(0,NullAnnotation),this.changeHandler_=changeHandler}function Node(length,annotation){this.length=length,this.annotation=annotation,this.attachedObject=null,this.next=null}var Span=firepad.Span;OldAnnotatedSpan.prototype.getAttachedObject=function(){return this.attachedObject_},NewAnnotatedSpan.prototype.attachObject=function(object){this.node_.attachedObject=object};var NullAnnotation={equals:function(){return!1}};return AnnotationList.prototype.insertAnnotatedSpan=function(span,annotation){this.wrapOperation_(new Span(span.pos,0),function(oldPos,old){assert(!old||null===old.next);var toInsert=new Node(span.length,annotation);if(old){assert(span.pos>oldPos&&span.pos<oldPos+old.length);var newNodes=new Node(0,NullAnnotation);return newNodes.next=new Node(span.pos-oldPos,old.annotation),newNodes.next.next=toInsert,toInsert.next=new Node(oldPos+old.length-span.pos,old.annotation),newNodes.next}return toInsert})},AnnotationList.prototype.removeSpan=function(removeSpan){0!==removeSpan.length&&this.wrapOperation_(removeSpan,function(oldPos,old){assert(null!==old);var newNodes=new Node(0,NullAnnotation),current=newNodes;for(removeSpan.pos>oldPos&&(current.next=new Node(removeSpan.pos-oldPos,old.annotation),current=current.next);removeSpan.end()>oldPos+old.length;)oldPos+=old.length,old=old.next;var afterChars=oldPos+old.length-removeSpan.end();return afterChars>0&&(current.next=new Node(afterChars,old.annotation)),newNodes.next})},AnnotationList.prototype.updateSpan=function(span,updateFn){0!==span.length&&this.wrapOperation_(span,function(oldPos,old){assert(null!==old);var newNodes=new Node(0,NullAnnotation),current=newNodes,currentPos=oldPos,beforeChars=span.pos-currentPos;for(assert(beforeChars<old.length),beforeChars>0&&(current.next=new Node(beforeChars,old.annotation),current=current.next,currentPos+=current.length);null!==old&&span.end()>=oldPos+old.length;){var length=oldPos+old.length-currentPos;current.next=new Node(length,updateFn(old.annotation,length)),current=current.next,oldPos+=old.length,old=old.next,currentPos=oldPos}var updateChars=span.end()-currentPos;return updateChars>0&&(assert(updateChars<old.length),current.next=new Node(updateChars,updateFn(old.annotation,updateChars)),current=current.next,currentPos+=current.length,current.next=new Node(oldPos+old.length-currentPos,old.annotation)),newNodes.next})},AnnotationList.prototype.wrapOperation_=function(span,operationFn){if(span.pos<0)throw new Error("Span start cannot be negative.");var tail,oldNodes=[],newNodes=[],res=this.getAffectedNodes_(span);null!==res.start?(tail=res.end.next,res.end.next=null):tail=res.succ;var newSegment=operationFn(res.startPos,res.start),includePredInOldNodes=!1,includeSuccInOldNodes=!1;if(newSegment){this.mergeNodesWithSameAnnotations_(newSegment);var newPos;for(res.pred&&res.pred.annotation.equals(newSegment.annotation)?(includePredInOldNodes=!0,newSegment.length+=res.pred.length,res.beforePred.next=newSegment,newPos=res.predPos):(res.beforeStart.next=newSegment,newPos=res.startPos);newSegment.next;)newNodes.push(new NewAnnotatedSpan(newPos,newSegment)),newPos+=newSegment.length,newSegment=newSegment.next;res.succ&&res.succ.annotation.equals(newSegment.annotation)?(newSegment.length+=res.succ.length,includeSuccInOldNodes=!0,newSegment.next=res.succ.next):newSegment.next=tail,newNodes.push(new NewAnnotatedSpan(newPos,newSegment))}else res.pred&&res.succ&&res.pred.annotation.equals(res.succ.annotation)?(includePredInOldNodes=!0,includeSuccInOldNodes=!0,newSegment=new Node(res.pred.length+res.succ.length,res.pred.annotation),res.beforePred.next=newSegment,newSegment.next=res.succ.next,newNodes.push(new NewAnnotatedSpan(res.startPos-res.pred.length,newSegment))):res.beforeStart.next=tail;includePredInOldNodes&&oldNodes.push(new OldAnnotatedSpan(res.predPos,res.pred));for(var oldPos=res.startPos,oldSegment=res.start;null!==oldSegment;)oldNodes.push(new OldAnnotatedSpan(oldPos,oldSegment)),oldPos+=oldSegment.length,oldSegment=oldSegment.next;includeSuccInOldNodes&&oldNodes.push(new OldAnnotatedSpan(oldPos,res.succ)),this.changeHandler_(oldNodes,newNodes)},AnnotationList.prototype.getAffectedNodes_=function(span){for(var result={},prevprev=null,prev=this.head_,current=prev.next,currentPos=0;null!==current&&span.pos>=currentPos+current.length;)currentPos+=current.length,prevprev=prev,prev=current,current=current.next;if(null===current&&(0!==span.length||span.pos!==currentPos))throw new Error("Span start exceeds the bounds of the AnnotationList.");for(result.startPos=currentPos,result.start=0===span.length&&span.pos===currentPos?null:current,result.beforeStart=prev,currentPos===span.pos&&currentPos>0?(result.pred=prev,result.predPos=currentPos-prev.length,result.beforePred=prevprev):result.pred=null;null!==current&&span.end()>currentPos;)currentPos+=current.length,prev=current,current=current.next;if(span.end()>currentPos)throw new Error("Span end exceeds the bounds of the AnnotationList.");return result.end=0===span.length&&span.end()===currentPos?null:prev,result.succ=currentPos===span.end()?current:null,result},AnnotationList.prototype.mergeNodesWithSameAnnotations_=function(list){if(list)for(var prev=null,curr=list;curr;)prev&&prev.annotation.equals(curr.annotation)?(prev.length+=curr.length,prev.next=curr.next):prev=curr,curr=curr.next},AnnotationList.prototype.forEach=function(callback){for(var current=this.head_.next;null!==current;)callback(current.length,current.annotation,current.attachedObject),current=current.next},AnnotationList.prototype.getAnnotatedSpansForPos=function(pos){for(var currentPos=0,current=this.head_.next,prev=null;null!==current&&currentPos+current.length<=pos;)currentPos+=current.length,prev=current,current=current.next;if(null===current&&currentPos!==pos)throw new Error("pos exceeds the bounds of the AnnotationList");var res=[];return currentPos===pos&&prev&&res.push(new OldAnnotatedSpan(currentPos-prev.length,prev)),current&&res.push(new OldAnnotatedSpan(currentPos,current)),res},AnnotationList.prototype.getAnnotatedSpansForSpan=function(span){if(0===span.length)return[];for(var oldSpans=[],res=this.getAffectedNodes_(span),currentPos=res.startPos,current=res.start;null!==current&&currentPos<span.end();){var start=Math.max(currentPos,span.pos),end=Math.min(currentPos+current.length,span.end()),oldSpan=new Span(start,end-start);oldSpan.annotation=current.annotation,oldSpans.push(oldSpan),currentPos+=current.length,current=current.next}return oldSpans},AnnotationList.prototype.count=function(){for(var count=0,current=this.head_.next,prev=null;null!==current;)prev&&assert(!prev.annotation.equals(current.annotation)),prev=current,current=current.next,count++;return count},Node.prototype.clone=function(){var node=new Node(this.spanLength,this.annotation);return node.next=this.next,node},AnnotationList}();var firepad=firepad||{};firepad.Cursor=function(){"use strict";function Cursor(position,selectionEnd){this.position=position,this.selectionEnd=selectionEnd}return Cursor.fromJSON=function(obj){return new Cursor(obj.position,obj.selectionEnd)},Cursor.prototype.equals=function(other){return this.position===other.position&&this.selectionEnd===other.selectionEnd},Cursor.prototype.compose=function(other){return other},Cursor.prototype.transform=function(other){function transformIndex(index){for(var newIndex=index,ops=other.ops,i=0,l=other.ops.length;l>i&&(ops[i].isRetain()?index-=ops[i].chars:ops[i].isInsert()?newIndex+=ops[i].text.length:(newIndex-=Math.min(index,ops[i].chars),index-=ops[i].chars),!(0>index));i++);return newIndex}var newPosition=transformIndex(this.position);return this.position===this.selectionEnd?new Cursor(newPosition,newPosition):new Cursor(newPosition,transformIndex(this.selectionEnd))},Cursor}();var firepad=firepad||{};firepad.FirebaseAdapter=function(){function FirebaseAdapter(ref,userId,userColor){this.ref_=ref,this.ready_=!1,this.firebaseCallbacks_=[],this.zombie_=!1,this.document_=new TextOperation,this.revision_=0,this.pendingReceivedRevisions_={};var self=this;userId?(this.setUserId(userId),this.setColor(userColor),this.firebaseOn_(ref.root().child(".info/connected"),"value",function(snapshot){snapshot.val()===!0&&self.initializeUserData_()},this),this.on("ready",function(){self.monitorCursors_()})):this.userId_=ref.push().key(),setTimeout(function(){self.monitorHistory_()},0)}function assert(b,msg){if(!b)throw new Error(msg||"assertion error")}function revisionToId(revision){if(0===revision)return"A0";for(var str="";revision>0;){var digit=revision%characters.length;str=characters[digit]+str,revision-=digit,revision/=characters.length}var prefix=characters[str.length+9];return prefix+str}function revisionFromId(revisionId){assert(revisionId.length>0&&revisionId[0]===characters[revisionId.length+8]);for(var revision=0,i=1;i<revisionId.length;i++)revision*=characters.length,revision+=characters.indexOf(revisionId[i]);return revision}"function"==typeof require&&"function"!=typeof Firebase&&(Firebase=require("firebase"));var TextOperation=firepad.TextOperation,utils=firepad.utils,CHECKPOINT_FREQUENCY=100;utils.makeEventEmitter(FirebaseAdapter,["ready","cursor","operation","ack","retry"]),FirebaseAdapter.prototype.dispose=function(){this.removeFirebaseCallbacks_(),this.userRef_.child("cursor").remove(),this.userRef_.child("color").remove(),this.ref_=null,this.document_=null,this.zombie_=!0},FirebaseAdapter.prototype.setUserId=function(userId){this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("cursor").onDisconnect().cancel(),this.userRef_.child("color").remove(),this.userRef_.child("color").onDisconnect().cancel()),this.userId_=userId,this.userRef_=this.ref_.child("users").child(userId),this.initializeUserData_()},FirebaseAdapter.prototype.isHistoryEmpty=function(){return assert(this.ready_,"Not ready yet."),0===this.revision_},FirebaseAdapter.prototype.sendOperation=function(operation,callback){function doTransaction(revisionId,revisionData){self.ref_.child("history").child(revisionId).transaction(function(current){return null===current?revisionData:void 0},function(error,committed){if(error){if("disconnect"!==error.message)throw utils.log("Transaction failure!",error),error;self.sent_&&self.sent_.id===revisionId?setTimeout(function(){doTransaction(revisionId,revisionData)},0):callback&&callback(error,!1)}else callback&&callback(null,committed)},!1)}var self=this;if(!this.ready_)return this.on("ready",function(){self.trigger("retry")}),void 0;assert(this.document_.targetLength===operation.baseLength,"sendOperation() called with invalid operation.");var revisionId=revisionToId(this.revision_);this.sent_={id:revisionId,op:operation},doTransaction(revisionId,{a:self.userId_,o:operation.toJSON(),t:Firebase.ServerValue.TIMESTAMP})},FirebaseAdapter.prototype.sendCursor=function(obj){this.userRef_.child("cursor").set(obj),this.cursor_=obj},FirebaseAdapter.prototype.setColor=function(color){this.userRef_.child("color").set(color),this.color_=color},FirebaseAdapter.prototype.getDocument=function(){return this.document_},FirebaseAdapter.prototype.registerCallbacks=function(callbacks){for(var eventType in callbacks)this.on(eventType,callbacks[eventType])},FirebaseAdapter.prototype.initializeUserData_=function(){this.userRef_.child("cursor").onDisconnect().remove(),this.userRef_.child("color").onDisconnect().remove(),this.sendCursor(this.cursor_||null),this.setColor(this.color_||null)},FirebaseAdapter.prototype.monitorCursors_=function(){function childChanged(childSnap){var userId=childSnap.key(),userData=childSnap.val();self.trigger("cursor",userId,userData.cursor,userData.color)}var usersRef=this.ref_.child("users"),self=this;this.firebaseOn_(usersRef,"child_added",childChanged),this.firebaseOn_(usersRef,"child_changed",childChanged),this.firebaseOn_(usersRef,"child_removed",function(childSnap){var userId=childSnap.key();self.trigger("cursor",userId,null)})},FirebaseAdapter.prototype.monitorHistory_=function(){var self=this;this.ref_.child("checkpoint").once("value",function(s){if(!self.zombie_){var revisionId=s.child("id").val(),op=s.child("o").val(),author=s.child("a").val();null!=op&&null!=revisionId&&null!==author?(self.pendingReceivedRevisions_[revisionId]={o:op,a:author},self.checkpointRevision_=revisionFromId(revisionId),self.monitorHistoryStartingAt_(self.checkpointRevision_+1)):(self.checkpointRevision_=0,self.monitorHistoryStartingAt_(self.checkpointRevision_))}})},FirebaseAdapter.prototype.monitorHistoryStartingAt_=function(revision){var historyRef=this.ref_.child("history").startAt(null,revisionToId(revision)),self=this;setTimeout(function(){self.firebaseOn_(historyRef,"child_added",function(revisionSnapshot){var revisionId=revisionSnapshot.key();self.pendingReceivedRevisions_[revisionId]=revisionSnapshot.val(),self.ready_&&self.handlePendingReceivedRevisions_()}),historyRef.once("value",function(){self.handleInitialRevisions_()})},0)},FirebaseAdapter.prototype.handleInitialRevisions_=function(){assert(!this.ready_,"Should not be called multiple times."),this.revision_=this.checkpointRevision_;for(var revisionId=revisionToId(this.revision_),pending=this.pendingReceivedRevisions_;null!=pending[revisionId];){var revision=this.parseRevision_(pending[revisionId]);revision?this.document_=this.document_.compose(revision.operation):utils.log("Invalid operation.",this.ref_.toString(),revisionId,pending[revisionId]),delete pending[revisionId],this.revision_++,revisionId=revisionToId(this.revision_)}this.trigger("operation",this.document_),this.ready_=!0;var self=this;setTimeout(function(){self.trigger("ready")},0)},FirebaseAdapter.prototype.handlePendingReceivedRevisions_=function(){for(var pending=this.pendingReceivedRevisions_,revisionId=revisionToId(this.revision_),triggerRetry=!1;null!=pending[revisionId];){this.revision_++;var revision=this.parseRevision_(pending[revisionId]);revision?(this.document_=this.document_.compose(revision.operation),this.sent_&&revisionId===this.sent_.id?this.sent_.op.equals(revision.operation)&&revision.author===this.userId_?(this.revision_%CHECKPOINT_FREQUENCY===0&&this.saveCheckpoint_(),this.sent_=null,this.trigger("ack")):(triggerRetry=!0,this.trigger("operation",revision.operation)):this.trigger("operation",revision.operation)):utils.log("Invalid operation.",this.ref_.toString(),revisionId,pending[revisionId]),delete pending[revisionId],revisionId=revisionToId(this.revision_)}triggerRetry&&(this.sent_=null,this.trigger("retry"))},FirebaseAdapter.prototype.parseRevision_=function(data){if("object"!=typeof data)return null;if("string"!=typeof data.a||"object"!=typeof data.o)return null;var op=null;try{op=TextOperation.fromJSON(data.o)}catch(e){return null}return op.baseLength!==this.document_.targetLength?null:{author:data.a,operation:op}},FirebaseAdapter.prototype.saveCheckpoint_=function(){this.ref_.child("checkpoint").set({a:this.userId_,o:this.document_.toJSON(),id:revisionToId(this.revision_-1)})},FirebaseAdapter.prototype.firebaseOn_=function(ref,eventType,callback,context){return this.firebaseCallbacks_.push({ref:ref,eventType:eventType,callback:callback,context:context}),ref.on(eventType,callback,context),callback},FirebaseAdapter.prototype.firebaseOff_=function(ref,eventType,callback,context){ref.off(eventType,callback,context);for(var i=0;i<this.firebaseCallbacks_.length;i++){var l=this.firebaseCallbacks_[i];if(l.ref===ref&&l.eventType===eventType&&l.callback===callback&&l.context===context){this.firebaseCallbacks_.splice(i,1);break}}},FirebaseAdapter.prototype.removeFirebaseCallbacks_=function(){for(var i=0;i<this.firebaseCallbacks_.length;i++){var l=this.firebaseCallbacks_[i];l.ref.off(l.eventType,l.callback,l.context)}this.firebaseCallbacks_=[]};var characters="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";return FirebaseAdapter}();var firepad=firepad||{};firepad.RichTextToolbar=function(){function RichTextToolbar(imageInsertionUI){this.imageInsertionUI=imageInsertionUI,this.element_=this.makeElement_()}var utils=firepad.utils;return utils.makeEventEmitter(RichTextToolbar,["bold","italic","underline","strike","font","font-size","color","left","center","right","unordered-list","ordered-list","todo-list","indent-increase","indent-decrease","undo","redo","insert-image"]),RichTextToolbar.prototype.element=function(){return this.element_
},RichTextToolbar.prototype.makeButton_=function(eventName,iconName){var self=this;iconName=iconName||eventName;var btn=utils.elt("a",[utils.elt("span","",{"class":"firepad-tb-"+iconName})],{"class":"firepad-btn"});return utils.on(btn,"click",utils.stopEventAnd(function(){self.trigger(eventName)})),btn},RichTextToolbar.prototype.makeElement_=function(){var self=this,font=this.makeFontDropdown_(),fontSize=this.makeFontSizeDropdown_(),color=this.makeColorDropdown_(),toolbarOptions=[utils.elt("div",[font],{"class":"firepad-btn-group"}),utils.elt("div",[fontSize],{"class":"firepad-btn-group"}),utils.elt("div",[color],{"class":"firepad-btn-group"}),utils.elt("div",[self.makeButton_("bold"),self.makeButton_("italic"),self.makeButton_("underline"),self.makeButton_("strike","strikethrough")],{"class":"firepad-btn-group"}),utils.elt("div",[self.makeButton_("unordered-list","list-2"),self.makeButton_("ordered-list","numbered-list"),self.makeButton_("todo-list","list")],{"class":"firepad-btn-group"}),utils.elt("div",[self.makeButton_("indent-decrease"),self.makeButton_("indent-increase")],{"class":"firepad-btn-group"}),utils.elt("div",[self.makeButton_("left","paragraph-left"),self.makeButton_("center","paragraph-center"),self.makeButton_("right","paragraph-right")],{"class":"firepad-btn-group"}),utils.elt("div",[self.makeButton_("undo"),self.makeButton_("redo")],{"class":"firepad-btn-group"})];self.imageInsertionUI&&toolbarOptions.push(utils.elt("div",[self.makeButton_("insert-image")],{"class":"firepad-btn-group"}));var toolbarWrapper=utils.elt("div",toolbarOptions,{"class":"firepad-toolbar-wrapper"}),toolbar=utils.elt("div",null,{"class":"firepad-toolbar"});return toolbar.appendChild(toolbarWrapper),toolbar},RichTextToolbar.prototype.makeFontDropdown_=function(){for(var fonts=["Arial","Comic Sans MS","Courier New","Impact","Times New Roman","Verdana"],items=[],i=0;i<fonts.length;i++){var content=utils.elt("span",fonts[i]);content.setAttribute("style","font-family:"+fonts[i]),items.push({content:content,value:fonts[i]})}return this.makeDropdown_("Font","font",items)},RichTextToolbar.prototype.makeFontSizeDropdown_=function(){for(var sizes=[9,10,12,14,18,24,32,42],items=[],i=0;i<sizes.length;i++){var content=utils.elt("span",sizes[i].toString());content.setAttribute("style","font-size:"+sizes[i]+"px; line-height:"+(sizes[i]-6)+"px;"),items.push({content:content,value:sizes[i]})}return this.makeDropdown_("Size","font-size",items,"px")},RichTextToolbar.prototype.makeColorDropdown_=function(){for(var colors=["black","red","green","blue","yellow","cyan","magenta","grey"],items=[],i=0;i<colors.length;i++){var content=utils.elt("div");content.className="firepad-color-dropdown-item",content.setAttribute("style","background-color:"+colors[i]),items.push({content:content,value:colors[i]})}return this.makeDropdown_("Color","color",items)},RichTextToolbar.prototype.makeDropdown_=function(title,eventName,items,value_suffix){function showDropdown(){isShown||(list.style.display="block",utils.on(document,"click",hideDropdown,!0),isShown=!0)}function hideDropdown(){isShown&&(list.style.display="",utils.off(document,"click",hideDropdown,!0),isShown=!1),justDismissed=!0,setTimeout(function(){justDismissed=!1},0)}function addItem(content,value){"object"!=typeof content&&(content=document.createTextNode(String(content)));var element=utils.elt("a",[content]);utils.on(element,"click",utils.stopEventAnd(function(){hideDropdown(),self.trigger(eventName,value+value_suffix)})),list.appendChild(element)}value_suffix=value_suffix||"";var self=this,button=utils.elt("a",title+" \u25be",{"class":"firepad-btn firepad-dropdown"}),list=utils.elt("ul",[],{"class":"firepad-dropdown-menu"});button.appendChild(list);for(var isShown=!1,justDismissed=!1,i=0;i<items.length;i++){var content=items[i].content,value=items[i].value;addItem(content,value)}return utils.on(button,"click",utils.stopEventAnd(function(){justDismissed||showDropdown()})),button},RichTextToolbar}();var firepad=firepad||{};firepad.WrappedOperation=function(){"use strict";function WrappedOperation(operation,meta){this.wrapped=operation,this.meta=meta}function copy(source,target){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}function composeMeta(a,b){if(a&&"object"==typeof a){if("function"==typeof a.compose)return a.compose(b);var meta={};return copy(a,meta),copy(b,meta),meta}return b}function transformMeta(meta,operation){return meta&&"object"==typeof meta&&"function"==typeof meta.transform?meta.transform(operation):meta}return WrappedOperation.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)},WrappedOperation.prototype.invert=function(){var meta=this.meta;return new WrappedOperation(this.wrapped.invert.apply(this.wrapped,arguments),meta&&"object"==typeof meta&&"function"==typeof meta.invert?meta.invert.apply(meta,arguments):meta)},WrappedOperation.prototype.compose=function(other){return new WrappedOperation(this.wrapped.compose(other.wrapped),composeMeta(this.meta,other.meta))},WrappedOperation.transform=function(a,b){var transform=a.wrapped.constructor.transform,pair=transform(a.wrapped,b.wrapped);return[new WrappedOperation(pair[0],transformMeta(a.meta,b.wrapped)),new WrappedOperation(pair[1],transformMeta(b.meta,a.wrapped))]},WrappedOperation}();var firepad=firepad||{};firepad.UndoManager=function(){"use strict";function UndoManager(maxItems){this.maxItems=maxItems||50,this.state=NORMAL_STATE,this.dontCompose=!1,this.undoStack=[],this.redoStack=[]}function transformStack(stack,operation){for(var newStack=[],Operation=operation.constructor,i=stack.length-1;i>=0;i--){var pair=Operation.transform(stack[i],operation);"function"==typeof pair[0].isNoop&&pair[0].isNoop()||newStack.push(pair[0]),operation=pair[1]}return newStack.reverse()}var NORMAL_STATE="normal",UNDOING_STATE="undoing",REDOING_STATE="redoing";return UndoManager.prototype.add=function(operation,compose){if(this.state===UNDOING_STATE)this.redoStack.push(operation),this.dontCompose=!0;else if(this.state===REDOING_STATE)this.undoStack.push(operation),this.dontCompose=!0;else{var undoStack=this.undoStack;!this.dontCompose&&compose&&undoStack.length>0?undoStack.push(operation.compose(undoStack.pop())):(undoStack.push(operation),undoStack.length>this.maxItems&&undoStack.shift()),this.dontCompose=!1,this.redoStack=[]}},UndoManager.prototype.transform=function(operation){this.undoStack=transformStack(this.undoStack,operation),this.redoStack=transformStack(this.redoStack,operation)},UndoManager.prototype.performUndo=function(fn){if(this.state=UNDOING_STATE,0===this.undoStack.length)throw new Error("undo not possible");fn(this.undoStack.pop()),this.state=NORMAL_STATE},UndoManager.prototype.performRedo=function(fn){if(this.state=REDOING_STATE,0===this.redoStack.length)throw new Error("redo not possible");fn(this.redoStack.pop()),this.state=NORMAL_STATE},UndoManager.prototype.canUndo=function(){return 0!==this.undoStack.length},UndoManager.prototype.canRedo=function(){return 0!==this.redoStack.length},UndoManager.prototype.isUndoing=function(){return this.state===UNDOING_STATE},UndoManager.prototype.isRedoing=function(){return this.state===REDOING_STATE},UndoManager}();var firepad=firepad||{};firepad.Client=function(){"use strict";function Client(){this.state=synchronized_}function Synchronized(){}function AwaitingConfirm(outstanding){this.outstanding=outstanding}function AwaitingWithBuffer(outstanding,buffer){this.outstanding=outstanding,this.buffer=buffer}Client.prototype.setState=function(state){this.state=state},Client.prototype.applyClient=function(operation){this.setState(this.state.applyClient(this,operation))},Client.prototype.applyServer=function(operation){this.setState(this.state.applyServer(this,operation))},Client.prototype.serverAck=function(){this.setState(this.state.serverAck(this))},Client.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))},Client.prototype.sendOperation=function(){throw new Error("sendOperation must be defined in child class")},Client.prototype.applyOperation=function(){throw new Error("applyOperation must be defined in child class")},Client.Synchronized=Synchronized,Synchronized.prototype.applyClient=function(client,operation){return client.sendOperation(operation),new AwaitingConfirm(operation)},Synchronized.prototype.applyServer=function(client,operation){return client.applyOperation(operation),this},Synchronized.prototype.serverAck=function(){throw new Error("There is no pending operation.")},Synchronized.prototype.serverRetry=function(){throw new Error("There is no pending operation.")};var synchronized_=new Synchronized;return Client.AwaitingConfirm=AwaitingConfirm,AwaitingConfirm.prototype.applyClient=function(client,operation){return new AwaitingWithBuffer(this.outstanding,operation)},AwaitingConfirm.prototype.applyServer=function(client,operation){var pair=operation.constructor.transform(this.outstanding,operation);return client.applyOperation(pair[1]),new AwaitingConfirm(pair[0])},AwaitingConfirm.prototype.serverAck=function(){return synchronized_},AwaitingConfirm.prototype.serverRetry=function(client){return client.sendOperation(this.outstanding),this},Client.AwaitingWithBuffer=AwaitingWithBuffer,AwaitingWithBuffer.prototype.applyClient=function(client,operation){var newBuffer=this.buffer.compose(operation);return new AwaitingWithBuffer(this.outstanding,newBuffer)},AwaitingWithBuffer.prototype.applyServer=function(client,operation){var transform=operation.constructor.transform,pair1=transform(this.outstanding,operation),pair2=transform(this.buffer,pair1[1]);return client.applyOperation(pair2[1]),new AwaitingWithBuffer(pair1[0],pair2[0])},AwaitingWithBuffer.prototype.serverRetry=function(client){var outstanding=this.outstanding.compose(this.buffer);return client.sendOperation(outstanding),new AwaitingConfirm(outstanding)},AwaitingWithBuffer.prototype.serverAck=function(client){return client.sendOperation(this.buffer),new AwaitingConfirm(this.buffer)},Client}();var firepad=firepad||{};firepad.EditorClient=function(){"use strict";function SelfMeta(cursorBefore,cursorAfter){this.cursorBefore=cursorBefore,this.cursorAfter=cursorAfter}function OtherClient(id,editorAdapter){this.id=id,this.editorAdapter=editorAdapter,this.li=document.createElement("li")}function EditorClient(serverAdapter,editorAdapter){Client.call(this),this.serverAdapter=serverAdapter,this.editorAdapter=editorAdapter,this.undoManager=new UndoManager,this.clients={};var self=this;this.editorAdapter.registerCallbacks({change:function(operation,inverse){self.onChange(operation,inverse)},cursorActivity:function(){self.onCursorActivity()},blur:function(){self.onBlur()},focus:function(){self.onFocus()}}),this.editorAdapter.registerUndo(function(){self.undo()}),this.editorAdapter.registerRedo(function(){self.redo()}),this.serverAdapter.registerCallbacks({ack:function(){self.serverAck(),self.focused&&self.state instanceof Client.Synchronized&&(self.updateCursor(),self.sendCursor(self.cursor)),self.emitStatus()},retry:function(){self.serverRetry()},operation:function(operation){self.applyServer(operation)},cursor:function(clientId,cursor,color){if(self.serverAdapter.userId_!==clientId&&self.state instanceof Client.Synchronized){var client=self.getClientObject(clientId);cursor?(color&&client.setColor(color),client.updateCursor(Cursor.fromJSON(cursor))):client.removeCursor()}}})}function inherit(Const,Super){function F(){}F.prototype=Super.prototype,Const.prototype=new F,Const.prototype.constructor=Const}function last(arr){return arr[arr.length-1]}var Client=firepad.Client,Cursor=firepad.Cursor,UndoManager=firepad.UndoManager,WrappedOperation=firepad.WrappedOperation;return SelfMeta.prototype.invert=function(){return new SelfMeta(this.cursorAfter,this.cursorBefore)},SelfMeta.prototype.compose=function(other){return new SelfMeta(this.cursorBefore,other.cursorAfter)},SelfMeta.prototype.transform=function(operation){return new SelfMeta(this.cursorBefore?this.cursorBefore.transform(operation):null,this.cursorAfter?this.cursorAfter.transform(operation):null)},OtherClient.prototype.setColor=function(color){this.color=color},OtherClient.prototype.updateCursor=function(cursor){this.removeCursor(),this.cursor=cursor,this.mark=this.editorAdapter.setOtherCursor(cursor,this.color,this.id)},OtherClient.prototype.removeCursor=function(){this.mark&&this.mark.clear()},inherit(EditorClient,Client),EditorClient.prototype.getClientObject=function(clientId){var client=this.clients[clientId];return client?client:this.clients[clientId]=new OtherClient(clientId,this.editorAdapter)},EditorClient.prototype.applyUnredo=function(operation){this.undoManager.add(this.editorAdapter.invertOperation(operation)),this.editorAdapter.applyOperation(operation.wrapped),this.cursor=operation.meta.cursorAfter,this.cursor&&this.editorAdapter.setCursor(this.cursor),this.applyClient(operation.wrapped)},EditorClient.prototype.undo=function(){var self=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(o){self.applyUnredo(o)})},EditorClient.prototype.redo=function(){var self=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(o){self.applyUnredo(o)})},EditorClient.prototype.onChange=function(textOperation,inverse){var cursorBefore=this.cursor;this.updateCursor();var compose=this.undoManager.undoStack.length>0&&inverse.shouldBeComposedWithInverted(last(this.undoManager.undoStack).wrapped),inverseMeta=new SelfMeta(this.cursor,cursorBefore);this.undoManager.add(new WrappedOperation(inverse,inverseMeta),compose),this.applyClient(textOperation)},EditorClient.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()},EditorClient.prototype.onCursorActivity=function(){var oldCursor=this.cursor;this.updateCursor(),!this.focused||oldCursor&&this.cursor.equals(oldCursor)||this.sendCursor(this.cursor)},EditorClient.prototype.onBlur=function(){this.cursor=null,this.sendCursor(null),this.focused=!1},EditorClient.prototype.onFocus=function(){this.focused=!0,this.onCursorActivity()},EditorClient.prototype.sendCursor=function(cursor){this.state instanceof Client.AwaitingWithBuffer||this.serverAdapter.sendCursor(cursor)},EditorClient.prototype.sendOperation=function(operation){this.serverAdapter.sendOperation(operation),this.emitStatus()},EditorClient.prototype.applyOperation=function(operation){this.editorAdapter.applyOperation(operation),this.updateCursor(),this.undoManager.transform(new WrappedOperation(operation,null))},EditorClient.prototype.emitStatus=function(){var self=this;setTimeout(function(){self.trigger("synced",self.state instanceof Client.Synchronized)},0)},EditorClient}(),firepad.utils.makeEventEmitter(firepad.EditorClient,["synced"]);var ACEAdapter,firepad,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice;("undefined"==typeof firepad||null===firepad)&&(firepad={}),firepad.ACEAdapter=ACEAdapter=function(){function ACEAdapter(aceInstance){this.onCursorActivity=__bind(this.onCursorActivity,this),this.onFocus=__bind(this.onFocus,this),this.onBlur=__bind(this.onBlur,this),this.onChange=__bind(this.onChange,this);var _ref;this.ace=aceInstance,this.aceSession=this.ace.getSession(),this.aceDoc=this.aceSession.getDocument(),this.aceDoc.setNewLineMode("unix"),this.grabDocumentState(),this.ace.on("change",this.onChange),this.ace.on("blur",this.onBlur),this.ace.on("focus",this.onFocus),this.aceSession.selection.on("changeCursor",this.onCursorActivity),null==this.aceRange&&(this.aceRange=(null!=(_ref=ace.require)?_ref:require)("ace/range").Range)}return ACEAdapter.prototype.ignoreChanges=!1,ACEAdapter.prototype.grabDocumentState=function(){return this.lastDocLines=this.aceDoc.getAllLines(),this.lastCursorRange=this.aceSession.selection.getRange()},ACEAdapter.prototype.detach=function(){return this.ace.removeListener("change",this.onChange),this.ace.removeListener("blur",this.onBlur),this.ace.removeListener("focus",this.onCursorActivity),this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)},ACEAdapter.prototype.onChange=function(change){var pair;return this.ignoreChanges?void 0:(pair=this.operationFromACEChange(change),this.trigger.apply(this,["change"].concat(__slice.call(pair))),this.grabDocumentState())},ACEAdapter.prototype.onBlur=function(){return this.ace.selection.isEmpty()?this.trigger("blur"):void 0},ACEAdapter.prototype.onFocus=function(){return this.trigger("focus")},ACEAdapter.prototype.onCursorActivity=function(){var _this=this;return setTimeout(function(){return _this.trigger("cursorActivity")},0)},ACEAdapter.prototype.operationFromACEChange=function(change){var action,delta,inverse,operation,restLength,start,text,_ref,_ref1;return delta=change.data,"insertLines"===(_ref=delta.action)||"removeLines"===_ref?(text=delta.lines.join("\n")+"\n",action=delta.action.replace("Lines","")):(text=delta.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),action=delta.action.replace("Text","")),start=this.indexFromPos(delta.range.start),restLength=this.lastDocLines.join("\n").length-start,"remove"===action&&(restLength-=text.length),operation=(new firepad.TextOperation).retain(start).insert(text).retain(restLength),inverse=(new firepad.TextOperation).retain(start)["delete"](text).retain(restLength),"remove"===action&&(_ref1=[inverse,operation],operation=_ref1[0],inverse=_ref1[1]),[operation,inverse]},ACEAdapter.prototype.applyOperationToACE=function(operation){var from,index,op,range,to,_i,_len,_ref;for(index=0,_ref=operation.ops,_i=0,_len=_ref.length;_len>_i;_i++)op=_ref[_i],op.isRetain()?index+=op.chars:op.isInsert()?(this.aceDoc.insert(this.posFromIndex(index),op.text),index+=op.text.length):op.isDelete()&&(from=this.posFromIndex(index),to=this.posFromIndex(index+op.chars),range=this.aceRange.fromPoints(from,to),this.aceDoc.remove(range));return this.grabDocumentState()},ACEAdapter.prototype.posFromIndex=function(index){var line,row,_i,_len,_ref;for(_ref=this.aceDoc.$lines,row=_i=0,_len=_ref.length;_len>_i&&(line=_ref[row],!(index<=line.length));row=++_i)index-=line.length+1;return{row:row,column:index}},ACEAdapter.prototype.indexFromPos=function(pos,lines){var i,index,_i,_ref;for(null==lines&&(lines=this.lastDocLines),index=0,i=_i=0,_ref=pos.row;_ref>=0?_ref>_i:_i>_ref;i=_ref>=0?++_i:--_i)index+=this.lastDocLines[i].length+1;return index+=pos.column},ACEAdapter.prototype.getValue=function(){return this.aceDoc.getValue()},ACEAdapter.prototype.getCursor=function(){var e,e2,end,start,_ref,_ref1;try{start=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),end=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(_error){e=_error;try{start=this.indexFromPos(this.lastCursorRange.start),end=this.indexFromPos(this.lastCursorRange.end)}catch(_error){e2=_error,console.log("Couldn't figure out the cursor range:",e2,"-- setting it to 0:0."),_ref=[0,0],start=_ref[0],end=_ref[1]}}return start>end&&(_ref1=[end,start],start=_ref1[0],end=_ref1[1]),new firepad.Cursor(start,end)},ACEAdapter.prototype.setCursor=function(cursor){var end,start,_ref;return start=this.posFromIndex(cursor.position),end=this.posFromIndex(cursor.selectionEnd),cursor.position>cursor.selectionEnd&&(_ref=[end,start],start=_ref[0],end=_ref[1]),this.aceSession.selection.setSelectionRange(new this.aceRange(start.row,start.column,end.row,end.column))},ACEAdapter.prototype.setOtherCursor=function(cursor,color,clientId){var clazz,css,cursorRange,end,justCursor,self,start,_ref,_this=this;return null==this.otherCursors&&(this.otherCursors={}),cursorRange=this.otherCursors[clientId],cursorRange&&(cursorRange.start.detach(),cursorRange.end.detach(),this.aceSession.removeMarker(cursorRange.id)),start=this.posFromIndex(cursor.position),end=this.posFromIndex(cursor.selectionEnd),cursor.selectionEnd<cursor.position&&(_ref=[end,start],start=_ref[0],end=_ref[1]),clazz="other-client-selection-"+color.replace("#",""),justCursor=cursor.position===cursor.selectionEnd,justCursor&&(clazz=clazz.replace("selection","cursor")),css="."+clazz+" {\n  position: absolute;\n  background-color: "+(justCursor?"transparent":color)+";\n  border-left: 2px solid "+color+";\n}",this.addStyleRule(css),this.otherCursors[clientId]=cursorRange=new this.aceRange(start.row,start.column,end.row,end.column),self=this,cursorRange.clipRows=function(){var range;return range=self.aceRange.prototype.clipRows.apply(this,arguments),range.isEmpty=function(){return!1},range},cursorRange.start=this.aceDoc.createAnchor(cursorRange.start),cursorRange.end=this.aceDoc.createAnchor(cursorRange.end),cursorRange.id=this.aceSession.addMarker(cursorRange,clazz,"text"),{clear:function(){return cursorRange.start.detach(),cursorRange.end.detach(),_this.aceSession.removeMarker(cursorRange.id)}}},ACEAdapter.prototype.addStyleRule=function(css){var styleElement;if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},styleElement=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(styleElement),this.addedStyleSheet=styleElement.sheet),!this.addedStyleRules[css]))return this.addedStyleRules[css]=!0,this.addedStyleSheet.insertRule(css,0)},ACEAdapter.prototype.registerCallbacks=function(callbacks){this.callbacks=callbacks},ACEAdapter.prototype.trigger=function(){var args,event,_ref,_ref1;return event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],null!=(_ref=this.callbacks)?null!=(_ref1=_ref[event])?_ref1.apply(this,args):void 0:void 0},ACEAdapter.prototype.applyOperation=function(operation){return operation.isNoop()||(this.ignoreChanges=!0),this.applyOperationToACE(operation),this.ignoreChanges=!1},ACEAdapter.prototype.registerUndo=function(undoFn){return this.ace.undo=undoFn},ACEAdapter.prototype.registerRedo=function(redoFn){return this.ace.redo=redoFn},ACEAdapter.prototype.invertOperation=function(operation){return operation.invert(this.getValue())},ACEAdapter}();var firepad=firepad||{};firepad.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"},firepad.sentinelConstants={LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};var firepad=firepad||{};firepad.EntityManager=function(){function EntityManager(){this.entities_={};var attrs=["src","alt","width","height","style","class"];this.register("img",{render:function(info){utils.assert(info.src,"image entity should have 'src'!");for(var attrs=["src","alt","width","height","style","class"],html="<img ",i=0;i<attrs.length;i++){var attr=attrs[i];attr in info&&(html+=" "+attr+'="'+info[attr]+'"')}return html+=">"},fromElement:function(element){for(var info={},i=0;i<attrs.length;i++){var attr=attrs[i];element.hasAttribute(attr)&&(info[attr]=element.getAttribute(attr))}return info}})}var utils=firepad.utils;return EntityManager.prototype.register=function(type,options){firepad.utils.assert(options.render,"Entity options should include a 'render' function!"),firepad.utils.assert(options.fromElement,"Entity options should include a 'fromElement' function!"),this.entities_[type]=options},EntityManager.prototype.renderToElement=function(entity,entityHandle){return this.tryRenderToElement_(entity,"render",entityHandle)},EntityManager.prototype.exportToElement=function(entity){var elt=this.tryRenderToElement_(entity,"export")||this.tryRenderToElement_(entity,"getHtml")||this.tryRenderToElement_(entity,"render");return elt.setAttribute("data-firepad-entity",entity.type),elt},EntityManager.prototype.updateElement=function(entity,element){var type=entity.type,info=entity.info;this.entities_[type]&&"undefined"!=typeof this.entities_[type].update&&this.entities_[type].update(info,element)},EntityManager.prototype.fromElement=function(element){var type=element.getAttribute("data-firepad-entity");if(type||(type=element.nodeName.toLowerCase()),type&&this.entities_[type]){var info=this.entities_[type].fromElement(element);return new firepad.Entity(type,info)}},EntityManager.prototype.tryRenderToElement_=function(entity,renderFn,entityHandle){var type=entity.type,info=entity.info;if(this.entities_[type]&&this.entities_[type][renderFn]){var windowDocument=firepad.document||window&&window.document,res=this.entities_[type][renderFn](info,entityHandle,windowDocument);if(res){if("string"==typeof res){var div=(firepad.document||document).createElement("div");return div.innerHTML=res,div.childNodes[0]}if("object"==typeof res)return firepad.utils.assert("undefined"!=typeof res.nodeType,"Error rendering "+type+" entity.  render() function must return an html string or a DOM element."),res}}},EntityManager.prototype.entitySupportsUpdate=function(entityType){return this.entities_[entityType]&&this.entities_[entityType].update},EntityManager}();var firepad=firepad||{};firepad.Entity=function(){function Entity(type,info){return this instanceof Entity?(this.type=type,this.info=info||{},void 0):new Entity(type,info)}var ATTR=firepad.AttributeConstants,SENTINEL=ATTR.ENTITY_SENTINEL,PREFIX=SENTINEL+"_";return Entity.prototype.toAttributes=function(){var attrs={};attrs[SENTINEL]=this.type;for(var attr in this.info)attrs[PREFIX+attr]=this.info[attr];return attrs},Entity.fromAttributes=function(attributes){var type=attributes[SENTINEL],info={};for(var attr in attributes)0===attr.indexOf(PREFIX)&&(info[attr.substr(PREFIX.length)]=attributes[attr]);return new Entity(type,info)},Entity}();var firepad=firepad||{};firepad.RichTextCodeMirror=function(){function RichTextCodeMirror(codeMirror,entityManager,options){this.codeMirror=codeMirror,this.options_=options||{},this.entityManager_=entityManager,this.currentAttributes_=null;var self=this;this.annotationList_=new AnnotationList(function(oldNodes,newNodes){self.onAnnotationsChanged_(oldNodes,newNodes)}),this.initAnnotationList_(),bind(this,"onCodeMirrorBeforeChange_"),bind(this,"onCodeMirrorChange_"),bind(this,"onCursorActivity_"),/^4\./.test(CodeMirror.version)?this.codeMirror.on("changes",this.onCodeMirrorChange_):this.codeMirror.on("change",this.onCodeMirrorChange_),this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.on("cursorActivity",this.onCursorActivity_),this.changeId_=0,this.outstandingChanges_={},this.dirtyLines_=[]}function cmpPos(a,b){return a.line-b.line||a.ch-b.ch}function posLe(a,b){return cmpPos(a,b)<=0}function last(arr){return arr[arr.length-1]}function sumLengths(strArr){if(0===strArr.length)return 0;for(var sum=0,i=0;i<strArr.length;i++)sum+=strArr[i].length;return sum+strArr.length-1}function RichTextAnnotation(attributes){this.attributes=attributes||{}}function emptyAttributes(attributes){for(var attr in attributes)return!1;return!0}function bind(obj,method){var fn=obj[method];obj[method]=function(){fn.apply(obj,arguments)}}var AnnotationList=firepad.AnnotationList,Span=firepad.Span,utils=firepad.utils,ATTR=firepad.AttributeConstants,RichTextClassPrefixDefault="cmrt-",RichTextOriginPrefix="cmrt-",DynamicStyleAttributes={c:"color",bc:"background-color",fs:"font-size",li:function(indent){return"padding-left: "+40*indent+"px"}},StyleCache_={};utils.makeEventEmitter(RichTextCodeMirror,["change","attributesChange","newLine"]);var LineSentinelCharacter=firepad.sentinelConstants.LINE_SENTINEL_CHARACTER,EntitySentinelCharacter=firepad.sentinelConstants.ENTITY_SENTINEL_CHARACTER;return RichTextCodeMirror.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.off("change",this.onCodeMirrorChange_),this.codeMirror.off("changes",this.onCodeMirrorChange_),this.codeMirror.off("cursorActivity",this.onCursorActivity_),this.clearAnnotations_()},RichTextCodeMirror.prototype.toggleAttribute=function(attribute,value){var trueValue=value||!0;if(this.emptySelection_()){var attrs=this.getCurrentAttributes_();attrs[attribute]===trueValue?delete attrs[attribute]:attrs[attribute]=trueValue,this.currentAttributes_=attrs}else{var attributes=this.getCurrentAttributes_(),newValue=attributes[attribute]!==trueValue?trueValue:!1;this.setAttribute(attribute,newValue)}},RichTextCodeMirror.prototype.setAttribute=function(attribute,value){var cm=this.codeMirror;if(this.emptySelection_()){var attrs=this.getCurrentAttributes_();value===!1?delete attrs[attribute]:attrs[attribute]=value,this.currentAttributes_=attrs}else this.updateTextAttributes(cm.indexFromPos(cm.getCursor("start")),cm.indexFromPos(cm.getCursor("end")),function(attributes){value===!1?delete attributes[attribute]:attributes[attribute]=value}),this.updateCurrentAttributes_()},RichTextCodeMirror.prototype.updateTextAttributes=function(start,end,updateFn,origin,doLineAttributes){var newChanges=[],pos=start,self=this;this.annotationList_.updateSpan(new Span(start,end-start),function(annotation,length){var attributes={};for(var attr in annotation.attributes)attributes[attr]=annotation.attributes[attr];(!attributes[ATTR.LINE_SENTINEL]||doLineAttributes)&&updateFn(attributes);var changedAttributes={},changedAttributesInverse={};return self.computeChangedAttributes_(annotation.attributes,attributes,changedAttributes,changedAttributesInverse),emptyAttributes(changedAttributes)||newChanges.push({start:pos,end:pos+length,attributes:changedAttributes,attributesInverse:changedAttributesInverse,origin:origin}),pos+=length,new RichTextAnnotation(attributes)}),newChanges.length>0&&this.trigger("attributesChange",this,newChanges)},RichTextCodeMirror.prototype.computeChangedAttributes_=function(oldAttrs,newAttrs,changed,inverseChanged){var attr,attrs={};for(attr in oldAttrs)attrs[attr]=!0;for(attr in newAttrs)attrs[attr]=!0;for(attr in attrs)attr in newAttrs?attr in oldAttrs?oldAttrs[attr]!==newAttrs[attr]&&(changed[attr]=newAttrs[attr],inverseChanged[attr]=oldAttrs[attr]):(changed[attr]=newAttrs[attr],inverseChanged[attr]=!1):(changed[attr]=!1,inverseChanged[attr]=oldAttrs[attr])},RichTextCodeMirror.prototype.toggleLineAttribute=function(attribute,value){var newValue,currentAttributes=this.getCurrentLineAttributes_();newValue=attribute in currentAttributes&&currentAttributes[attribute]===value?!1:value,this.setLineAttribute(attribute,newValue)},RichTextCodeMirror.prototype.setLineAttribute=function(attribute,value){this.updateLineAttributesForSelection(function(attributes){value===!1?delete attributes[attribute]:attributes[attribute]=value})},RichTextCodeMirror.prototype.updateLineAttributesForSelection=function(updateFn){var cm=this.codeMirror,start=cm.getCursor("start"),end=cm.getCursor("end"),startLine=start.line,endLine=end.line,endLineText=cm.getLine(endLine),endsAtBeginningOfLine=this.areLineSentinelCharacters_(endLineText.substr(0,end.ch));endLine>startLine&&endsAtBeginningOfLine&&endLine--,this.updateLineAttributes(startLine,endLine,updateFn)},RichTextCodeMirror.prototype.updateLineAttributes=function(startLine,endLine,updateFn){for(var line=startLine;endLine>=line;line++){var text=this.codeMirror.getLine(line),lineStartIndex=this.codeMirror.indexFromPos({line:line,ch:0});if(text[0]!==LineSentinelCharacter){var attributes={};attributes[ATTR.LINE_SENTINEL]=!0,updateFn(attributes),this.insertText(lineStartIndex,LineSentinelCharacter,attributes)}else this.updateTextAttributes(lineStartIndex,lineStartIndex+1,updateFn,null,!0)}},RichTextCodeMirror.prototype.replaceText=function(start,end,text,attributes,origin){this.changeId_++;var newOrigin=RichTextOriginPrefix+this.changeId_;this.outstandingChanges_[newOrigin]={origOrigin:origin,attributes:attributes};var cm=this.codeMirror,from=cm.posFromIndex(start),to="number"==typeof end?cm.posFromIndex(end):null;cm.replaceRange(text,from,to,newOrigin)},RichTextCodeMirror.prototype.insertText=function(index,text,attributes,origin){var cm=this.codeMirror,cursor=cm.getCursor(),resetCursor="RTCMADAPTER"==origin&&!cm.somethingSelected()&&index==cm.indexFromPos(cursor);this.replaceText(index,null,text,attributes,origin),resetCursor&&cm.setCursor(cursor)},RichTextCodeMirror.prototype.removeText=function(start,end,origin){var cm=this.codeMirror;cm.replaceRange("",cm.posFromIndex(start),cm.posFromIndex(end),origin)},RichTextCodeMirror.prototype.insertEntityAtCursor=function(type,info,origin){var cm=this.codeMirror,index=cm.indexFromPos(cm.getCursor("head"));this.insertEntityAt(index,type,info,origin)},RichTextCodeMirror.prototype.insertEntityAt=function(index,type,info,origin){this.codeMirror;this.insertEntity_(index,new firepad.Entity(type,info),origin)},RichTextCodeMirror.prototype.insertEntity_=function(index,entity,origin){this.replaceText(index,null,EntitySentinelCharacter,entity.toAttributes(),origin)
},RichTextCodeMirror.prototype.getAttributeSpans=function(start,end){for(var spans=[],annotatedSpans=this.annotationList_.getAnnotatedSpansForSpan(new Span(start,end-start)),i=0;i<annotatedSpans.length;i++)spans.push({length:annotatedSpans[i].length,attributes:annotatedSpans[i].annotation.attributes});return spans},RichTextCodeMirror.prototype.end=function(){var lastLine=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:lastLine,ch:this.codeMirror.getLine(lastLine).length})},RichTextCodeMirror.prototype.getRange=function(start,end){var from=this.codeMirror.posFromIndex(start),to=this.codeMirror.posFromIndex(end);return this.codeMirror.getRange(from,to)},RichTextCodeMirror.prototype.initAnnotationList_=function(){var end=this.end();0!==end&&this.annotationList_.insertAnnotatedSpan(new Span(0,end),new RichTextAnnotation)},RichTextCodeMirror.prototype.onAnnotationsChanged_=function(oldNodes,newNodes){var marker,linesToReMark={};this.tryToUpdateEntitiesInPlace(oldNodes,newNodes);for(var i=0;i<oldNodes.length;i++){var attributes=oldNodes[i].annotation.attributes;ATTR.LINE_SENTINEL in attributes&&(linesToReMark[this.codeMirror.posFromIndex(oldNodes[i].pos).line]=!0),marker=oldNodes[i].getAttachedObject(),marker&&marker.clear()}for(i=0;i<newNodes.length;i++){var annotation=newNodes[i].annotation,forLine=ATTR.LINE_SENTINEL in annotation.attributes,entity=ATTR.ENTITY_SENTINEL in annotation.attributes,from=this.codeMirror.posFromIndex(newNodes[i].pos);if(forLine)linesToReMark[from.line]=!0;else if(entity)this.markEntity_(newNodes[i]);else{var className=this.getClassNameForAttributes_(annotation.attributes);if(""!==className){var to=this.codeMirror.posFromIndex(newNodes[i].pos+newNodes[i].length);marker=this.codeMirror.markText(from,to,{className:className}),newNodes[i].attachObject(marker)}}}for(var line in linesToReMark)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(line))),this.queueLineMarking_()},RichTextCodeMirror.prototype.tryToUpdateEntitiesInPlace=function(oldNodes,newNodes){for(var oldNodesLen=oldNodes.length;oldNodesLen--;)for(var oldNode=oldNodes[oldNodesLen],newNodesLen=newNodes.length;newNodesLen--;){var newNode=newNodes[newNodesLen];if(oldNode.pos==newNode.pos&&oldNode.length==newNode.length&&oldNode.annotation.attributes.ent&&oldNode.annotation.attributes.ent==newNode.annotation.attributes.ent){var entityType=newNode.annotation.attributes.ent;if(this.entityManager_.entitySupportsUpdate(entityType)){oldNodes.splice(oldNodesLen,1),newNodes.splice(newNodesLen,1);var marker=oldNode.getAttachedObject();marker.update(newNode.annotation.attributes),newNode.attachObject(marker)}}}},RichTextCodeMirror.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var self=this;this.lineMarkTimeout_=setTimeout(function(){self.lineMarkTimeout_=null;for(var dirtyLineNumbers=[],i=0;i<self.dirtyLines_.length;i++){var lineNum=self.codeMirror.getLineNumber(self.dirtyLines_[i]);dirtyLineNumbers.push(Number(lineNum))}self.dirtyLines_=[],dirtyLineNumbers.sort(function(a,b){return a-b});var lastLineMarked=-1;for(i=0;i<dirtyLineNumbers.length;i++){var lineNumber=dirtyLineNumbers[i];lineNumber>lastLineMarked&&(lastLineMarked=self.markLineSentinelCharactersForChangedLines_(lineNumber,lineNumber))}},0)}},RichTextCodeMirror.prototype.addStyleWithCSS_=function(css){var head=document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css",style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css)),head.appendChild(style)},RichTextCodeMirror.prototype.getClassNameForAttributes_=function(attributes){var globalClassName="";for(var attr in attributes){var val=attributes[attr];if(attr===ATTR.LINE_SENTINEL)firepad.utils.assert(val===!0,"LINE_SENTINEL attribute should be true if it exists.");else{var className=(this.options_.cssPrefix||RichTextClassPrefixDefault)+attr;if(val!==!0){attr===ATTR.FONT_SIZE&&"string"!=typeof val&&(val+="px");var classVal=val.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");if(className+="-"+classVal,DynamicStyleAttributes[attr]&&(StyleCache_[attr]||(StyleCache_[attr]={}),!StyleCache_[attr][classVal])){StyleCache_[attr][classVal]=!0;var dynStyle=DynamicStyleAttributes[attr],css="function"==typeof dynStyle?dynStyle(val):dynStyle+": "+val,selector=attr==ATTR.LINE_INDENT?"pre."+className:"."+className;this.addStyleWithCSS_(selector+" { "+css+" }")}}globalClassName=globalClassName+" "+className}}return globalClassName},RichTextCodeMirror.prototype.markEntity_=function(annotationNode){for(var attributes=annotationNode.annotation.attributes,entity=firepad.Entity.fromAttributes(attributes),cm=this.codeMirror,self=this,markers=[],i=0;i<annotationNode.length;i++){var from=cm.posFromIndex(annotationNode.pos+i),to=cm.posFromIndex(annotationNode.pos+i+1),options={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},entityHandle=this.createEntityHandle_(entity,annotationNode.pos),element=this.entityManager_.renderToElement(entity,entityHandle);element&&(options.replacedWith=element);var marker=cm.markText(from,to,options);markers.push(marker),entityHandle.setMarker(marker)}annotationNode.attachObject({clear:function(){for(var i=0;i<markers.length;i++)markers[i].clear()},update:function(info){for(var entity=firepad.Entity.fromAttributes(info),i=0;i<markers.length;i++)self.entityManager_.updateElement(entity,markers[i].replacedWith)}}),this.queueRefresh_()},RichTextCodeMirror.prototype.queueRefresh_=function(){var self=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(function(){self.codeMirror.refresh(),self.refreshTimer_=null},0))},RichTextCodeMirror.prototype.createEntityHandle_=function(entity,location){function find(){if(marker){var where=marker.find();return where?self.codeMirror.indexFromPos(where.from):null}return location}function remove(){var at=find();null!=at&&(self.codeMirror.focus(),self.removeText(at,at+1))}function replace(info){var ATTR=firepad.AttributeConstants,SENTINEL=ATTR.ENTITY_SENTINEL,PREFIX=SENTINEL+"_",at=find();self.updateTextAttributes(at,at+1,function(attrs){for(var member in attrs)delete attrs[member];attrs[SENTINEL]=entity.type;for(var attr in info)attrs[PREFIX+attr]=info[attr]})}function setMarker(m){marker=m}var marker=null,self=this;return{find:find,remove:remove,replace:replace,setMarker:setMarker}},RichTextCodeMirror.prototype.lineClassRemover_=function(lineNum){var cm=this.codeMirror,lineHandle=cm.getLineHandle(lineNum);return{clear:function(){cm.removeLineClass(lineHandle,"text",".*")}}},RichTextCodeMirror.prototype.emptySelection_=function(){var start=this.codeMirror.getCursor("start"),end=this.codeMirror.getCursor("end");return start.line===end.line&&start.ch===end.ch},RichTextCodeMirror.prototype.onCodeMirrorBeforeChange_=function(cm,change){if("+input"===change.origin||"paste"===change.origin){for(var newText=[],i=0;i<change.text.length;i++){var t=change.text[i];t=t.replace(new RegExp("["+LineSentinelCharacter+EntitySentinelCharacter+"]","g"),""),newText.push(t)}change.update(change.from,change.to,newText)}},RichTextCodeMirror.prototype.onCodeMirrorChange_=function(cm,cmChanges){if("object"==typeof cmChanges.from){for(var changeArray=[];cmChanges;)changeArray.push(cmChanges),cmChanges=cmChanges.next;cmChanges=changeArray}for(var changes=this.convertCoordinateSystemForChanges_(cmChanges),newChanges=[],i=0;i<changes.length;i++){var change=changes[i],start=change.start,text=(change.end,change.text),removed=change.removed,origin=change.origin;if(removed.length>0){for(var oldAnnotationSpans=this.annotationList_.getAnnotatedSpansForSpan(new Span(start,removed.length)),removedPos=0,j=0;j<oldAnnotationSpans.length;j++){var span=oldAnnotationSpans[j];newChanges.push({start:start,end:start+span.length,removedAttributes:span.annotation.attributes,removed:removed.substr(removedPos,span.length),attributes:{},text:"",origin:change.origin}),removedPos+=span.length}this.annotationList_.removeSpan(new Span(start,removed.length))}if(text.length>0){var attributes;"+input"===change.origin||"paste"===change.origin?attributes=this.currentAttributes_||{}:origin in this.outstandingChanges_?(attributes=this.outstandingChanges_[origin].attributes,origin=this.outstandingChanges_[origin].origOrigin,delete this.outstandingChanges_[origin]):attributes={},this.annotationList_.insertAnnotatedSpan(new Span(start,text.length),new RichTextAnnotation(attributes)),newChanges.push({start:start,end:start,removedAttributes:{},removed:"",text:text,attributes:attributes,origin:origin})}}this.markLineSentinelCharactersForChanges_(cmChanges),newChanges.length>0&&this.trigger("change",this,newChanges)},RichTextCodeMirror.prototype.convertCoordinateSystemForChanges_=function(changes){function updateIndexFromPos(indexFromPos,change){return function(pos){return posLe(pos,change.from)?indexFromPos(pos):posLe(change.to,pos)?indexFromPos({line:pos.line+change.text.length-1-(change.to.line-change.from.line),ch:change.to.line<pos.line?pos.ch:change.text.length<=1?pos.ch-(change.to.ch-change.from.ch)+sumLengths(change.text):pos.ch-change.to.ch+last(change.text).length})+sumLengths(change.removed)-sumLengths(change.text):change.from.line===pos.line?indexFromPos(change.from)+pos.ch-change.from.ch:indexFromPos(change.from)+sumLengths(change.removed.slice(0,pos.line-change.from.line))+1+pos.ch}}for(var self=this,indexFromPos=function(pos){return self.codeMirror.indexFromPos(pos)},newChanges=[],i=changes.length-1;i>=0;i--){var change=changes[i];indexFromPos=updateIndexFromPos(indexFromPos,change);var start=indexFromPos(change.from),removedText=change.removed.join("\n"),text=change.text.join("\n");newChanges.unshift({start:start,end:start+removedText.length,removed:removedText,text:text,origin:change.origin})}return newChanges},RichTextCodeMirror.prototype.markLineSentinelCharactersForChanges_=function(changes){for(var startLine=Number.MAX_VALUE,endLine=-1,i=0;i<changes.length;i++){{var change=changes[i],line=change.from.line;change.from.ch}(change.removed.length>1||change.removed[0].indexOf(LineSentinelCharacter)>=0)&&(startLine=Math.min(startLine,line),endLine=Math.max(endLine,line)),change.text.length>1?(startLine=Math.min(startLine,line),endLine=Math.max(endLine,line+change.text.length-1)):change.text[0].indexOf(LineSentinelCharacter)>=0&&(startLine=Math.min(startLine,line),endLine=Math.max(endLine,line))}endLine=Math.min(endLine,this.codeMirror.lineCount()-1),this.markLineSentinelCharactersForChangedLines_(startLine,endLine)},RichTextCodeMirror.prototype.markLineSentinelCharactersForChangedLines_=function(startLine,endLine){if(startLine<Number.MAX_VALUE)for(;startLine>0&&this.lineIsListItemOrIndented_(startLine-1);)startLine--;if(endLine>-1)for(var lineCount=this.codeMirror.lineCount();lineCount>endLine+1&&this.lineIsListItemOrIndented_(endLine+1);)endLine++;for(var listNumber=[],cm=this.codeMirror,line=startLine;endLine>=line;line++){var text=cm.getLine(line),lineHandle=cm.getLineHandle(line);if(cm.removeLineClass(lineHandle,"text",".*"),text.length>0)for(var markIndex=text.indexOf(LineSentinelCharacter);markIndex>=0;){for(var markStartIndex=markIndex;markIndex<text.length&&text[markIndex]===LineSentinelCharacter;){for(var marks=cm.findMarksAt({line:line,ch:markIndex}),i=0;i<marks.length;i++)marks[i].isForLineSentinel&&marks[i].clear();markIndex++}this.markLineSentinelCharacters_(line,markStartIndex,markIndex,listNumber),markIndex=text.indexOf(LineSentinelCharacter,markIndex)}else listNumber=[]}return endLine},RichTextCodeMirror.prototype.markLineSentinelCharacters_=function(line,startIndex,endIndex,listNumber){var cm=this.codeMirror,element=null,marker=null,getMarkerLine=function(){var span=marker.find();return span?span.from.line:null};if(0===startIndex){var attributes=this.getLineAttributes_(line),listType=attributes[ATTR.LIST_TYPE],indent=attributes[ATTR.LINE_INDENT]||0;for(listType&&0===indent&&(indent=1);indent>=listNumber.length;)listNumber.push(1);"o"===listType?(element=this.makeOrderedListElement_(listNumber[indent]),listNumber[indent]++):"u"===listType?(element=this.makeUnorderedListElement_(),listNumber[indent]=1):"t"===listType?(element=this.makeTodoListElement_(!1,getMarkerLine),listNumber[indent]=1):"tc"===listType&&(element=this.makeTodoListElement_(!0,getMarkerLine),listNumber[indent]=1);var className=this.getClassNameForAttributes_(attributes);""!==className&&this.codeMirror.addLineClass(line,"text",className),listNumber=listNumber.slice(0,indent+1)}var markerOptions={inclusiveLeft:!0,collapsed:!0};element&&(markerOptions.replacedWith=element);var marker=cm.markText({line:line,ch:startIndex},{line:line,ch:endIndex},markerOptions);marker.isForLineSentinel=!0},RichTextCodeMirror.prototype.makeOrderedListElement_=function(number){return utils.elt("div",number+".",{"class":"firepad-list-left"})},RichTextCodeMirror.prototype.makeUnorderedListElement_=function(){return utils.elt("div","\u2022",{"class":"firepad-list-left"})},RichTextCodeMirror.prototype.toggleTodo=function(noRemove){var newValue,attribute=ATTR.LIST_TYPE,currentAttributes=this.getCurrentLineAttributes_();attribute in currentAttributes&&("t"===currentAttributes[attribute]||"tc"===currentAttributes[attribute])?"t"===currentAttributes[attribute]?newValue="tc":"tc"===currentAttributes[attribute]&&(newValue=noRemove?"t":!1):newValue="t",this.setLineAttribute(attribute,newValue)},RichTextCodeMirror.prototype.makeTodoListElement_=function(checked,getMarkerLine){var params={type:"checkbox","class":"firepad-todo-left"};checked&&(params.checked=!0);var el=utils.elt("input",!1,params),self=this;return utils.on(el,"click",utils.stopEventAnd(function(){self.codeMirror.setCursor({line:getMarkerLine(),ch:1}),self.toggleTodo(!0)})),el},RichTextCodeMirror.prototype.lineIsListItemOrIndented_=function(lineNum){var attrs=this.getLineAttributes_(lineNum);return(attrs[ATTR.LIST_TYPE]||!1)!==!1||0!==(attrs[ATTR.LINE_INDENT]||0)},RichTextCodeMirror.prototype.onCursorActivity_=function(){var self=this;clearTimeout(self.cursorTimeout),self.cursorTimeout=setTimeout(function(){self.updateCurrentAttributes_()},1)},RichTextCodeMirror.prototype.getCurrentAttributes_=function(){return this.currentAttributes_||this.updateCurrentAttributes_(),this.currentAttributes_},RichTextCodeMirror.prototype.updateCurrentAttributes_=function(){var cm=this.codeMirror,anchor=cm.indexFromPos(cm.getCursor("anchor")),head=cm.indexFromPos(cm.getCursor("head")),pos=head;if(anchor>head){for(;pos<this.end();){var c=this.getRange(pos,pos+1);if("\n"!==c&&c!==LineSentinelCharacter)break;pos++}pos<this.end()&&pos++}else for(;pos>0&&(c=this.getRange(pos-1,pos),"\n"===c||c===LineSentinelCharacter);)pos--;var spans=this.annotationList_.getAnnotatedSpansForPos(pos);this.currentAttributes_={};var attributes={};spans.length>0&&!(ATTR.LINE_SENTINEL in spans[0].annotation.attributes)?attributes=spans[0].annotation.attributes:spans.length>1&&(firepad.utils.assert(!(ATTR.LINE_SENTINEL in spans[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),attributes=spans[1].annotation.attributes);for(var attr in attributes)"l"!==attr&&"lt"!==attr&&"li"!==attr&&0!==attr.indexOf(ATTR.ENTITY_SENTINEL)&&(this.currentAttributes_[attr]=attributes[attr])},RichTextCodeMirror.prototype.getCurrentLineAttributes_=function(){var cm=this.codeMirror,anchor=cm.getCursor("anchor"),head=cm.getCursor("head"),line=head.line;return 0===head.ch&&anchor.line<head.line&&line--,this.getLineAttributes_(line)},RichTextCodeMirror.prototype.getLineAttributes_=function(lineNum){var attributes={},line=this.codeMirror.getLine(lineNum);if(line.length>0&&line[0]===LineSentinelCharacter){var lineStartIndex=this.codeMirror.indexFromPos({line:lineNum,ch:0}),spans=this.annotationList_.getAnnotatedSpansForSpan(new Span(lineStartIndex,1));firepad.utils.assert(1===spans.length);for(var attr in spans[0].annotation.attributes)attributes[attr]=spans[0].annotation.attributes[attr]}return attributes},RichTextCodeMirror.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new Span(0,this.end()),function(){return new RichTextAnnotation({})})},RichTextCodeMirror.prototype.newline=function(){var cm=this.codeMirror,self=this;if(this.emptySelection_()){var cursorLine=cm.getCursor("head").line,lineAttributes=this.getLineAttributes_(cursorLine),listType=lineAttributes[ATTR.LIST_TYPE];listType&&1===cm.getLine(cursorLine).length?this.updateLineAttributes(cursorLine,cursorLine,function(attributes){delete attributes[ATTR.LIST_TYPE],delete attributes[ATTR.LINE_INDENT]}):(cm.replaceSelection("\n","end","+input"),this.updateLineAttributes(cursorLine+1,cursorLine+1,function(attributes){for(var attr in lineAttributes)attributes[attr]=lineAttributes[attr];"tc"===listType&&(attributes[ATTR.LIST_TYPE]="t"),self.trigger("newLine",{line:cursorLine+1,attr:attributes})}))}else cm.replaceSelection("\n","end","+input")},RichTextCodeMirror.prototype.deleteLeft=function(){var cm=this.codeMirror,cursorPos=cm.getCursor("head"),lineAttributes=this.getLineAttributes_(cursorPos.line),listType=lineAttributes[ATTR.LIST_TYPE],indent=lineAttributes[ATTR.LINE_INDENT],backspaceAtStartOfLine=this.emptySelection_()&&1===cursorPos.ch;backspaceAtStartOfLine&&listType?this.updateLineAttributes(cursorPos.line,cursorPos.line,function(attributes){delete attributes[ATTR.LIST_TYPE],delete attributes[ATTR.LINE_INDENT]}):backspaceAtStartOfLine&&indent&&indent>0?this.unindent():cm.deleteH(-1,"char")},RichTextCodeMirror.prototype.deleteRight=function(){var cm=this.codeMirror,cursorPos=cm.getCursor("head"),text=cm.getLine(cursorPos.line),emptyLine=this.areLineSentinelCharacters_(text),nextLineText=cursorPos.line+1<cm.lineCount()?cm.getLine(cursorPos.line+1):"";this.emptySelection_()&&emptyLine&&nextLineText[0]===LineSentinelCharacter?cm.replaceRange("",{line:cursorPos.line,ch:0},{line:cursorPos.line+1,ch:0},"+input"):cm.deleteH(1,"char")},RichTextCodeMirror.prototype.indent=function(){this.updateLineAttributesForSelection(function(attributes){var indent=attributes[ATTR.LINE_INDENT],listType=attributes[ATTR.LIST_TYPE];indent?attributes[ATTR.LINE_INDENT]++:attributes[ATTR.LINE_INDENT]=listType?2:1})},RichTextCodeMirror.prototype.unindent=function(){this.updateLineAttributesForSelection(function(attributes){var indent=attributes[ATTR.LINE_INDENT];indent&&indent>1?attributes[ATTR.LINE_INDENT]=indent-1:(delete attributes[ATTR.LIST_TYPE],delete attributes[ATTR.LINE_INDENT])})},RichTextCodeMirror.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(LineSentinelCharacter,"g"),"")},RichTextCodeMirror.prototype.areLineSentinelCharacters_=function(text){for(var i=0;i<text.length;i++)if(text[i]!==LineSentinelCharacter)return!1;return!0},RichTextAnnotation.prototype.equals=function(other){if(!(other instanceof RichTextAnnotation))return!1;var attr;for(attr in this.attributes)if(other.attributes[attr]!==this.attributes[attr])return!1;for(attr in other.attributes)if(other.attributes[attr]!==this.attributes[attr])return!1;return!0},RichTextCodeMirror}();var firepad=firepad||{};firepad.RichTextCodeMirrorAdapter=function(){"use strict";function RichTextCodeMirrorAdapter(rtcm){this.rtcm=rtcm,this.cm=rtcm.codeMirror,bind(this,"onChange"),bind(this,"onAttributesChange"),bind(this,"onCursorActivity"),bind(this,"onFocus"),bind(this,"onBlur"),this.rtcm.on("change",this.onChange),this.rtcm.on("attributesChange",this.onAttributesChange),this.cm.on("cursorActivity",this.onCursorActivity),this.cm.on("focus",this.onFocus),this.cm.on("blur",this.onBlur)}function cmpPos(a,b){return a.line<b.line?-1:a.line>b.line?1:a.ch<b.ch?-1:a.ch>b.ch?1:0}function posEq(a,b){return 0===cmpPos(a,b)}function codemirrorLength(cm){var lastLine=cm.lineCount()-1;return cm.indexFromPos({line:lastLine,ch:cm.getLine(lastLine).length})}function assert(b,msg){if(!b)throw new Error(msg||"assertion error")}function bind(obj,method){var fn=obj[method];obj[method]=function(){fn.apply(obj,arguments)}}function emptyAttributes(attrs){for(var attr in attrs)return!1;return!0}var TextOperation=firepad.TextOperation,WrappedOperation=firepad.WrappedOperation,Cursor=firepad.Cursor;return RichTextCodeMirrorAdapter.prototype.detach=function(){this.rtcm.off("change",this.onChange),this.rtcm.off("attributesChange",this.onAttributesChange),this.cm.off("cursorActivity",this.onCursorActivity),this.cm.off("focus",this.onFocus),this.cm.off("blur",this.onBlur)},RichTextCodeMirrorAdapter.operationFromCodeMirrorChanges=function(changes,cm){for(var docEndLength=codemirrorLength(cm),operation=(new TextOperation).retain(docEndLength),inverse=(new TextOperation).retain(docEndLength),i=changes.length-1;i>=0;i--){var change=changes[i],fromIndex=change.start,restLength=docEndLength-fromIndex-change.text.length;operation=(new TextOperation).retain(fromIndex)["delete"](change.removed.length).insert(change.text,change.attributes).retain(restLength).compose(operation),inverse=inverse.compose((new TextOperation).retain(fromIndex)["delete"](change.text.length).insert(change.removed,change.removedAttributes).retain(restLength)),docEndLength+=change.removed.length-change.text.length}return[operation,inverse]},RichTextCodeMirrorAdapter.operationFromAttributesChanges=function(changes,cm){for(var docEndLength=codemirrorLength(cm),operation=new TextOperation,inverse=new TextOperation,pos=0,i=0;i<changes.length;i++){var change=changes[i],toRetain=change.start-pos;assert(toRetain>=0),operation.retain(toRetain),inverse.retain(toRetain);var length=change.end-change.start;operation.retain(length,change.attributes),inverse.retain(length,change.attributesInverse),pos=change.start+length}return operation.retain(docEndLength-pos),inverse.retain(docEndLength-pos),[operation,inverse]},RichTextCodeMirrorAdapter.applyOperationToCodeMirror=function(operation,rtcm){operation.ops.length>10&&rtcm.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var ops=operation.ops,index=0,i=0,l=ops.length;l>i;i++){var op=ops[i];op.isRetain()?(emptyAttributes(op.attributes)||rtcm.updateTextAttributes(index,index+op.chars,function(attributes){for(var attr in op.attributes)op.attributes[attr]===!1?delete attributes[attr]:attributes[attr]=op.attributes[attr]},"RTCMADAPTER",!0),index+=op.chars):op.isInsert()?(rtcm.insertText(index,op.text,op.attributes,"RTCMADAPTER"),index+=op.text.length):op.isDelete()&&rtcm.removeText(index,index+op.chars,"RTCMADAPTER")}operation.ops.length>10&&(rtcm.codeMirror.getWrapperElement().setAttribute("style",""),rtcm.codeMirror.refresh())},RichTextCodeMirrorAdapter.prototype.registerCallbacks=function(cb){this.callbacks=cb},RichTextCodeMirrorAdapter.prototype.onChange=function(_,changes){if("RTCMADAPTER"!==changes[0].origin){var pair=RichTextCodeMirrorAdapter.operationFromCodeMirrorChanges(changes,this.cm);this.trigger("change",pair[0],pair[1])}},RichTextCodeMirrorAdapter.prototype.onAttributesChange=function(_,changes){if("RTCMADAPTER"!==changes[0].origin){var pair=RichTextCodeMirrorAdapter.operationFromAttributesChanges(changes,this.cm);this.trigger("change",pair[0],pair[1])}},RichTextCodeMirrorAdapter.prototype.onCursorActivity=function(){this.trigger("cursorActivity")},RichTextCodeMirrorAdapter.prototype.onFocus=function(){this.trigger("focus")},RichTextCodeMirrorAdapter.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")},RichTextCodeMirrorAdapter.prototype.getValue=function(){return this.cm.getValue()},RichTextCodeMirrorAdapter.prototype.getCursor=function(){var selectionEnd,cm=this.cm,cursorPos=cm.getCursor(),position=cm.indexFromPos(cursorPos);if(cm.somethingSelected()){var startPos=cm.getCursor(!0),selectionEndPos=posEq(cursorPos,startPos)?cm.getCursor(!1):startPos;selectionEnd=cm.indexFromPos(selectionEndPos)}else selectionEnd=position;return new Cursor(position,selectionEnd)},RichTextCodeMirrorAdapter.prototype.setCursor=function(cursor){this.cm.setSelection(this.cm.posFromIndex(cursor.position),this.cm.posFromIndex(cursor.selectionEnd))},RichTextCodeMirrorAdapter.prototype.addStyleRule=function(css){if("undefined"!=typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var styleElement=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(styleElement),this.addedStyleSheet=styleElement.sheet}if(!this.addedStyleRules[css])return this.addedStyleRules[css]=!0,this.addedStyleSheet.insertRule(css,0)}},RichTextCodeMirrorAdapter.prototype.setOtherCursor=function(cursor,color,clientId){var cursorPos=this.cm.posFromIndex(cursor.position);if("string"==typeof color&&color.match(/^#[a-fA-F0-9]{3,6}$/)){var end=this.rtcm.end();if("object"==typeof cursor&&"number"==typeof cursor.position&&"number"==typeof cursor.selectionEnd&&!(cursor.position<0||cursor.position>end||cursor.selectionEnd<0||cursor.selectionEnd>end)){if(cursor.position===cursor.selectionEnd){var cursorCoords=this.cm.cursorCoords(cursorPos),cursorEl=document.createElement("span");return cursorEl.className="other-client",cursorEl.style.borderLeftWidth="2px",cursorEl.style.borderLeftStyle="solid",cursorEl.style.borderLeftColor=color,cursorEl.style.marginLeft=cursorEl.style.marginRight="-1px",cursorEl.style.height=.9*(cursorCoords.bottom-cursorCoords.top)+"px",cursorEl.setAttribute("data-clientid",clientId),cursorEl.style.zIndex=0,this.cm.setBookmark(cursorPos,{widget:cursorEl,insertLeft:!0})}var selectionClassName="selection-"+color.replace("#",""),rule="."+selectionClassName+" { background: "+color+"; }";this.addStyleRule(rule);var fromPos,toPos;return cursor.selectionEnd>cursor.position?(fromPos=cursorPos,toPos=this.cm.posFromIndex(cursor.selectionEnd)):(fromPos=this.cm.posFromIndex(cursor.selectionEnd),toPos=cursorPos),this.cm.markText(fromPos,toPos,{className:selectionClassName})}}},RichTextCodeMirrorAdapter.prototype.trigger=function(event){var args=Array.prototype.slice.call(arguments,1),action=this.callbacks&&this.callbacks[event];action&&action.apply(this,args)},RichTextCodeMirrorAdapter.prototype.applyOperation=function(operation){RichTextCodeMirrorAdapter.applyOperationToCodeMirror(operation,this.rtcm)},RichTextCodeMirrorAdapter.prototype.registerUndo=function(undoFn){this.cm.undo=undoFn},RichTextCodeMirrorAdapter.prototype.registerRedo=function(redoFn){this.cm.redo=redoFn},RichTextCodeMirrorAdapter.prototype.invertOperation=function(operation){for(var spans,i,pos=0,cm=this.rtcm.codeMirror,inverse=new TextOperation,opIndex=0;opIndex<operation.wrapped.ops.length;opIndex++){var op=operation.wrapped.ops[opIndex];if(op.isRetain())if(emptyAttributes(op.attributes))inverse.retain(op.chars),pos+=op.chars;else for(spans=this.rtcm.getAttributeSpans(pos,pos+op.chars),i=0;i<spans.length;i++){var inverseAttributes={};for(var attr in op.attributes){var opValue=op.attributes[attr],curValue=spans[i].attributes[attr];opValue===!1?curValue&&(inverseAttributes[attr]=curValue):opValue!==curValue&&(inverseAttributes[attr]=curValue||!1)}inverse.retain(spans[i].length,inverseAttributes),pos+=spans[i].length}else if(op.isInsert())inverse["delete"](op.text.length);else if(op.isDelete()){var text=cm.getRange(cm.posFromIndex(pos),cm.posFromIndex(pos+op.chars));spans=this.rtcm.getAttributeSpans(pos,pos+op.chars);var delTextPos=0;for(i=0;i<spans.length;i++)inverse.insert(text.substr(delTextPos,spans[i].length),spans[i].attributes),delTextPos+=spans[i].length;pos+=op.chars}}return new WrappedOperation(inverse,operation.meta.invert())},RichTextCodeMirrorAdapter}();var firepad=firepad||{};firepad.Formatting=function(){function Formatting(attributes){return this instanceof Formatting?(this.attributes=attributes||{},void 0):new Formatting(attributes)}var ATTR=firepad.AttributeConstants;return Formatting.prototype.cloneWithNewAttribute_=function(attribute,value){var attributes={};for(var attr in this.attributes)attributes[attr]=this.attributes[attr];return value===!1?delete attributes[attribute]:attributes[attribute]=value,new Formatting(attributes)},Formatting.prototype.bold=function(val){return this.cloneWithNewAttribute_(ATTR.BOLD,val)},Formatting.prototype.italic=function(val){return this.cloneWithNewAttribute_(ATTR.ITALIC,val)},Formatting.prototype.underline=function(val){return this.cloneWithNewAttribute_(ATTR.UNDERLINE,val)},Formatting.prototype.strike=function(val){return this.cloneWithNewAttribute_(ATTR.STRIKE,val)},Formatting.prototype.font=function(font){return this.cloneWithNewAttribute_(ATTR.FONT,font)},Formatting.prototype.fontSize=function(size){return this.cloneWithNewAttribute_(ATTR.FONT_SIZE,size)},Formatting.prototype.color=function(color){return this.cloneWithNewAttribute_(ATTR.COLOR,color)},Formatting.prototype.backgroundColor=function(color){return this.cloneWithNewAttribute_(ATTR.BACKGROUND_COLOR,color)},Formatting}();var firepad=firepad||{};firepad.Text=function(){function Text(text,formatting){return this instanceof Text?(this.text=text,this.formatting=formatting||firepad.Formatting(),void 0):new Text(text,formatting)}return Text}();var firepad=firepad||{};firepad.LineFormatting=function(){function LineFormatting(attributes){return this instanceof LineFormatting?(this.attributes=attributes||{},this.attributes[ATTR.LINE_SENTINEL]=!0,void 0):new LineFormatting(attributes)}var ATTR=firepad.AttributeConstants;return LineFormatting.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"},LineFormatting.prototype.cloneWithNewAttribute_=function(attribute,value){var attributes={};for(var attr in this.attributes)attributes[attr]=this.attributes[attr];return value===!1?delete attributes[attribute]:attributes[attribute]=value,new LineFormatting(attributes)},LineFormatting.prototype.indent=function(indent){return this.cloneWithNewAttribute_(ATTR.LINE_INDENT,indent)},LineFormatting.prototype.align=function(align){return this.cloneWithNewAttribute_(ATTR.LINE_ALIGN,align)},LineFormatting.prototype.listItem=function(val){return firepad.utils.assert(val===!1||"u"===val||"o"===val||"t"===val||"tc"===val),this.cloneWithNewAttribute_(ATTR.LIST_TYPE,val)},LineFormatting.prototype.getIndent=function(){return this.attributes[ATTR.LINE_INDENT]||0},LineFormatting.prototype.getAlign=function(){return this.attributes[ATTR.LINE_ALIGN]||0},LineFormatting.prototype.getListItem=function(){return this.attributes[ATTR.LIST_TYPE]||!1},LineFormatting}();var firepad=firepad||{};firepad.Line=function(){function Line(textPieces,formatting){return this instanceof Line?("[object Array]"!==Object.prototype.toString.call(textPieces)&&(textPieces="undefined"==typeof textPieces?[]:[textPieces]),this.textPieces=textPieces,this.formatting=formatting||firepad.LineFormatting(),void 0):new Line(textPieces,formatting)}return Line}();var firepad=firepad||{};firepad.ParseHtml=function(){function ParseState(opt_listType,opt_lineFormatting,opt_textFormatting){this.listType=opt_listType||LIST_TYPE.UNORDERED,this.lineFormatting=opt_lineFormatting||firepad.LineFormatting(),this.textFormatting=opt_textFormatting||firepad.Formatting()}function ParseOutput(){this.lines=[],this.currentLine=[],this.currentLineListItemType=null}function parseHtml(html,entityManager){var div=(firepad.document||document).createElement("div");div.innerHTML=html,entityManager_=entityManager;var output=new ParseOutput,state=new ParseState;return parseNode(div,state,output),output.lines}function parseNode(node,state,output){if(node.nodeType===Node.ELEMENT_NODE){var entity=entityManager_.fromElement(node);if(entity)return output.currentLine.push(new firepad.Text(firepad.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new firepad.Formatting(entity.toAttributes()))),void 0}switch(node.nodeType){case Node.TEXT_NODE:var text=node.nodeValue.replace(/[ \n\t]+/g," ");output.currentLine.push(firepad.Text(text,state.textFormatting));break;case Node.ELEMENT_NODE:var style=node.getAttribute("style")||"";switch(state=parseStyle(state,style),node.nodeName.toLowerCase()){case"div":case"h1":case"h2":case"h3":case"p":output.newlineIfNonEmpty(state),parseChildren(node,state,output),output.newlineIfNonEmpty(state);break;case"center":state=state.withAlign("center"),output.newlineIfNonEmpty(state),parseChildren(node,state.withAlign("center"),output),output.newlineIfNonEmpty(state);break;case"b":case"strong":parseChildren(node,state.withTextFormatting(state.textFormatting.bold(!0)),output);break;case"u":parseChildren(node,state.withTextFormatting(state.textFormatting.underline(!0)),output);break;case"i":case"em":parseChildren(node,state.withTextFormatting(state.textFormatting.italic(!0)),output);break;case"s":parseChildren(node,state.withTextFormatting(state.textFormatting.strike(!0)),output);break;case"font":var face=node.getAttribute("face"),color=node.getAttribute("color"),size=parseInt(node.getAttribute("size"));
face&&(state=state.withTextFormatting(state.textFormatting.font(face))),color&&(state=state.withTextFormatting(state.textFormatting.color(color))),size&&(state=state.withTextFormatting(state.textFormatting.fontSize(size))),parseChildren(node,state,output);break;case"br":output.newline(state);break;case"ul":output.newlineIfNonEmptyOrListItem(state);var listType="firepad-todo"===node.getAttribute("class")?LIST_TYPE.TODO:LIST_TYPE.UNORDERED;parseChildren(node,state.withListType(listType).withIncreasedIndent(),output),output.newlineIfNonEmpty(state);break;case"ol":output.newlineIfNonEmptyOrListItem(state),parseChildren(node,state.withListType(LIST_TYPE.ORDERED).withIncreasedIndent(),output),output.newlineIfNonEmpty(state);break;case"li":parseListItem(node,state,output);break;case"style":break;default:parseChildren(node,state,output)}}}function parseChildren(node,state,output){if(node.hasChildNodes())for(var i=0;i<node.childNodes.length;i++)parseNode(node.childNodes[i],state,output)}function parseListItem(node,state,output){output.newlineIfNonEmptyOrListItem(state);var listType="firepad-checked"===node.getAttribute("class")?LIST_TYPE.TODOCHECKED:state.listType;output.makeListItem(listType);var oldLine=output.currentLine;parseChildren(node,state,output),(oldLine===output.currentLine||output.currentLine.length>0)&&output.newline(state)}function parseStyle(state,styleString){for(var textFormatting=state.textFormatting,lineFormatting=state.lineFormatting,styles=styleString.split(";"),i=0;i<styles.length;i++){var stylePieces=styles[i].split(":");if(2===stylePieces.length){var prop=firepad.utils.trim(stylePieces[0]).toLowerCase(),val=firepad.utils.trim(stylePieces[1]).toLowerCase();switch(prop){case"text-decoration":var underline=val.indexOf("underline")>=0,strike=val.indexOf("line-through")>=0;textFormatting=textFormatting.underline(underline).strike(strike);break;case"font-weight":var bold="bold"===val||parseInt(val)>=600;textFormatting=textFormatting.bold(bold);break;case"font-style":var italic="italic"===val||"oblique"===val;textFormatting=textFormatting.italic(italic);break;case"color":textFormatting=textFormatting.color(val);break;case"background-color":textFormatting=textFormatting.backgroundColor(val);break;case"text-align":lineFormatting=lineFormatting.align(val);break;case"font-size":var size=null,allowedValues=["px","pt","%","em","xx-small","x-small","small","medium","large","x-large","xx-large","smaller","larger"];firepad.utils.stringEndsWith(val,allowedValues)?size=val:parseInt(val)&&(size=parseInt(val)+"px"),size&&(textFormatting=textFormatting.fontSize(size));break;case"font-family":var font=firepad.utils.trim(val.split(",")[0]);font=font.replace(/['"]/g,""),font=font.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}),textFormatting=textFormatting.font(font)}}}return state.withLineFormatting(lineFormatting).withTextFormatting(textFormatting)}var LIST_TYPE=firepad.LineFormatting.LIST_TYPE;ParseState.prototype.withTextFormatting=function(textFormatting){return new ParseState(this.listType,this.lineFormatting,textFormatting)},ParseState.prototype.withLineFormatting=function(lineFormatting){return new ParseState(this.listType,lineFormatting,this.textFormatting)},ParseState.prototype.withListType=function(listType){return new ParseState(listType,this.lineFormatting,this.textFormatting)},ParseState.prototype.withIncreasedIndent=function(){var lineFormatting=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new ParseState(this.listType,lineFormatting,this.textFormatting)},ParseState.prototype.withAlign=function(align){var lineFormatting=this.lineFormatting.align(align);return new ParseState(this.listType,lineFormatting,this.textFormatting)},ParseOutput.prototype.newlineIfNonEmpty=function(state){this.cleanLine_(),this.currentLine.length>0&&this.newline(state)},ParseOutput.prototype.newlineIfNonEmptyOrListItem=function(state){this.cleanLine_(),(this.currentLine.length>0||null!==this.currentLineListItemType)&&this.newline(state)},ParseOutput.prototype.newline=function(state){this.cleanLine_();var lineFormatting=state.lineFormatting;null!==this.currentLineListItemType&&(lineFormatting=lineFormatting.listItem(this.currentLineListItemType),this.currentLineListItemType=null),this.lines.push(firepad.Line(this.currentLine,lineFormatting)),this.currentLine=[]},ParseOutput.prototype.makeListItem=function(type){this.currentLineListItemType=type},ParseOutput.prototype.cleanLine_=function(){if(this.currentLine.length>0){var last=this.currentLine.length-1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,""),this.currentLine[last].text=this.currentLine[last].text.replace(/ +$/g,"");for(var i=0;i<this.currentLine.length;i++)this.currentLine[i].text=this.currentLine[i].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var entityManager_,Node=Node||{ELEMENT_NODE:1,TEXT_NODE:3};return parseHtml}();var firepad=firepad||{};firepad.SerializeHtml=function(){function open(listType){return listType===LIST_TYPE.ORDERED?"<ol>":listType===LIST_TYPE.UNORDERED?"<ul>":'<ul class="firepad-todo">'}function close(listType){return listType===LIST_TYPE.ORDERED?"</ol>":"</ul>"}function compatibleListType(l1,l2){return l1===l2||l1===LIST_TYPE.TODO&&l2===LIST_TYPE.TODOCHECKED||l1===LIST_TYPE.TODOCHECKED&&l2===LIST_TYPE.TODO}function textToHtml(text){return text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")}function serializeHtml(doc,entityManager){for(var html="",newLine=!0,listTypeStack=[],inListItem=!1,firstLine=!0,emptyLine=!0,i=0,op=doc.ops[i],usesTodo=!1;op;){utils.assert(op.isInsert());var attrs=op.attributes;if(newLine){newLine=!1;var indent=0,listType=null,lineAlign="left";ATTR.LINE_SENTINEL in attrs&&(indent=attrs[ATTR.LINE_INDENT]||0,listType=attrs[ATTR.LIST_TYPE]||null,lineAlign=attrs[ATTR.LINE_ALIGN]||"left"),listType&&(indent=indent||1),inListItem?(html+="</li>",inListItem=!1):firstLine||(emptyLine&&(html+="<br/>"),html+="</div>"),firstLine=!1,utils.assert(indent>=0,"Indent must not be negative.");for(;listTypeStack.length>indent||indent===listTypeStack.length&&null!==listType&&!compatibleListType(listType,listTypeStack[listTypeStack.length-1]);)html+=close(listTypeStack.pop());for(;listTypeStack.length<indent;){var toOpen=listType||LIST_TYPE.UNORDERED;usesTodo=listType==LIST_TYPE.TODO||listType==LIST_TYPE.TODOCHECKED||usesTodo,html+=open(toOpen),listTypeStack.push(toOpen)}var style="left"!==lineAlign?' style="text-align:'+lineAlign+'"':"";if(listType){var clazz="";switch(listType){case LIST_TYPE.TODOCHECKED:clazz=' class="firepad-checked"';break;case LIST_TYPE.TODO:clazz=' class="firepad-unchecked"'}html+="<li"+clazz+style+">",inListItem=!0}else html+="<div"+style+">";emptyLine=!0}if(ATTR.LINE_SENTINEL in attrs)op=doc.ops[++i];else if(ATTR.ENTITY_SENTINEL in attrs){for(var j=0;j<op.text.length;j++){var entity=firepad.Entity.fromAttributes(attrs),element=entityManager.exportToElement(entity);html+=element.outerHTML}op=doc.ops[++i]}else{var prefix="",suffix="";for(var attr in attrs){var start,end,value=attrs[attr];attr===ATTR.BOLD||attr===ATTR.ITALIC||attr===ATTR.UNDERLINE||attr===ATTR.STRIKE?(utils.assert(value===!0),start=end=attr):attr===ATTR.FONT_SIZE?(start='span style="font-size: '+value,start+="string"!=typeof value||-1===value.indexOf("px",value.length-2)?'px"':'"',end="span"):attr===ATTR.FONT?(start='span style="font-family: '+value+'"',end="span"):attr===ATTR.COLOR?(start='span style="color: '+value+'"',end="span"):attr===ATTR.BACKGROUND_COLOR?(start='span style="background-color: '+value+'"',end="span"):utils.log(!1,"Encountered unknown attribute while rendering html: "+attr),start&&(prefix+="<"+start+">"),end&&(suffix="</"+end+">"+suffix)}var text=op.text,newLineIndex=text.indexOf("\n");newLineIndex>=0?(newLine=!0,op=newLineIndex<text.length-1?new firepad.TextOp("insert",text.substr(newLineIndex+1),attrs):doc.ops[++i],text=text.substr(0,newLineIndex)):op=doc.ops[++i],text=text.replace(/  +/g,function(str){return new Array(str.length+1).join("\xa0")}).replace(/^ /,"\xa0").replace(/ $/,"\xa0"),text.length>0&&(emptyLine=!1),html+=prefix+textToHtml(text)+suffix}}for(inListItem?html+="</li>":firstLine||(emptyLine&&(html+="&nbsp;"),html+="</div>");listTypeStack.length>0;)html+=close(listTypeStack.pop());return usesTodo&&(html=TODO_STYLE+html),html}var utils=firepad.utils,ATTR=firepad.AttributeConstants,LIST_TYPE=firepad.LineFormatting.LIST_TYPE,TODO_STYLE='<style>ul.firepad-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.firepad-todo > li { padding-left: 1em; text-indent: -1em; } ul.firepad-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.firepad-todo > li.firepad-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n';return serializeHtml}();var firepad=firepad||{};firepad.textPiecesToInserts=function(atNewLine,textPieces){function insert(string,attributes){string instanceof firepad.Text&&(attributes=string.formatting.attributes,string=string.text),inserts.push({string:string,attributes:attributes}),atNewLine="\n"===string[string.length-1]}function insertLine(line){atNewLine&&insert(firepad.sentinelConstants.LINE_SENTINEL_CHARACTER,line.formatting.attributes);for(var i=0;i<line.textPieces.length;i++)insert(line.textPieces[i]);insert("\n")}for(var inserts=[],i=0;i<textPieces.length;i++)textPieces[i]instanceof firepad.Line?insertLine(textPieces[i]):insert(textPieces[i]);return inserts};var firepad=firepad||{};firepad.Headless=function(){function Headless(refOrPath){if(!(this instanceof Headless))return new Headless(refOrPath);if("string"==typeof refOrPath){if("function"!=typeof Firebase)var firebase=require("firebase");else var firebase=Firebase;var ref=new firebase(refOrPath)}else var ref=refOrPath;this.adapter=new FirebaseAdapter(ref),this.ready=!1,this.entityManager=new EntityManager}var TextOperation=firepad.TextOperation,FirebaseAdapter=firepad.FirebaseAdapter,EntityManager=firepad.EntityManager,ParseHtml=firepad.ParseHtml;return Headless.prototype.getDocument=function(callback){var self=this;return self.ready?callback(self.adapter.getDocument()):(self.adapter.on("ready",function(){self.ready=!0,callback(self.adapter.getDocument())}),void 0)},Headless.prototype.getText=function(callback){this.getDocument(function(doc){var text=doc.apply("");for(key in firepad.sentinelConstants)text=text.replace(new RegExp(firepad.sentinelConstants[key],"g"),"");callback(text)})},Headless.prototype.setText=function(text,callback){var op=TextOperation().insert(text);this.sendOperationWithRetry(op,callback)},Headless.prototype.initializeFakeDom=function(callback){"object"==typeof document||"object"==typeof firepad.document?callback():require("jsdom").env("<head></head><body></body>",function(err,window){return firepad.document?(window.close(),callback()):(firepad.document=window.document,callback(),void 0)})},Headless.prototype.getHtml=function(callback){var self=this;self.initializeFakeDom(function(){self.getDocument(function(doc){callback(firepad.SerializeHtml(doc,self.entityManager))})})},Headless.prototype.setHtml=function(html,callback){var self=this;self.initializeFakeDom(function(){for(var textPieces=ParseHtml(html,self.entityManager),inserts=firepad.textPiecesToInserts(!0,textPieces),op=new TextOperation,i=0;i<inserts.length;i++)op.insert(inserts[i].string,inserts[i].attributes);self.sendOperationWithRetry(op,callback)})},Headless.prototype.sendOperationWithRetry=function(operation,callback){var self=this;self.getDocument(function(doc){var op=operation.clone()["delete"](doc.targetLength);self.adapter.sendOperation(op,function(err,committed){committed?"undefined"!=typeof callback&&callback(null,committed):self.sendOperationWithRetry(operation,callback)})})},Headless}();var firepad=firepad||{};return firepad.Firepad=function(global){function Firepad(ref,place,options){if(!(this instanceof Firepad))return new Firepad(ref,place,options);if(!CodeMirror&&!ace)throw new Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");if(CodeMirror&&place instanceof CodeMirror){this.codeMirror_=this.editor_=place;var curValue=this.codeMirror_.getValue();if(""!==curValue)throw new Error("Can't initialize Firepad with a CodeMirror instance that already contains text.")}else if(ace&&place&&place.session instanceof ace.EditSession){if(this.ace_=this.editor_=place,curValue=this.ace_.getValue(),""!==curValue)throw new Error("Can't initialize Firepad with an ACE instance that already contains text.")}else this.codeMirror_=this.editor_=new CodeMirror(place);var editorWrapper=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.firepadWrapper_=utils.elt("div",null,{"class":"firepad"}),editorWrapper.parentNode.replaceChild(this.firepadWrapper_,editorWrapper),this.firepadWrapper_.appendChild(editorWrapper),utils.on(editorWrapper,"dragstart",utils.stopEvent),this.editor_.firepad=this,this.options_=options||{},this.getOption("richTextShortcuts",!1)&&(CodeMirror.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.firepadWrapper_.className+=" firepad-richtext"),this.imageInsertionUI=this.getOption("imageInsertionUI",!0),this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.firepadWrapper_.className+=" firepad-richtext firepad-with-toolbar"),this.addPoweredByLogo_(),this.codeMirror_&&this.codeMirror_.refresh();var userId=this.getOption("userId",ref.push().key()),userColor=this.getOption("userColor",colorFromUserId(userId));this.entityManager_=new EntityManager,this.firebaseAdapter_=new FirebaseAdapter(ref,userId,userColor),this.codeMirror_?(this.richTextCodeMirror_=new RichTextCodeMirror(this.codeMirror_,this.entityManager_,{cssPrefix:"firepad-"}),this.editorAdapter_=new RichTextCodeMirrorAdapter(this.richTextCodeMirror_)):this.editorAdapter_=new ACEAdapter(this.ace_),this.client_=new EditorClient(this.firebaseAdapter_,this.editorAdapter_);var self=this;this.firebaseAdapter_.on("cursor",function(){self.trigger.apply(self,["cursor"].concat([].slice.call(arguments)))}),this.codeMirror_&&this.richTextCodeMirror_.on("newLine",function(){self.trigger.apply(self,["newLine"].concat([].slice.call(arguments)))}),this.firebaseAdapter_.on("ready",function(){self.ready_=!0,this.ace_&&this.editorAdapter_.grabDocumentState();var defaultText=self.getOption("defaultText",null);defaultText&&self.isHistoryEmpty()&&self.setText(defaultText),self.trigger("ready")}),this.client_.on("synced",function(isSynced){self.trigger("synced",isSynced)}),"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var head=document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css",style.styleSheet.cssText=":before,:after{content:none !important;}",head.appendChild(style),setTimeout(function(){head.removeChild(style)},0)})}function colorFromUserId(userId){for(var a=1,i=0;i<userId.length;i++)a=17*(a+userId.charCodeAt(i))%360;var hue=a/360;return hsl2hex(hue,1,.85)}function rgb2hex(r,g,b){function digits(n){var m=Math.round(255*n).toString(16);return 1===m.length?"0"+m:m}return"#"+digits(r)+digits(g)+digits(b)}function hsl2hex(h,s,l){if(0===s)return rgb2hex(l,l,l);var var2=.5>l?l*(1+s):l+s-s*l,var1=2*l-var2,hue2rgb=function(hue){return 0>hue&&(hue+=1),hue>1&&(hue-=1),1>6*hue?var1+6*(var2-var1)*hue:1>2*hue?var2:2>3*hue?var1+6*(var2-var1)*(2/3-hue):var1};return rgb2hex(hue2rgb(h+1/3),hue2rgb(h),hue2rgb(h-1/3))}if(!firepad.RichTextCodeMirrorAdapter)throw new Error("Oops! It looks like you're trying to include lib/firepad.js directly.  This is actually one of many source files that make up firepad.  You want dist/firepad.js instead.");var RichTextCodeMirrorAdapter=firepad.RichTextCodeMirrorAdapter,RichTextCodeMirror=firepad.RichTextCodeMirror,RichTextToolbar=firepad.RichTextToolbar,ACEAdapter=firepad.ACEAdapter,FirebaseAdapter=firepad.FirebaseAdapter,EditorClient=firepad.EditorClient,EntityManager=firepad.EntityManager,ATTR=firepad.AttributeConstants,utils=firepad.utils,CodeMirror=(firepad.LineFormatting.LIST_TYPE,global.CodeMirror),ace=global.ace;return utils.makeEventEmitter(Firepad),Firepad.fromCodeMirror=Firepad,Firepad.fromACE=Firepad,Firepad.prototype.dispose=function(){this.zombie_=!0;var editorWrapper=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.firepadWrapper_.removeChild(editorWrapper),this.firepadWrapper_.parentNode.replaceChild(editorWrapper,this.firepadWrapper_),this.editor_.firepad=null,this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default"),this.firebaseAdapter_.dispose(),this.editorAdapter_.detach(),this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()},Firepad.prototype.setUserId=function(userId){this.firebaseAdapter_.setUserId(userId)},Firepad.prototype.setUserColor=function(color){this.firebaseAdapter_.setColor(color)},Firepad.prototype.getText=function(){return this.assertReady_("getText"),this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()},Firepad.prototype.setText=function(textPieces){return this.ace_?this.ace_.getSession().getDocument().setValue(textPieces):(this.codeMirror_.getWrapperElement().setAttribute("style","display: none"),this.codeMirror_.setValue(""),this.insertText(0,textPieces),this.codeMirror_.getWrapperElement().setAttribute("style",""),this.codeMirror_.refresh(),this.editorAdapter_.setCursor({position:0,selectionEnd:0}),void 0)},Firepad.prototype.insertTextAtCursor=function(textPieces){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),textPieces)},Firepad.prototype.insertText=function(index,textPieces){utils.assert(!this.ace_,"Not supported for ace yet."),this.assertReady_("insertText"),"[object Array]"!==Object.prototype.toString.call(textPieces)&&(textPieces=[textPieces]);for(var atNewLine=0===index,inserts=firepad.textPiecesToInserts(atNewLine,textPieces),i=0;i<inserts.length;i++){var string=inserts[i].string,attributes=inserts[i].attributes;this.richTextCodeMirror_.insertText(index,string,attributes),index+=string.length}},Firepad.prototype.getOperationForSpan=function(start,end){for(var text=this.richTextCodeMirror_.getRange(start,end),spans=this.richTextCodeMirror_.getAttributeSpans(start,end),pos=0,op=new firepad.TextOperation,i=0;i<spans.length;i++)op.insert(text.substr(pos,spans[i].length),spans[i].attributes),pos+=spans[i].length;return op},Firepad.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)},Firepad.prototype.getHtmlFromSelection=function(){var startPos=this.codeMirror_.getCursor("start"),endPos=this.codeMirror_.getCursor("end"),startIndex=this.codeMirror_.indexFromPos(startPos),endIndex=this.codeMirror_.indexFromPos(endPos);return this.getHtmlFromRange(startIndex,endIndex)},Firepad.prototype.getHtmlFromRange=function(start,end){var doc=null!=start&&null!=end?this.getOperationForSpan(start,end):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return firepad.SerializeHtml(doc,this.entityManager_)},Firepad.prototype.insertHtml=function(index,html){var lines=firepad.ParseHtml(html,this.entityManager_);this.insertText(index,lines)},Firepad.prototype.insertHtmlAtCursor=function(html){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),html)},Firepad.prototype.setHtml=function(html){var lines=firepad.ParseHtml(html,this.entityManager_);this.setText(lines)},Firepad.prototype.isHistoryEmpty=function(){return this.assertReady_("isHistoryEmpty"),this.firebaseAdapter_.isHistoryEmpty()},Firepad.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(ATTR.BOLD),this.codeMirror_.focus()},Firepad.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(ATTR.ITALIC),this.codeMirror_.focus()},Firepad.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(ATTR.UNDERLINE),this.codeMirror_.focus()},Firepad.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(ATTR.STRIKE),this.codeMirror_.focus()},Firepad.prototype.fontSize=function(size){this.richTextCodeMirror_.setAttribute(ATTR.FONT_SIZE,size),this.codeMirror_.focus()},Firepad.prototype.font=function(font){this.richTextCodeMirror_.setAttribute(ATTR.FONT,font),this.codeMirror_.focus()},Firepad.prototype.color=function(color){this.richTextCodeMirror_.setAttribute(ATTR.COLOR,color),this.codeMirror_.focus()},Firepad.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(ATTR.BACKGROUND_COLOR,"rgba(255,255,0,.65)"),this.codeMirror_.focus()},Firepad.prototype.align=function(alignment){if("left"!==alignment&&"center"!==alignment&&"right"!==alignment)throw new Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(ATTR.LINE_ALIGN,alignment),this.codeMirror_.focus()},Firepad.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(ATTR.LIST_TYPE,"o"),this.codeMirror_.focus()},Firepad.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(ATTR.LIST_TYPE,"u"),this.codeMirror_.focus()},Firepad.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo(),this.codeMirror_.focus()},Firepad.prototype.newline=function(){this.richTextCodeMirror_.newline()},Firepad.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()},Firepad.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()},Firepad.prototype.indent=function(){this.richTextCodeMirror_.indent(),this.codeMirror_.focus()},Firepad.prototype.unindent=function(){this.richTextCodeMirror_.unindent(),this.codeMirror_.focus()},Firepad.prototype.undo=function(){this.codeMirror_.undo()},Firepad.prototype.redo=function(){this.codeMirror_.redo()},Firepad.prototype.insertEntity=function(type,info,origin){this.richTextCodeMirror_.insertEntityAtCursor(type,info,origin)},Firepad.prototype.insertEntityAt=function(index,type,info,origin){this.richTextCodeMirror_.insertEntityAt(index,type,info,origin)},Firepad.prototype.registerEntity=function(type,options){this.entityManager_.register(type,options)},Firepad.prototype.getOption=function(option,def){return option in this.options_?this.options_[option]:def},Firepad.prototype.assertReady_=function(funcName){if(!this.ready_)throw new Error('You must wait for the "ready" event before calling '+funcName+".");if(this.zombie_)throw new Error("You can't use a Firepad after calling dispose()!")},Firepad.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")},Firepad.prototype.makeDialog_=function(id,placeholder){var self=this,hideDialog=function(){var dialog=document.getElementById("overlay");dialog.style.visibility="hidden",self.firepadWrapper_.removeChild(dialog)},cb=function(){var dialog=document.getElementById("overlay");dialog.style.visibility="hidden";var src=document.getElementById(id).value;null!==src&&self.insertEntity(id,{src:src}),self.firepadWrapper_.removeChild(dialog)},input=utils.elt("input",null,{"class":"firepad-dialog-input",id:id,type:"text",placeholder:placeholder,autofocus:"autofocus"}),submit=utils.elt("a","Submit",{"class":"firepad-btn",id:"submitbtn"});utils.on(submit,"click",utils.stopEventAnd(cb));var cancel=utils.elt("a","Cancel",{"class":"firepad-btn"});utils.on(cancel,"click",utils.stopEventAnd(hideDialog));var buttonsdiv=utils.elt("div",[submit,cancel],{"class":"firepad-btn-group"}),div=utils.elt("div",[input,buttonsdiv],{"class":"firepad-dialog-div"}),dialog=utils.elt("div",[div],{"class":"firepad-dialog",id:"overlay"});this.firepadWrapper_.appendChild(dialog)},Firepad.prototype.addToolbar_=function(){this.toolbar=new RichTextToolbar(this.imageInsertionUI),this.toolbar.on("undo",this.undo,this),this.toolbar.on("redo",this.redo,this),this.toolbar.on("bold",this.bold,this),this.toolbar.on("italic",this.italic,this),this.toolbar.on("underline",this.underline,this),this.toolbar.on("strike",this.strike,this),this.toolbar.on("font-size",this.fontSize,this),this.toolbar.on("font",this.font,this),this.toolbar.on("color",this.color,this),this.toolbar.on("left",function(){this.align("left")},this),this.toolbar.on("center",function(){this.align("center")},this),this.toolbar.on("right",function(){this.align("right")},this),this.toolbar.on("ordered-list",this.orderedList,this),this.toolbar.on("unordered-list",this.unorderedList,this),this.toolbar.on("todo-list",this.todo,this),this.toolbar.on("indent-increase",this.indent,this),this.toolbar.on("indent-decrease",this.unindent,this),this.toolbar.on("insert-image",this.makeImageDialog_,this),this.firepadWrapper_.insertBefore(this.toolbar.element(),this.firepadWrapper_.firstChild)},Firepad.prototype.addPoweredByLogo_=function(){var poweredBy=utils.elt("a",null,{"class":"powered-by-firepad"});poweredBy.setAttribute("href","http://www.firepad.io/"),poweredBy.setAttribute("target","_blank"),this.firepadWrapper_.appendChild(poweredBy)},Firepad.prototype.initializeKeyMap_=function(){function binder(fn){return function(cm){setTimeout(function(){fn.call(cm.firepad)},0)}}CodeMirror.keyMap.richtext={"Ctrl-B":binder(this.bold),"Cmd-B":binder(this.bold),"Ctrl-I":binder(this.italic),"Cmd-I":binder(this.italic),"Ctrl-U":binder(this.underline),"Cmd-U":binder(this.underline),"Ctrl-H":binder(this.highlight),"Cmd-H":binder(this.highlight),Enter:binder(this.newline),Delete:binder(this.deleteRight),Backspace:binder(this.deleteLeft),Tab:binder(this.indent),"Shift-Tab":binder(this.unindent),fallthrough:["default"]}},Firepad}(this),firepad.Firepad.Formatting=firepad.Formatting,firepad.Firepad.Text=firepad.Text,firepad.Firepad.Entity=firepad.Entity,firepad.Firepad.LineFormatting=firepad.LineFormatting,firepad.Firepad.Line=firepad.Line,firepad.Firepad.TextOperation=firepad.TextOperation,firepad.Firepad.Headless=firepad.Headless,firepad.Firepad.RichTextCodeMirrorAdapter=firepad.RichTextCodeMirrorAdapter,firepad.Firepad.ACEAdapter=firepad.ACEAdapter,firepad.Firepad},this);var requirejs=_requirejs;_requirejs=void 0;var require=_require;_require=void 0;var define=_define;_define=void 0,function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeView,HR,ref;return ChallengeView=function(superClass){function ChallengeView(){return ChallengeView.__super__.constructor.apply(this,arguments)}return extend(ChallengeView,superClass),ChallengeView.prototype.template="challenge",ChallengeView.prototype.className="challenge-view",ChallengeView.prototype.events={"click a.hr-problem-link":"clickProblem","click a.hr-submissions-link":"clickSubmissions","click a.hr-leaderboard-link":"clickLeaderboard","click a.hr-forum-link":"clickForum","click a.hr-editorial-link":"clickEditorial","click a.hr-custom-link":"clickCustomLink","click a.hr-topics-link":"clickTopics","click a.hr-expert-solution-link":"clickExpertSolution","change #showPractice":"toggleLeaderboard","click .pagination a":"changePagination"},ChallengeView.prototype.initialize=function(options){return this.submission_id=options.submission_id,this.contest=options.contest,this.activeTab=options.activeTab,this.paramPage=options.paramPage,this.customView=options.customView,this.submissionId=options.submissionId,this.submissionOptions=options.submissionOptions,this.includePractice=!0,this.leaderboardFilter=options.leaderboardFilter,this.companyName=options.companyName,this.companySlug=options.companySlug,this.iscompanyModerator=options.isCompanyModerator,this.profile=HR.profile(),this.profile.fetchScores(),this.topic_slug=options.topic_slug,HR.ABTest.activate("articles-reverse"),this.contest||(this.contest=new HR.model("contest"),this.contest.set("slug",this.model.get("contest_slug")),this.contest.cached()),this.listenTo(this.model,"reset",this.render),this.listenTo(this.contest,"reset",this.render),this.listenTo(this.profile,"reset",this.startTourCompanyChallenge)},ChallengeView.prototype.setTab=function(tab){var ref;return null!=(ref=this.time_to_solve)&&ref.change_page(this.activeTab),this.$("ul.nav-tabs li").removeClass("active"),this.$(tab).addClass("active")},ChallengeView.prototype.setProblem=function(){var contest_slug;return HR.appController.setTitle(this.title_leading+this.default_title_middle+this.title_ending),contest_slug=this.model.get("contest_slug"),this.activeTab="problem",this.setTab("#"+this.activeTab+"Tab"),this.challengeTemplateView||(this.challengeTemplateView=new HR.ChallengeTemplateView({model:this.model,contest:this.contest,submission_id:this.submission_id,parent:this,companySlug:this.companySlug,companyName:this.companyName,challengeModel:this.model}),this.add_subview(this.challengeTemplateView)),this.showView("problem",this.challengeTemplateView),null===contest_slug&&(contest_slug="master"),HR.appController.set_contest_namespace(contest_slug),window.mixpanel_data={landing:!1,contest:contest_slug,page_type:"challengepage",challenge:this.model.get("slug")}},ChallengeView.prototype.clickProblem=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=""+this.model.pageURL()?(HR.router.navigate(this.model.pageURL(),!1),this.setProblem()):void 0},ChallengeView.prototype.setBreadcrumb=function(){return this.contest&&this.contest.sync_status&&this.model.sync_status?(this.contest.get("company_associated_contest")?(HR.appView.setBreadcrumb("global",this.companyName,"/companies/"+this.companySlug),HR.appView.setBreadcrumb("challenge",this.model.get("name"),"/companies/"+this.companySlug+"/challenges/"+this.model.get("slug")),this.startTourCompanyChallenge()):("master"===this.contest.get("slug")?HR.appView.setBreadcrumb("global","All Domains","/domains"):(HR.appView.setBreadcrumb("global","All Contests","/contests"),HR.appView.setBreadcrumb("contest",this.contest.get("name"),"/contests/"+this.contest.get("slug")+"/challenges"),HR.appView.setBreadcrumb("challenge",this.model.get("name"),"/contests/"+this.contest.get("slug")+"/challenges/"+this.model.get("slug"))),this.model.get("track")&&(HR.appView.setBreadcrumb("contest-track",this.model.get("track").track_name,"/domains/"+this.model.get("track").track_slug),HR.appView.setBreadcrumb("contest-chapter",this.model.get("track").name,"/domains/"+this.model.get("track").track_slug+"/"+this.model.get("track").slug),HR.appView.setBreadcrumb("challenge",this.model.get("name"),"/challenges/"+this.model.get("slug")))),this.renderScore(this.contest,this.challenge)):void 0},ChallengeView.prototype.startTourCompanyChallenge=function(){var tourDone;if(this.profile.isLoggedIn()&&this.contest&&this.contest.sync_status&&this.model.sync_status&&this.contest.get("company_associated_contest"))return tourDone=this.profile.get("company_challenge_breadcrumb_tour_done"),tourDone||this.introjs?void 0:(this.introjs=introJs(),this.introjs.setOptions({showStepNumbers:!1,showBullets:!1,showButtons:!1}),setTimeout(function(_this){return function(){var that;return _this.introjs.start(),that=_this,$(".introjs-tooltipReferenceLayer").click(function(e){return e.stopPropagation(),that.introjs.exit()})}}(this),1e3),this.profile.set("company_challenge_breadcrumb_tour_done",!0),this.profile.save())},ChallengeView.prototype.setSubmissions=function(page){var challenge_slug,contest_slug;return null==page&&(page=1),HR.appController.setTitle(this.title_leading+" Submissions"+this.title_ending),this.activeTab="submissions",this.setTab("#"+this.activeTab+"Tab"),this.showLoading("submissions"),challenge_slug=this.model.get("slug"),contest_slug=this.model.get("contest_slug"),this.submissions||(this.submissions=HR.collection("submissions")),this.submissions.setPage(page),this.submissions.setContest(contest_slug),this.submissions.setChallenge(challenge_slug),this.submissions.cached(),HR.requires(["compound/submission-views"],function(_this){return function(){return _this.submissionsView||(_this.submissionsView=new HR.SubmissionsView({collection:_this.submissions}),_this.add_subview(_this.submissionsView)),_this.showView("submissions",_this.submissionsView),null===contest_slug&&(contest_slug="master"),HR.appController.set_contest_namespace(contest_slug),window.mixpanel_data={landing:!1,contest:contest_slug,page_type:"submissions",challenge:challenge_slug}}}(this))},ChallengeView.prototype.clickSubmissions=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/submissions"?(HR.router.navigate(this.model.pageURL()+"/submissions",!1),this.setSubmissions()):void 0
},ChallengeView.prototype.setSubmission=function(submissionId){var challenge_slug,contest_slug,page;return HR.appController.setTitle(this.title_leading+(" Submissions "+submissionId)+this.title_ending),this.activeTab="submissions",this.setTab("#"+this.activeTab+"Tab"),this.showLoading("submissions"),challenge_slug=this.model.get("slug"),contest_slug=this.model.get("contest_slug"),this.contest||(this.contest=HR.model("contest")),this.contest.set("slug",this.model.get("contest_slug")),this.contest.cached(),this.submissionOptions.element&&"page"!==this.submissionOptions.element?void 0:(page="page"===this.submissionOptions.element?this.submissionOptions.element_id:1,null===this.submissionOptions._filter&&(this.submissionOptions._filter="all"),this.submission_model||(this.submission_model=HR.model("submission",{id:submissionId,filter:this.submissionOptions._filter,contest_slug:this.model.get("contest_slug")})),this.submission_model.cached(),HR.requires(["compound/submission-views"],function(_this){return function(){var gameset_collection;return _this.submissionView||(_this.submissionView=new HR.SubmissionView({contest:_this.contest,model:_this.submission_model,challenge:_this.model}),"game"===_this.submissionOptions.kind&&(gameset_collection=HR.collection("game-set"),gameset_collection.setPage(page),gameset_collection.setFilter(_this.submissionOptions._filter),gameset_collection.setSid(submissionId),gameset_collection.cached(),_this.submissionView.setGameSetCollection(gameset_collection)),_this.add_subview(_this.submissionView)),_this.showView("submissions",_this.submissionView)}}(this)),window.mixpanel_data.challenge=this.submission_model.slug)},ChallengeView.prototype.setForum=function(page){var challenge_slug,contest_slug;return null==page&&(page=1),HR.appController.setTitle(this.title_leading+" Forum"+this.title_ending),this.activeTab="forum",this.setTab("#"+this.activeTab+"Tab"),this.showLoading("forum"),challenge_slug=this.model.get("slug"),contest_slug=this.model.get("contest_slug"),this.contest.get("comment_live_sync")===!0?this.comment_collection||(this.comment_collection=new HR.CommentCollection,this.comment_collection.page=page,this.comment_collection.setChallengeSlug(challenge_slug),this.comment_collection.setContestSlug(contest_slug),this.comment_collection.setSortBy("created_at"),this.comment_collection.cached()):(this.comment_collection||(this.comment_collection=new HR.CommentCollection,this.comment_collection.page=page,this.comment_collection.setChallengeSlug(challenge_slug),this.comment_collection.setContestSlug(contest_slug)),this.comment_collection.fetch({reset:!0})),HR.requires(["compound/forum-views"],function(_this){return function(){return _this.commentsView||(_this.commentsView=new HR.ChallengeCommentsView({challenge:_this.model,collection:_this.comment_collection,profile:_this.profile,contest:_this.contest}),_this.add_subview(_this.commentsView)),_this.showView("forum",_this.commentsView),HR.appController.set_contest_namespace(contest_slug),window.mixpanel_data={landing:!1,contest:contest_slug,challenge:challenge_slug}}}(this))},ChallengeView.prototype.clickForum=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/forum"?(HR.router.navigate(this.model.pageURL()+"/forum",!1),this.setForum()):void 0},ChallengeView.prototype.setEditorial=function(){var challenge_slug,contest_slug,editorial,hacker,options;return HR.appController.setTitle(this.title_leading+" Editorial"+this.title_ending),this.activeTab="editorial",this.setTab("#"+this.activeTab+"Tab"),this.showLoading("editorial"),challenge_slug=this.model.get("slug"),contest_slug=this.model.get("contest_slug"),hacker=HR.profile(),options={challenge_slug:challenge_slug},editorial=HR.model("editorial",options).cached(),HR.requires(["compound/extra-views"],function(_this){return function(){return _this.editorialView||(_this.editorialView=new HR.EditorialView({challenge:_this.model,model:editorial,current_hacker:hacker}),_this.add_subview(_this.editorialView)),_this.showView("editorial",_this.editorialView),HR.appController.set_contest_namespace(contest_slug),window.mixpanel_data={landing:!1,contest:contest_slug,challenge:challenge_slug}}}(this))},ChallengeView.prototype.clickEditorial=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/editorial"?(HR.router.navigate(this.model.pageURL()+"/editorial",!1),this.setEditorial()):void 0},ChallengeView.prototype.setCustomPage=function(slug){var contest_slug,custom_tabs,our_tab;return custom_tabs=this.model.get("custom_tabs"),custom_tabs&&(our_tab=null,_.each(custom_tabs,function(tab){return tab.slug===slug?our_tab=tab:void 0}),our_tab&&(this.custom_view?this.custom_view.setTab(our_tab):(this.custom_view=new HR.ChallengeCustomView({tab:our_tab}),this.add_subview(this.custom_view)),this.activeTab=""+slug,this.setTab("#"+slug+"Tab"),this.showView(""+slug,this.custom_view,{tab:"#"+slug+"Tab"}))),null===contest_slug&&(contest_slug="master"),HR.appController.set_contest_namespace(this.model.get("contest_slug")),window.mixpanel_data={landing:!1,contest:contest_slug}},ChallengeView.prototype.setTopics=function(topic_slug){var challenge_slug,collection,contest_slug,hacker,options,topic_url;return null==topic_slug&&(topic_slug=null),topic_url=this.model.articleBaseUrl(),topic_slug&&(topic_url+="/"+topic_slug),HR.router.navigate(topic_url,!1),HR.appController.setTitle(this.title_leading+" Topics"+this.title_ending),this.activeTab="topics",this.setTab("#"+this.activeTab+"Tab"),challenge_slug=this.model.get("slug"),contest_slug=this.model.get("contest_slug"),hacker=HR.profile(),options={challenge_slug:challenge_slug,contest_slug:contest_slug},this.topicsView||(collection=HR.collection("topic-article",options).cached({reset:!0}),this.topicsView=new HR.TopicsListView({challenge:this.model,contest:this.contest,topic_slug:topic_slug,collection:collection,current_hacker:hacker},this.add_subview(this.topicsView))),topic_slug&&(this.topicsView.topic_slug=topic_slug),this.showView("topics",this.topicsView),HR.appController.set_contest_namespace(contest_slug),window.mixpanel_data={landing:!1,contest:contest_slug,challenge:challenge_slug}},ChallengeView.prototype.clickTopics=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/topics"?this.setTopics():void 0},ChallengeView.prototype.setLeaderboard=function(page){var contest_slug;return null==page&&(page=1),HR.appController.setTitle(this.title_leading+" Leaderboard"+this.title_ending),contest_slug=this.model.get("contest_slug"),this.activeTab="leaderboard",this.setTab("#"+this.activeTab+"Tab"),this.leaderboard_collection||(this.leaderboard_collection=HR.collection("leaderboard"),this.leaderboard_collection.setPage(page),this.leaderboard_collection.setContestSlug(contest_slug),this.leaderboard_collection.setChallenge(this.model.get("slug")),this.leaderboard_collection.setChallengeLeaderboard(),this.leaderboard_collection.setIncludePractice(this.includePractice),this.leaderboardFilter&&this.leaderboard_collection.setFiltersFromString(this.leaderboardFilter),this.leaderboard_collection.cached()),this.leaderboard_view||(this.leaderboard_view=new HR.LeaderboardView({collection:this.leaderboard_collection,profile:HR.profile(),contest:this.contest,iscompanyModerator:this.iscompanyModerator,challenge:this.model}),this.add_subview(this.leaderboard_view)),this.showView("leaderboard",this.leaderboard_view),null===contest_slug&&(contest_slug="master"),HR.appController.set_contest_namespace(this.model.get("contest_slug")),window.mixpanel_data={landing:!1,contest:contest_slug}},ChallengeView.prototype.clickLeaderboard=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/leaderboard"?(HR.router.navigate(this.model.pageURL()+"/leaderboard",!1),this.setLeaderboard()):void 0},ChallengeView.prototype.clickCustomLink=function(e){var slug;return e.preventDefault(),slug=$(e.currentTarget).attr("data-slug"),"/"+Backbone.history.fragment!=this.model.pageURL()+"/"+slug?(HR.router.navigate(this.model.pageURL()+("/"+slug),!1),this.setCustomPage(slug)):void 0},ChallengeView.prototype.toggleLeaderboard=function(e){return this.leaderboard_collection.setIncludePractice(e.currentTarget.checked),this.leaderboard_collection.cached({fetch:!0})},ChallengeView.prototype.changePagination=function(e){var href,page;return"leaderboard"===this.activeTab?(page=$(e.currentTarget).attr("data-page"),href=$(e.currentTarget).attr("href"),HR.router.navigate(href,!1),this.leaderboard_collection.setPage(page),this.leaderboard_collection.cached({fetch:!0}),!1):void 0},ChallengeView.prototype.setExpertSolution=function(){var contest_slug;return HR.appController.setTitle(this.title_leading+" Expert Solution"+this.title_ending),contest_slug=this.model.get("contest_slug"),this.activeTab="expertSolution",this.setTab("#"+this.activeTab+"Tab"),this.comment_collection||(this.comment_collection=new HR.CommentCollection,this.comment_collection.page=1,this.comment_collection.setChallengeSlug(this.model.get("slug")),this.comment_collection.setContestSlug(contest_slug),this.comment_collection.setSortBy("created_at"),this.comment_collection.fetch({reset:!0})),this.expert_solution_view?this.expert_solution_view.liveCodingSetup=!1:(this.expert_solution_view=new HR.ExpertSolutionView({profile:HR.profile(),contest:this.contest,challenge:this.model,comment_collection:this.comment_collection}),this.add_subview(this.expert_solution_view)),this.showView("expertSolution",this.expert_solution_view),null===contest_slug&&(contest_slug="master"),HR.appController.set_contest_namespace(this.model.get("contest_slug")),window.mixpanel_data={landing:!1,contest:contest_slug}},ChallengeView.prototype.clickExpertSolution=function(e){return e.preventDefault(),"/"+Backbone.history.fragment!=this.model.pageURL()+"/expert-solution"?(HR.router.navigate(this.model.pageURL()+"/expert-solution",!1),this.setExpertSolution()):void 0},ChallengeView.prototype.render=function(){var options;return this.model.sync_status&&this.contest.sync_status?(this.time_to_solve||(options={page:this.activeTab,challenge_model:this.model,contest:this.contest},this.time_to_solve=new HR.TimeToSolveModel(options)),void 0===this.model.get("body_html")||null===this.model.get("body_html")?(this.model.cachedFetch({fetch:!0}),this):(this._template=HR.appController.template(this.template,this),this._template?($(this.el).html(this._template({model:this.model})),this.header||(this.header=new HR.ChallengeHeaderView({model:this.model,contest:this.contest,activeTab:this.activeTab})),this.assign({".challenge-header":this.header}),this.model.get("track")?$("challenge-nav-track-container").html("<a href='/domains/"+this.model.get("category")+"/"+this.model.get("track").slug+"' class='backbone'>"+this.model.get("track").name+"</a>"):$("challenge-nav-track-container").html(""),HR.util.hideNavigation(this.contest),this.renderBody(),this.contest.get("hidden")!==!0||this.contest.get("company_associated_contest")!==!1&&null!==this.contest.get("company_associated_contest")||$("div#breadcrumb").hide(),this):this)):($(this.el).html(HR.appController.viewLoader(64)),this)},ChallengeView.prototype.renderBody=function(){return this.bootstrapTitle(),this.setBreadcrumb(),this.cleanupSubviews(),this.customView?this.showView(this.activeTab,this.customView):"leaderboard"===this.activeTab?this.setLeaderboard(this.paramPage||1):"submissions"===this.activeTab?this.submissionId?this.setSubmission(this.submissionId):this.setSubmissions(this.paramPage||1):"forum"===this.activeTab?this.setForum(this.paramPage||1):"editorial"===this.activeTab?this.setEditorial():"expertSolution"===this.activeTab?this.setExpertSolution():"topics"===this.activeTab?this.setTopics(this.topic_slug):this.setProblem()},ChallengeView.prototype.cleanupSubviews=function(){var views;return views=["leaderboard_view","editorialView","commentsView","submissionView","submissionsView","challegeTemplateView"],_.each(views,function(view){return this[view]?(this[view].destroy(),this[view]=void 0):void 0},this)},ChallengeView.prototype.bootstrapTitle=function(){var cat,chap,chap_slug,chapter;return chapter=this.model.get("track"),chap=null,cat=null,chapter&&"master"===this.contest.get("slug")&&(chap_slug=chapter.slug,cat=_.first(_.filter(HR.contest().get("categories"),function(_cat){return chap=_.first(_.filter(_cat.children,function(_chap){return _chap.slug===chap_slug})),null!==chap&&void 0!==chap})),chap=_.first(_.filter(cat.children,function(_chap){return _chap.slug===chap_slug}))),chap&&chap.name&&cat&&cat.name?(this.title_leading=this.model.get("name")+" :",this.default_title_middle=" Challenge",this.title_ending=" | "+chap.name+" | "+cat.name):(this.title_leading=this.model.get("name")+" :",this.default_title_middle=" Challenge",this.title_ending=" | "+HR.contest().get("name"))},ChallengeView.prototype.showLoading=function(tab){return tab&&tab===this.activeTab?(this.$(".challenge-container-element").addClass("hidden"),this.$(".challenge-container-elements-loading").removeClass("hidden")):void 0},ChallengeView.prototype.showView=function(name,view,options){var container_name,obj,tab;return null==options&&(options={}),tab=options.tab?options.tab:name+"Tab",container_name="challenge-body-elements-"+name,this.$(".challenge-body").find("."+container_name).length>0||this.$(".challenge-body").append("<div class='"+container_name+" hidden challenge-container-element'></div>"),this.assign((obj={},obj["."+container_name]=view,obj)),this.activeTab===name?(this.$(".challenge-container-element").addClass("hidden"),this.$("."+container_name).removeClass("hidden"),this.setTab("#"+tab)):void 0},ChallengeView.prototype.renderScore=function(contest){var rank,score;return $(".domain-scores").hide(),"master"===contest.get("slug")&&this.profile.get("scores")&&this.model.get("track")&&this.profile.get("scores")[this.model.get("track").track_slug]?(score=this.profile.get("scores")[this.model.get("track").track_slug].practice.score,rank=this.profile.get("scores")[this.model.get("track").track_slug].practice.rank,$(".domain-score").html(score.toFixed(2)),$(".domain-rank").html(rank),$(".domain-scores").show(),HR.requires(["compound/extra-views"],function(_this){return function(){return _this.badge_view||(_this.badge_view=new HR.BadgeProgressView({track:_this.model.get("track").track_slug})),_this.badge_view.setElement($(".badge-progress")),_this.badge_view.render()}}(this))):void 0},ChallengeView.prototype.destroy=function(){return $(".hide-in-private-contest").show(),$(".page_navigation-sidebar-disabled").addClass("page_navigation-sidebar"),$(".page_navigation-sidebar").removeClass("page_navigation-sidebar-disabled"),ChallengeView.__super__.destroy.apply(this,arguments)},ChallengeView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.ChallengeView=ChallengeView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeHeaderView,HR;return ChallengeHeaderView=function(superClass){function ChallengeHeaderView(){return ChallengeHeaderView.__super__.constructor.apply(this,arguments)}return extend(ChallengeHeaderView,superClass),ChallengeHeaderView.prototype.template="challenge-header",ChallengeHeaderView.prototype.className="challenge-header-view",ChallengeHeaderView.prototype.initialize=function(options){return this.activeTab=options.activeTab,this.contest=options.contest,this.model.bind("change",this.render,this),this.model.bind("reset",this.render,this),this.model.bind("unlockEditorial",this.render,this)},ChallengeHeaderView.prototype.render=function(){var breadCrumbs,bread_crumbs_view;return $(this.el).html(HR.appController.template(this.template,this)({model:this.model.toJSON(),contest:this.contest,baseURL:this.model.pageURL(),activeTab:this.activeTab})),this.$(".apply-blob")&&(this.apply_blob_view?this.apply_blob_view.setElement(this.$(".apply-blob")):(this.apply_blob_view=new HR.ViewShiv({view:"apply-blob",model:this.model,el:this.$(".apply-blob")}),this.add_subview(this.apply_blob_view)),this.apply_blob_view.render()),breadCrumbs=this.model.breadCrumbs(),breadCrumbs.remove(breadCrumbs.last()),bread_crumbs_view=HR.util.renderBreadCrumbs(this.$("div.breadcrumbs"),breadCrumbs),this.add_subview(bread_crumbs_view),this},ChallengeHeaderView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeHeaderView=ChallengeHeaderView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeTemplateView,HR;return ChallengeTemplateView=function(superClass){function ChallengeTemplateView(){return ChallengeTemplateView.__super__.constructor.apply(this,arguments)}return extend(ChallengeTemplateView,superClass),ChallengeTemplateView.prototype.template="challenge-template",ChallengeTemplateView.prototype.className="challenge-template-view",ChallengeTemplateView.prototype.initialize=function(options){return null==options&&(options={}),this.contest=options.contest,this.submission_id=options.submission_id,this.parent=options.parent,this.companySlug=options.companySlug,this.companyName=options.companyName,this.challengeModel=options.challengeModel},ChallengeTemplateView.prototype.setTopics=function(slug){return this.parent.setTopics(slug)},ChallengeTemplateView.prototype.render=function(){var body,events,form_properties,fpInfoString,options;return"mcq"===this.model.get("kind")?(0===this.$("mcq-challenge-view").length&&$(this.el).html('<div class="mcq-challenge-view"></div>'),this.mcq_challenge_view||(this.mcq_challenge_view=new HR.MCQChallengeView({parent:this,model:this.model,contest:this.contest}),this.add_subview(this.mcq_challenge_view)),this.assign({".mcq-challenge-view":this.mcq_challenge_view})):(0===this.$(".challenge-content").length&&(fpInfoString="",this.model.get("track")&&"fp"===this.model.get("track").track_slug&&(fpInfoString='<div class="fp-info container fs-container plB"><p class="clearfix grey-header cap plL plR psT psB" style="color: #a50;border-bottom: 1px solid #c2c7d0;">If you cannot find your favorite language here, please checkout the <a class="backbone" href="/domains/algorithms" data-analytics="FpMessageAlgoLink" >algorithm domain</a>. We support over 30 different languages including some of the most popular ones.</p></div>'),$(this.el).html('<div class="challenge-content"></div>'+fpInfoString+'<div class="challenge-request"></div><div class="challenge-response container fs-container"></div>')),this.content_view||(this.content_view=new HR.ChallengeContentView({parent:this,model:this.model,contest:this.contest}),this.add_subview(this.content_view)),this.request_view||(this.request_view=new HR.ChallengeRequestView({parent:this,model:this.model,submission_id:this.submission_id,companySlug:this.companySlug,companyName:this.companyName,challengeModel:this.challengeModel}),this.add_subview(this.request_view)),this.response_view||(this.response_view=new HR.ChallengeResponseView({parent:this,model:this.model}),this.add_subview(this.response_view)),this.assign({".challenge-content":this.content_view,".challenge-request":this.request_view,".challenge-response":this.response_view}),HR.tour_going&&!this.dialog&&(HR.tour_going=!1,form_properties={},options={title:"Let's get started!"},body="<div class='plL plR onboarding_modal'> <p class='text-center mlT mlB'> This is the code editor. You can compile your code, view the  leaderboard, submissions, and discussions for the challenge, and submit for scoring when you are ready. Happy Hacking! <!--We have left some helpful hints in case you get stuck.--> </p> </div> <footer class='text-center'><a class='mlB btn btn-green btn-large js-close'>Start solving</a></footer>",events={"click .js-close":function(e){var dialog;return dialog=e.data.that,dialog.destroy()}},options.body=body,options.events=events,options.width=640,this.dialog=new HR.util.ShowDialog(options,form_properties),this.dialog.render())),this},ChallengeTemplateView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeTemplateView=ChallengeTemplateView})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ExpertSolutionView,HR,ref;return ExpertSolutionView=function(superClass){function ExpertSolutionView(){return this.renderForum=bind(this.renderForum,this),this.editorModified=bind(this.editorModified,this),this.updateFirebaseData=bind(this.updateFirebaseData,this),this.setupEditor=bind(this.setupEditor,this),this.updateLanguage=bind(this.updateLanguage,this),this.placeCursor=bind(this.placeCursor,this),this.updateCursor=bind(this.updateCursor,this),this.updateOrFindLanguage=bind(this.updateOrFindLanguage,this),this.refreshView=bind(this.refreshView,this),ExpertSolutionView.__super__.constructor.apply(this,arguments)}return extend(ExpertSolutionView,superClass),ExpertSolutionView.prototype.template="expert-solution",ExpertSolutionView.prototype.className="expert-solution-view container",ExpertSolutionView.prototype.initialize=function(options){return this.challenge=options.challenge,this.contest=options.contest,this.profile=options.profile,this.model=HR.model("expert-solution",{challenge_slug:this.challenge.get("slug"),contest_slug:this.contest.get("slug")}).cached(),this.current_hacker=options.current_hacker,this.comment_collection=options.comment_collection,this.listenTo(this.model,"reset",this.render),this.listenTo(HR.profile(),"sync",this.render),this.initializeVariables()},ExpertSolutionView.prototype.initializeVariables=function(){return this.code="",this.firepadDoc=null,this.firebaseDoc=null,this.editor=null,this.language="cpp",this.cursorStart=0,this.currentLine=1,this.liveCodingSetup=!1,this.timeoutSet=null},ExpertSolutionView.prototype.refreshView=function(){return this.stopListening(this.model),this.timeoutSet&&clearTimeout(this.timeoutSet),this.initializeVariables(),this.model=null,this.model=new HR.ExpertSolutionModel({challenge_slug:this.challenge.get("slug"),contest_slug:this.contest.get("slug")}),this.model.fetch(),this.listenTo(this.model,"change",this.render)},ExpertSolutionView.prototype.setupLiveCoding=function(){return this.model&&this.model.get("id")?(this.model.get("ongoing")||this.model.get("codepair_slug"))&&this.model.get("started")?(this.liveCodingSetup=!0,this.firebaseDoc=new Firebase(this.model.editorPath()),this.firebaseDoc.authWithCustomToken(this.model.get("token"),function(_this){return function(error){return error?console.log("Firebase Permission Denied"):_this.setupEditor()}}(this)),this.languageRef=this.firebaseDoc.child("settings/language"),this.languageRef.on("value",this.updateOrFindLanguage),this.editorRef=this.firebaseDoc.child("editor"),this.editorRef.on("child_changed",this.updateFirebaseData),this.usersRef=this.firebaseDoc.child("editor/users"),this.usersRef.on("child_changed",this.updateCursor)):this.$(".live-coding-editor-loading").addClass("hidden"):void 0},ExpertSolutionView.prototype.updateOrFindLanguage=function(snapshot){return snapshot&&this.language!==snapshot&&(this.language=snapshot.val(),this.updateLanguage()),this.language},ExpertSolutionView.prototype.updateCursor=function(snapshot){var value;return value=snapshot.val(),value.cursor&&value.cursor.position&&(this.cursorStart=value.cursor.position,this.firepadDoc)?this.firepadDoc.getText(this.placeCursor):void 0},ExpertSolutionView.prototype.placeCursor=function(text){var lines;return lines=text.substring(0,this.cursorStart),this.currentLine=lines.split("\n").length,this.editor?this.editor.getDoc().setCursor({line:this.currentLine-1,ch:0}):void 0},ExpertSolutionView.prototype.updateLanguage=function(){return this.editor?(this.$(".language-content").html(lang_display_mapping[this.language]),HR.appController.loadCodeMirrorMode(this.language,function(_this){return function(){var info,mode;return info=$.grep(CodeMirror.modeInfo,function(item){return item.mime===lang_mime_mapping[_this.language]}),info.length>0&&(mode=info[0].mode),_this.editor.setOption("mode",lang_mime_mapping[_this.language]),CodeMirror.autoLoadMode(_this.editor,mode)}}(this))):void 0},ExpertSolutionView.prototype.setupEditor=function(){var codeArea,editorOptions;return this.$("#live-code-container").length>0?(codeArea=this.$("#live-code-container")[0],editorOptions={lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:lang_mime_mapping[this.language],indentUnit:4,styleActiveLine:!0,readOnly:!0,value:this.code},HR.appController.loadCodeMirrorMode(this.language,function(_this){return function(){return _this.$("#live-code-container").html(""),_this.editor=CodeMirror(codeArea,editorOptions),_this.updateLanguage(),_this.showEditor(),_this.code?_this.editor.getDoc().setValue(_this.code):void 0}}(this)),this.firepadDoc=new Firepad.Headless(this.editorRef),this.firepadDoc.getText(this.editorModified)):void 0},ExpertSolutionView.prototype.updateFirebaseData=function(){return this.firepadDoc?this.firepadDoc.getText(this.editorModified):void 0},ExpertSolutionView.prototype.editorModified=function(text){return this.code=text,this.editor?(this.editor.getDoc().setValue(text),this.editor.getDoc().setCursor({line:this.currentLine-1,ch:0})):void 0},ExpertSolutionView.prototype.showEditor=function(){return this.$(".live-coding-editor-container").removeClass("hidden"),this.$(".live-coding-editor-loading").addClass("hidden")},ExpertSolutionView.prototype.renderForum=function(){var challenge_slug,contest_slug,that;return that=this,challenge_slug=this.challenge.get("slug"),contest_slug=this.challenge.get("contest_slug"),HR.requires(["compound/forum-views"],function(_this){return function(){return _this.commentsView||(_this.commentsView=new HR.ChallengeCommentsView({challenge:_this.challenge,collection:_this.comment_collection,profile:_this.profile,contest:_this.contest,sort_type:"Recent",expert_tab_embed:!0}),_this.add_subview(_this.commentsView)),_this.assign({".commentsView":_this.commentsView})}}(this))},ExpertSolutionView.prototype.render=function(){var ref;return this.model&&this.model.get("id")&&($(this.el).html(HR.appController.template(this.template,this)({model:this.model.toJSON(),_model:this.model,language:lang_display_mapping[this.language]})),this.liveCodingSetup||this.setupLiveCoding(),0<=(ref=this.model.get("seconds_to_start"))&&3600>=ref&&(this.timeoutSet||(this.timeoutSet=this.model.get("seconds_to_start")<10?setTimeout(this.refreshView,1e3*(this.model.get("seconds_to_start")+2)):setTimeout(this.refreshView,500*this.model.get("seconds_to_start")))),this.model.get("seconds_to_start")<=0&&this.renderForum()),this},ExpertSolutionView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.ExpertSolutionView=ExpertSolutionView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeCustomView,HR,ref;return ChallengeCustomView=function(superClass){function ChallengeCustomView(){return ChallengeCustomView.__super__.constructor.apply(this,arguments)}return extend(ChallengeCustomView,superClass),ChallengeCustomView.prototype.template="challenge-custom",ChallengeCustomView.prototype.className="challenge-custom-view",ChallengeCustomView.prototype.initialize=function(options){return this.tab=options.tab},ChallengeCustomView.prototype.render=function(){var body;return body=this.tab.sidebar?'<div class="span-md-11 plL psR">\n  '+this.tab.content+'\n</div>\n<aside class="span-md-4 pull-right psL plR">\n  '+this.tab.sidebar+"\n</aside>":'<div class="span-md-16 plL plR">\n  '+this.tab.content+"\n</div>",$(this.el).html('<div class="container">\n  <div class="row">\n    '+body+"\n  </div>\n</div>"),this},ChallengeCustomView.prototype.setTab=function(tab){return this.tab=tab,this.render()},ChallengeCustomView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.ChallengeCustomView=ChallengeCustomView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,TopicsListView,ref;return TopicsListView=function(superClass){function TopicsListView(){return TopicsListView.__super__.constructor.apply(this,arguments)}return extend(TopicsListView,superClass),TopicsListView.prototype.template="topicslist",TopicsListView.prototype.className="topics-list-view",TopicsListView.prototype.initialize=function(options){return this.challenge=options.challenge,this.contest=options.contest,this.topic_slug=options.topic_slug,this.listRendered=!1,this.listenTo(this.collection,"reset",this.render),this.metric_sent=!1,this.topicViews=[],this.current_slug=this.topic_slug,this.parent=options.parent},TopicsListView.prototype.events={"click .topic-heading":"clickTopicHeading","click .scroll-to-topics-top":"scrollToTop"},TopicsListView.prototype.clickTopicHeading=function(e){var slug;return e.preventDefault(),slug=$(e.currentTarget).attr("data-slug"),HR.router.navigate(this.challenge.articleBaseUrl()+"/"+slug,!1),hr_metrics.track("Click","ScrollToSlug",{attribute1:this.challenge.get("slug"),attribute2:this.contest.get("slug"),attribute3:this.current_slug,attribute4:slug}),this.current_slug=slug,this.scrollToSlug(slug)},TopicsListView.prototype.scrollToTop=function(){return $("#content").length>0?$("html,body").animate({scrollTop:$("#content").offset().top}):this.$(".topics-list-container").length>0?$("html,body").animate({scrollTop:this.$(".topics-list-container").offset().top-150}):void 0},TopicsListView.prototype.scrollToSlug=function(slug,timeout){return null==timeout&&(timeout=0),window.setTimeout(function(_this){return function(){return _this.$("#"+slug+"-topic").length>0?($("html,body").animate({scrollTop:_this.$("#"+slug+"-topic").offset().top}),_this.topic_slug=null):void 0}}(this),timeout)},TopicsListView.prototype.render=function(){var i,j,len,len1,model,ref,ref1,renderedViews,topicView;if(this.collection&&this.collection.sync_status){if($(this.el).html(HR.appController.template(this.template,this)({collection:this.collection.toJSON(),article_base_url:this.challenge.articleBaseUrl()})),!this.listRendered){for(ref=this.collection.models,i=0,len=ref.length;len>i;i++)model=ref[i],topicView=new HR.TopicView({model:model,parent:this,challenge:this.challenge,contest:this.contest}),this.add_subview(topicView),this.topicViews.push(topicView);this.listRendered=!0}for(renderedViews=$(),ref1=this.topicViews,j=0,len1=ref1.length;len1>j;j++)topicView=ref1[j],renderedViews.push(topicView.render().el);this.$(".topics-container").html(renderedViews),this.topic_slug&&(this.metric_sent||(hr_metrics.track("LoadTopicArticlePage",this.topic_slug,{attribute1:this.challenge.get("slug"),attribute2:this.contest.get("slug"),attribute3:this.topic_slug}),this.metric_sent=!0),this.scrollToSlug(this.topic_slug,200))}return this},TopicsListView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.TopicsListView=TopicsListView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,TopicView,ref;return TopicView=function(superClass){function TopicView(){return TopicView.__super__.constructor.apply(this,arguments)}return extend(TopicView,superClass),TopicView.prototype.template="topic",TopicView.prototype.className="topic-view plT",TopicView.prototype.initialize=function(options){return this.challenge=options.challenge,this.contest=options.contest,this.listenTo(this.model,"reset",this.render)
},TopicView.prototype.renderChallengeCard=function(){var challenge_model;return this.challengeCardView||(challenge_model=new HR.ChallengeModel(this.model.get("related_challenge")),challenge_model.sync_status=!0,this.challengeCardView=new HR.ChallengesListView({model:challenge_model,contest:this.contest,title_string:"Related challenge for <strong>"+this.model.get("title")+"</strong>"}),this.add_subview(this.challengeCardView)),this.$(".challenge-card-container").html(this.challengeCardView.render().el)},TopicView.prototype.render=function(){var renderTopic;return this.model&&this.model.get("title")&&(renderTopic=function(_this){return function(){return $(_this.el).html(HR.appController.template(_this.template,_this)({model:_this.model.toJSON(),challenge:_this.challenge.toJSON(),contest:_this.contest.toJSON()})),_this.model.get("related_challenge")?_this.renderChallengeCard():void 0}}(this),HR.requires(["MathJax/MathJax"],renderTopic),renderTopic()),this},TopicView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.TopicView=TopicView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeContentView,HR;return ChallengeContentView=function(superClass){function ChallengeContentView(){return ChallengeContentView.__super__.constructor.apply(this,arguments)}return extend(ChallengeContentView,superClass),ChallengeContentView.prototype.template="challenge-content",ChallengeContentView.prototype.className="challenge-content-view",ChallengeContentView.prototype.events=function(){return{"click .js-suggest-edits":"showSuggestionDiv","click .js-suggestion-save":"makeSuggestion","click .js-suggestion-cancel":"hideSuggestionDiv"}},ChallengeContentView.prototype.initialize=function(options){return null==options&&(options={}),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.contest=options.contest,this.current_hacker=HR.profile(),this.parent=options.parent},ChallengeContentView.prototype.render=function(){var render_template;return render_template=function(_this){return function(){return $(_this.el).html(HR.appController.template(_this.template,_this)({model:_this.model.toJSON(),contest:_this.contest.toJSON(),baseURL:_this.model.pageURL()})),_this.renderSidebar()}}(this),HR.requires(["MathJax/MathJax"],render_template),render_template(),this},ChallengeContentView.prototype.hideSuggestionDiv=function(e){return e.preventDefault(),$("#suggestion-form").slideToggle(),$(".js-suggest-edits").addClass("in"),$(".alert.error").hide()},ChallengeContentView.prototype.renderSidebar=function(){return this.sidebar||(this.sidebar=new HR.ChallengeSidebarView({model:this.model,contest:this.contest,parent:this}),this.add_subview(this.sidebar)),this.assign({".challenge-sidebar-container":this.sidebar})},ChallengeContentView.prototype.setTopics=function(slug){return this.parent.setTopics(slug)},ChallengeContentView.prototype.showSuggestionDiv=function(e){var support_config;return e.preventDefault(),support_config=new HR.SupportConfigModel({default_category_id:6,default_sub_category_id:20,lock_categories:!0,page_url:window.location.href.replace(/https:\/\/www\./,"")}),support_config.fetch(),$("#suggestion-form").slideToggle().data("support_model",support_config),$(".js-suggest-edits").removeClass("in")},ChallengeContentView.prototype.makeSuggestion=function(e){var form_data,suggestion;return e.preventDefault(),suggestion=$("#suggestion").val().trim(),suggestion.length<20?($(".alert.error").show().html("Your suggestion should contain at least 20 characters."),void 0):($(e.currentTarget).html("Processing Request...").attr("disabled","disabled"),form_data={suggestion:$("#suggestion").val(),challenge_id:this.model.get("id"),challenge_url:"www.hackerrank.com/"+Backbone.history.fragment,contest_slug:HR.appController.get_current_contest_slug(),support_config:$("#suggestion-form").data("support_model").toJSON()},$.ajax({url:"/rest/challenge_edit_suggestion",type:"POST",data:form_data,success:function(data){var error,i,j,len,ref;if($(e.currentTarget).removeAttr("disabled").html("Submit"),data.status)return $(".alert.error").hide(),$("#suggestion-form").slideToggle(),$(".js-suggest-edits").addClass("in");if(0===data.errors.length)error="Unknown Error";else if(1===data.errors.length)error=data.errors[0];else{for(error="<ul style='text-align: left;'>",len=data.errors.length-1,i=j=0,ref=len;ref>=0?ref>=j:j>=ref;i=ref>=0?++j:--j)error+="<li>"+data.errors[i]+"</li>";error+="</ul>"}return $(".alert.error").show().html(error)},error:function(XMLHttpRequest,textStatus,code){return 403===code?$(".alert.error").show().html("Please log in to suggest an edit."):$(".alert.error").show().html("Unknown Error")}}))},ChallengeContentView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeContentView=ChallengeContentView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeSidebarView,HR;return ChallengeSidebarView=function(superClass){function ChallengeSidebarView(){return ChallengeSidebarView.__super__.constructor.apply(this,arguments)}return extend(ChallengeSidebarView,superClass),ChallengeSidebarView.prototype.template="challenge-sidebar",ChallengeSidebarView.prototype.className="challenge-sidebar-view",ChallengeSidebarView.prototype.events=function(){return{"click .share_facebook":"fbshare","click .share_twitter":"tweet","click .share_gplus":"gplus","click .recent-hacker-prev":"recentHackersPrevious","click .recent-hacker-next":"recentHackersNext","change select.translations":"changeLanguage","click a.language-preference":"setLanguagepreference","click a.related-topic-link":"clickRelatedTopicLink"}},ChallengeSidebarView.prototype.initialize=function(options){return null==options&&(options={}),this.model.bind("change",this.render,this),this.model.bind("reset",this.render,this),this.page=1,this.count=25,this.hard_limit=100,this.recent_hacker_sync=!1,this.current_hacker=HR.profile(),this.parent=options.parent,this.contest=options.contest},ChallengeSidebarView.prototype.clickRelatedTopicLink=function(e){var slug;return e.preventDefault(),slug=$(e.currentTarget).attr("data-slug"),this.parent.setTopics(slug)},ChallengeSidebarView.prototype.changeLanguage=function(e){var changed_language,filter,render_name_html;return $("#preference-msg").css("display","none"),changed_language=$(e.currentTarget).val(),filter=_.select(this.model.get("available_translations"),function(translation){return translation.language===changed_language}),this.current_hacker.get("local_language")||$("#preference-msg").css("display","inline-block"),render_name_html=function(_this){return function(){var html;return 1===filter.length?(html=filter[0].body_html,$(".challenge-text").html(html),$(".hr_tour-challenge-name").html(filter[0].name||_this.model.get("name")),_this.updatePdfLink(filter[0].language)):(html=_this.model.get("body_html"),$(".challenge-text").html(html),$(".hr_tour-challenge-name").html(_this.model.get("name")),_this.updatePdfLink("English"))}}(this),HR.requires(["MathJax/MathJax"],render_name_html),render_name_html(),hr_metrics.track("ChangeProblemLanguage",changed_language,{attribute1:this.model.get("slug")})},ChallengeSidebarView.prototype.updatePdfLink=function(language){var element,pdf_url,rest;return $("#pdf-link").size()>0?(element=$("#pdf-link")[0],pdf_url="/rest"+HR.appController.namespace(HR.appController.get_current_contest_slug(),rest=!0)+"challenges/"+this.model.get("slug")+"/download_pdf?language="+language,$("#pdf-link")[0].href=pdf_url):void 0},ChallengeSidebarView.prototype.setLanguagepreference=function(e){var changed_language;return changed_language=$(".translations :selected").text().trim(),e.preventDefault(),$("#preference-msg").html("Saving language preference..."),this.current_hacker.set("local_language",changed_language),this.current_hacker.save(null,{success:function(){return $("#preference-msg").html("Language preference updated."),setTimeout(function(){return $("#preference-msg").css("display","none")},3e3)},error:function(){return $("#preference-msg").html("There was some error while saving your preferences.")}})},ChallengeSidebarView.prototype.recentHackersPrevious=function(){return this.recent_hacker_sync?this.page<=1?void 0:(this.page=this.page-1,this.recent_hackers_page=this.recent_hackers.slice((this.page-1)*this.count,this.page*this.count),this.render()):void 0},ChallengeSidebarView.prototype.recentHackersNext=function(){return this.recent_hacker_sync?this.page*this.count>=parseInt(this.model.get("submitted_hackers_count"))||this.page*this.count>=this.hard_limit?void 0:(this.page=this.page+1,this.recent_hackers_page=this.recent_hackers.slice((this.page-1)*this.count,this.page*this.count),this.render()):void 0},ChallengeSidebarView.prototype.get_recent_hackers=function(){var that;return that=this,this.recent_hacker_sync=!1,this.render(),$.ajax({url:this.model.restURL()+"/recent_hackers",success:function(data){return that.recent_hackers=data,that.recent_hackers_page=that.recent_hackers.slice(0,that.count),that.recent_hacker_sync=!0,that.render()}})},ChallengeSidebarView.prototype.render=function(){return $(this.el).html(HR.appController.template(this.template,this)({model:this.model.toJSON(),contest:this.contest.toJSON(),article_base_url:this.model.articleBaseUrl()})),this.setLanguageSelected(),this.startRelatedTopicsTour(),HR.util.hideNavigation(this.contest),this},ChallengeSidebarView.prototype.startRelatedTopicsTour=function(){return this.eligibleForTour()?(this.current_hacker.set("related_topics_tour_done",!0,{silent:!0}),this.current_hacker.save({silent:!0}),setTimeout(function(){return function(){var intro;return intro=introJs(),intro.setOptions({steps:[{element:".related-topics"}],showBullets:!1,showButtons:!1,showStepNumbers:!1,tooltipClass:"hide",highlightClass:"topic-intro-highlight",overlayOpacity:.4}),intro.start(),$(".topic-intro-highlight").append('<i class="pull-right topic-tour-close-icon icon--single icon-cancel-small cursor"></i>'),$(".introjs-tooltipReferenceLayer").click(function(){return intro.exit()})}}(this),2e3)):void 0},ChallengeSidebarView.prototype.eligibleForTour=function(){return this.current_hacker.isLoggedIn()&&this.model.get("topics")&&this.model.get("topics").length>0&&!this.current_hacker.get("related_topics_tour_done")&&this.$(".related-topics").length>0},ChallengeSidebarView.prototype.setLanguageSelected=function(){var current_language;return current_language=this.model.get("preferred_language")?this.model.get("preferred_language"):"English",$("option[value="+current_language+"]").attr("selected","selected"),this.updatePdfLink(current_language)},ChallengeSidebarView.prototype.updatePdfLink=function(language){var element,pdf_url,rest;return $("#pdf-link").size()>0?(element=$("#pdf-link")[0],pdf_url="/rest"+HR.appController.namespace(HR.appController.get_current_contest_slug(),rest=!0)+"challenges/"+this.model.get("slug")+"/download_pdf?language="+language,$("#pdf-link")[0].href=pdf_url):void 0},ChallengeSidebarView.prototype.fbshare=function(e){var h,left,permalink,top,url,w;return permalink=this.getPermaLink(),e.preventDefault(),w=600,h=350,left=screen.width/2-w/2,top=screen.height/2-h/2,url="https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+encodeURIComponent(document.location.href)+"&p[title]="+encodeURIComponent(this.model.get("name"))+"&p[summary]="+encodeURIComponent(this.model.get("preview")),window.open(url,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left),window.focus()},ChallengeSidebarView.prototype.tweet=function(e){var h,left,permalink,text,top,url,w;return permalink=this.getPermaLink(),e.preventDefault(),w=600,h=350,left=screen.width/2-w/2,top=screen.height/2-h/2,text="Great challenge on @HackerRank. Try it here: "+permalink,url="https://twitter.com/intent/tweet?text="+encodeURIComponent(text),window.open(url,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left),window.focus()},ChallengeSidebarView.prototype.gplus=function(e){var h,left,permalink,top,url,w;return permalink=this.getPermaLink(),e.preventDefault(),w=600,h=350,left=screen.width/2-w/2,top=screen.height/2-h/2,url="https://plus.google.com/share?url="+permalink,window.open(url,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left),window.focus()},ChallengeSidebarView.prototype.getPermaLink=function(){return document.location.protocol+"//"+document.location.host+HR.appController.current_contest_namespace+"/challenges/"+this.model.get("slug")},ChallengeSidebarView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeSidebarView=ChallengeSidebarView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeRequestView,HR;return ChallengeRequestView=function(superClass){function ChallengeRequestView(){return ChallengeRequestView.__super__.constructor.apply(this,arguments)}return extend(ChallengeRequestView,superClass),ChallengeRequestView.prototype.template="challenge-request",ChallengeRequestView.prototype.className="challenge-request-view",ChallengeRequestView.prototype.initialize=function(options){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.submission_id=options.submission_id,this.parent=options.parent,this.companySlug=options.companySlug,this.companyName=options.companyName,this.challengeModel=options.challengeModel},ChallengeRequestView.prototype.render=function(){return $(this.el).html(HR.appController.template(this.template,this)()),-1!==$.inArray(this.model.get("kind"),["code","game","client-server","database"])?(this.codeeditor||(this.codeeditor=new HR.CodeEditorView({model:this.model,parent:this,submission_id:this.submission_id,companySlug:this.companySlug,companyName:this.companyName,challengeModel:this.challengeModel}),this.add_subview(this.codeeditor)),this.assign({"div.codeeditor-wrapper":this.codeeditor})):-1!==$.inArray(this.model.get("kind"),["dataset"])&&(this.datasets_upload_view||(this.datasets_upload_view=new HR.DataSetsUploadView({model:this.model,parent:this}),this.add_subview(this.datasets_upload_view)),this.assign({"div.codeeditor-wrapper":this.datasets_upload_view})),this},ChallengeRequestView.prototype.unSetFullScreenView=function(){return this.fullscreen_view=void 0},ChallengeRequestView.prototype.setFullScreenView=function(fullscreen_view){return this.fullscreen_view=fullscreen_view},ChallengeRequestView.prototype.unrenderFullScreenView=function(){return this.fullscreen_view?this.fullscreen_view.unRender():void 0},ChallengeRequestView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeRequestView=ChallengeRequestView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var ChallengeResponseView,HR;return ChallengeResponseView=function(superClass){function ChallengeResponseView(){return ChallengeResponseView.__super__.constructor.apply(this,arguments)}return extend(ChallengeResponseView,superClass),ChallengeResponseView.prototype.template="challenge-response",ChallengeResponseView.prototype.className="challenge-response-view",ChallengeResponseView.prototype.initialize=function(){return this.model.bind("change",this.render,this),this.model.bind("reset",this.render,this),this.response_type=null},ChallengeResponseView.prototype.render=function(){return $(this.el).html("<h5 class='output-progress padded light-wrap hide mlT mlB psT'></h5>\n<div class='output-area-wrap hide'>\n  <div class='output-area mlT psT' id='output-area'></div>\n</div>"),this.renderSubView(),this},ChallengeResponseView.prototype.renderSubView=function(){return"compile_test"===this.response_type?this.renderCompileTestView():"submission"===this.response_type?this.renderSubmissionView():this.clear()},ChallengeResponseView.prototype.renderCompileTestView=function(){return"game"===this.model.get("kind")?this.subview||(this.subview=new HR.GameCompileTestView({model:this.compile_test,parent:this})):"code"===this.model.get("kind")||"database"===this.model.get("kind")?this.subview||(this.subview=new HR.CodeCompileTestView({model:this.compile_test,parent:this})):"client-server"===this.model.get("kind")&&(this.subview||(this.subview=new HR.ClientServerCompileTestView({model:this.compile_test,parent:this}))),this.assign({"#output-area":this.subview}),this.showHideViews()},ChallengeResponseView.prototype.setCompileTest=function(compile_test){return this.clearModelListeners(),this.response_type="compile_test",this.compile_test=compile_test,this.listenTo(this.compile_test,"reset",this.showHideViews),this.listenTo(this.compile_test,"change:id",this.showHideViews),this.listenTo(this.compile_test,"change:status",this.showHideViews),this.render()},ChallengeResponseView.prototype.renderSubmissionView=function(){return"game"===this.model.get("kind")||-1!==_.indexOf(["client-server","code","database"],this.model.get("kind"))&&(this.subview||(this.subview=new HR.SubmissionResponseView({model:this.submission,challenge:this.model,contest_score:this.contest_score,parent:this}))),this.assign({"#output-area":this.subview}),this.showHideViews()},ChallengeResponseView.prototype.setSubmissionView=function(submission){return this.clearModelListeners(),this.response_type="submission",this.submission=submission,this.contest_score=this.submission.get("contest_score"),this.listenTo(this.submission,"reset",this.showHideViews),this.listenTo(this.submission,"change:id",this.showHideViews),this.listenTo(this.submission,"change:status",this.showHideViews),this.render()},ChallengeResponseView.prototype.clearModelListeners=function(){return this.compile_test&&(this.stopListening(this.compile_test),this.clear()),this.submission?(this.subview&&this.subview.destroy(),this.stopListening(this.submission),this.clear()):void 0},ChallengeResponseView.prototype.showHideViews=function(){return"compile_test"===this.response_type?2===this.compile_test.get("status")&&this.compile_test.get("errors")?this.showError():this.compile_test.get("status")>0||_.isArray(this.compile_test.get("games"))&&this.compile_test.get("games").length>0?(this.$(".output-progress").addClass("hide"),this.$(".output-area-wrap").removeClass("hide")):(this.$(".output-progress").removeClass("hide"),_.isNumber(this.compile_test.get("id"))?this.compile_test.get("status_string")?this.$(".output-progress").html(this.compile_test.get("status_string")):this.$(".output-progress").html("Processing"):this.$(".output-progress").html("Uploading")):(this.response_type="submission")?this.$(".output-area-wrap").show():void 0},ChallengeResponseView.prototype.showError=function(){return this.$(".output-progress").html("<p class='error'>"+this.compile_test.get("errors").join("<br/>")+"</p>")},ChallengeResponseView.prototype.clear=function(){return this.subview&&(this.subview.destroy(),this.subview=void 0),this.$(".output-area").addClass("hide")},ChallengeResponseView}(window.HR.GenericView),HR=window.HR||{},HR.ChallengeResponseView=ChallengeResponseView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var FullScreenView,HR;return FullScreenView=function(superClass){function FullScreenView(){return FullScreenView.__super__.constructor.apply(this,arguments)}return extend(FullScreenView,superClass),FullScreenView.prototype.el="body",FullScreenView.prototype.template="fullscreen",FullScreenView.prototype.initialize=function(options){return this.profile=HR.profile(),this.parent=options.parent,this.template_view=this.parent.parent.parent},FullScreenView.prototype.render=function(){var set_height,that;return that=this,0===$(this.el).find("#fullscreen-wrapper").length&&$(this.el).append("<div id='fullscreen-wrapper'></div>"),$(this.el).css("overflow-y","hidden"),$(this.el).find("#fullscreen-wrapper").show(),$(this.el).find("#fullscreen-wrapper").height($(window).height()).html(_.template('<div class="left-sidebar"> <div class="challenge-content"></div> </div> <div class="separator"></div> <div class="right-sidebar"> <div class="challenge-request"></div> <div class="challenge-response"></div> </div> <div class="clearfix"></div>')({model:this.model.toJSON()})),this.$left_sidebar=$(this.el).find("#fullscreen-wrapper .left-sidebar"),this.$right_sidebar=$(this.el).find("#fullscreen-wrapper .right-sidebar"),this.$separator=$(this.el).find("#fullscreen-wrapper .separator"),set_height=function(_this){return function(){return _this.$left_sidebar.height($(window).height()),_this.$right_sidebar.height($(window).height()),_this.$separator.height($(window).height())}}(this),set_height(),$(window).resize(set_height),this.template_view.request_view.setFullScreenView(this),this.assign({".left-sidebar .challenge-content":this.template_view.content_view,".right-sidebar .challenge-request":this.template_view.request_view,".right-sidebar .challenge-response":this.template_view.response_view}),$("div.separator").dragResize({activeColor:"#AAA",inactiveColor:"#DDD",resize:function(pageX){var document_width,left_sidebar_width,left_sidebar_width_px,right_sidebar_width,right_sidebar_width_px,separator_width;return separator_width=7,document_width=$(window).width(),left_sidebar_width_px=pageX-3,right_sidebar_width_px=document_width-(left_sidebar_width_px+10),left_sidebar_width=100*(left_sidebar_width_px/document_width)+"%",right_sidebar_width=100*(right_sidebar_width_px/document_width)+"%",that.$left_sidebar.css("width",left_sidebar_width),that.$right_sidebar.css("width",right_sidebar_width),Backbone.trigger("fullScreenModeResize")}}),this},FullScreenView.prototype.unRender=function(){return $(this.el).css("overflow-y","visible"),$(this.el).find("#fullscreen-wrapper").length>0&&$(this.el).find("#fullscreen-wrapper").unbind().remove(),this.template_view.request_view.unSetFullScreenView(this),this.template_view.render()},FullScreenView}(window.HR.GenericView),HR=window.HR||{},HR.FullScreenView=FullScreenView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,MCQChallengeView;return MCQChallengeView=function(superClass){function MCQChallengeView(){return MCQChallengeView.__super__.constructor.apply(this,arguments)}return extend(MCQChallengeView,superClass),MCQChallengeView.prototype.template="mcq-challenge",MCQChallengeView.prototype.className="mcq-challenge-view",MCQChallengeView.prototype.initialize=function(options){return null==options&&(options={}),this.contest=options.contest,this.profile=HR.profile()},MCQChallengeView.prototype.render=function(){return $(this.el).html(HR.appController.template(this.template,this)({model:this.model.toJSON()})),this},MCQChallengeView.prototype.events=function(){return{"click .answer-icon":"startSubmission",submitAnswer:"submitAnswer"}},MCQChallengeView.prototype.startTimer=function(){return this.$(".qod-timer").removeClass("hidden"),this.max_width=this.$(".qod-timer").width(),this.progressTimer()},MCQChallengeView.prototype.progressTimer=function(){var func,that;return this.$(".qod-progress div").width(0),that=this,func=function(){var width;return width=that.$(".qod-progress div").width()+1,width>100?void 0:(that.$(".qod-progress div").width(width),100===width?that.clearTimer():void 0)},this.interval=setInterval(func,30)},MCQChallengeView.prototype.clearTimer=function(){return $(this.el).trigger("submitAnswer"),clearInterval(this.interval)},MCQChallengeView.prototype.startSubmission=function(e){var checkbox;return e.preventDefault(),this.profile.isLoggedIn()?(checkbox=$(e.target),checkbox.hasClass("inactive")||this.model.get("answer")?void 0:checkbox.hasClass("circle-fill")?(clearInterval(this.interval),this.$(".qod-timer").addClass("hidden"),checkbox.removeClass("circle-fill").addClass("circle-empty"),void 0):(clearInterval(this.interval),this._checkbox=checkbox,this._answer=checkbox.data("aid"),this.$(".answer-icon").removeClass("circle-fill").addClass("circle-empty"),this._checkbox.removeClass("circle-empty").addClass("circle-fill"),this.startTimer(),hr_metrics.track("McqSubmissionStarted","",{attribute1:this.model.get("id"),attribute2:this._answer}))):(this.showLoginDialog(),void 0)},MCQChallengeView.prototype.submitAnswer=function(){var success_callback,that;return this.$(".answer-icon").addClass("inactive"),that=this,success_callback=function(response){return that.questionSolved(response)},this.model.submitMcq(this._answer,this.contest.get("id"),success_callback)},MCQChallengeView.prototype.questionSolved=function(response){return this.$(".answer-icon").removeClass("circle-empty"),response.status?(response.model.solved?this._checkbox.removeClass("circle-fill").addClass("icon-ok"):(this._checkbox.removeClass("circle-fill").addClass("icon-cancel-large"),this.$(".answer-icon[data-aid='"+response.correct_answer+"']").removeClass("circle-empty").addClass("icon-ok")),this.model.set("answer",response.correct_answer),this.model.set("hacker_mcq_attempt",response.model),this.model.flush(),this.$(".qod-timer").addClass("hidden")):void 0},MCQChallengeView.prototype.showLoginDialog=function(){var dialog;return dialog=HR.util.ShowLoginDialog({error_message:"Please login in order to submit",show_sign_up_link:!0}),dialog.render()},MCQChallengeView}(window.HR.GenericView),HR=window.HR||{},HR.MCQChallengeView=MCQChallengeView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var CodeEditorView,HR,ref;return CodeEditorView=function(superClass){function CodeEditorView(){return CodeEditorView.__super__.constructor.apply(this,arguments)}return extend(CodeEditorView,superClass),CodeEditorView.prototype.template="codeeditor",CodeEditorView.prototype.className="codeeditor-view",CodeEditorView.prototype.initialize=function(options){return this.model=options.model,this.parent=options.parent,this.profile=HR.profile(),this.forkable=!1,this.clipboardnotset=!0,this.submission_id=options.submission_id,this.companySlug=options.companySlug,this.companyName=options.companyName,this.challengeModel=options.challengeModel,this.submission_id&&(this.submission=HR.model("submission",{id:this.submission_id,contest_slug:HR.contest().get("slug")}),this.submission.disable_polling=!0,this.submission.fetch(),this.listenTo(this.submission,"reset",this.render),this.listenTo(this.submission,"change",this.render)),this.listenTo(this.profile,"reset",this.renderOptInView)},CodeEditorView.prototype.events={"click #codeshell-wrapper a.fullscreen":"makeFullscreen","click #codeshell-wrapper a.restorefullscreen":"restoreFullscreen","click #codeshell-wrapper button.upload_file":"confirmUploadFileDialog","codeshellcompile #codeshell-wrapper":"compileTest","codeshellsubmit #codeshell-wrapper":"submitPopup"},CodeEditorView.prototype.render=function(){return(this.submission_id&&this.submission.sync_status||!this.submission_id)&&0===$(this.el).find("#codeshell-wrapper").length&&($(this.el).html("<div id='codeshell-wrapper'></div><div id='submission-message'></div>"),HR.appController.loadCodeMirror(function(_this){return function(){return _this.applyCodeshell(),_this.profile.isLoggedIn()&&_this.renderOptInView(),_this.isFullscreened?_this.$(".fullscreen").click():void 0}}(this))),this},CodeEditorView.prototype.renderOptInView=function(){return null!=this.companySlug?(this.hackercompanypreferencesmodel=HR.model("hacker-company-preferences"),this.hackercompanypreferencesmodel.setCompanyId(this.companySlug),this.hackercompanypreferencesmodel.set({contest_slug:this.challengeModel.get("contest_slug"),challenge_slug:this.challengeModel.get("slug")}),this.hackerCompanyOptInView||(this.hackerCompanyOptInView=new HR.HackerCompanyOptInView({model:this.hackercompanypreferencesmodel,companyName:this.companyName})),this.add_subview(this.hackerCompanyOptInView),this.assign({"#codeshell-wrapper .code-checker":this.hackerCompanyOptInView})):void 0},CodeEditorView.prototype.applyCodeshell=function(){var fork_data,that;return that=this,fork_data={},this.submission_id&&this.submission.get("code")&&(fork_data.initialCode=this.submission.get("code"),fork_data.initialLanguage=this.submission.get("language")),this.$("#codeshell-wrapper").codeshell($.extend($.extend({showCustomInput:this.model.get("compile_and_test")&&this.model.get("custom_case"),showCompileTest:this.model.get("compile_and_test"),showSubmit:!0,showUploadCode:!0,showFullScreen:!0,showTheme:!0,foldCode:!0,enableTrackTyping:!0,compile_button_text:"Run Code",enableIntellisense:!0,enableVersioning:this.profile.isLoggedIn(),versionIds:this.model.get("version_ids")||[],versioningRestUrl:this.model.restURL()+"/versions",dynamicMode:!0,languages:this.model.get("languages"),autoSaveNamespace:"hr-cedit-contest:"+HR.contest().get("id")+"-challenge:"+this.model.get("id"),loadmode:function(){return function(e,data){return HR.appController.loadCodeMirrorMode(data.lang,function(){return data.callback()})}}(this)},this.model.getLanguageTemplates()),fork_data)),this.$("#codeshell-wrapper").codeshell("onChange",this.deleteMarkersOnSource)},CodeEditorView.prototype.makeFullscreen=function(){return this.isFullscreened||(this.$("#codeshell-wrapper").codeshell("saveLangCode"),this.fullscreen||(this.fullscreen=new HR.FullScreenView({model:this.model,parent:this})),this.fullscreen.render(),this.isFullscreened=!0),this.$(".fullscreen").addClass("force-hide").removeClass("active-link"),this.$(".restorefullscreen").removeClass("force-hide").addClass("active-link")},CodeEditorView.prototype.restoreFullscreen=function(){return this.$("#codeshell-wrapper").codeshell("saveLangCode"),this.fullscreen.unRender(),this.isFullscreened=!1,this.$(".fullscreen").removeClass("force-hide"),this.$(".restorefullscreen").addClass("force-hide"),setTimeout(function(){return $("body").scrollTop($("#codeshell-wrapper").offset().top-50)},100)},CodeEditorView.prototype.confirmUploadFileDialog=function(){var dialog,that;return this.showConfirmUpload()?this.uploadFileDialog():(that=this,dialog=new HR.util.ShowConfirmationDialog({title:"Attn: Upload file",body:"<p>Uploading a file will replace the current content in your code editor. Would you like to continue?</p> <p class='gray-text' style='font-size: 14px;'> <input id='confirm-upload-checkbox' type='checkbox' class='confirm-upload'> <label style='display: inline-block; font-weight: normal;' for='confirm-upload-checkbox'>skip this alert next time</label> </p>",buttons:[{name:"No","class":"hr_secondary-btn hr-dialog-button",callback:function(dialog){return that.toggleConfirmUpload(dialog.$body().find("input.confirm-upload").is(":checked")),this.setInactive(),dialog.destroy()}},{name:"Yes","class":"hr_primary-btn hr-dialog-button",callback:function(dialog){return that.toggleConfirmUpload(dialog.$body().find("input.confirm-upload").is(":checked")),this.setInactive(),dialog.destroy(),that.uploadFileDialog()}}]}),dialog.render())},CodeEditorView.prototype.toggleConfirmUpload=function(flag){return $.cookie("code_upload_as_file",flag===!1)
},CodeEditorView.prototype.showConfirmUpload=function(){return"false"===$.cookie("code_upload_as_file")?!0:!1},CodeEditorView.prototype.uploadFileDialog=function(){var buttons,dialog,fields,language_options,that;return that=this,language_options={},language_options["auto-detect"]="Auto Detect",language_options["current-language"]="Current Language",_.each(this.model.get("languages"),function(k){return language_options[k]=window.lang_display_mapping[k]}),fields=[{name:"source_file",title:"Source File",type:"file"},{name:"language",title:"Language",type:"select",options:language_options},{name:"challenge_id",value:that.model.get("id"),type:"hidden"},{name:"contest_id",value:that.model.get("contest_id"),type:"hidden"},{name:"current_language",value:$("#codeshell-wrapper").codeshell("getOptions").language,type:"hidden"},{name:"is_file_upload",value:"1",type:"hidden"}],buttons=[{name:"Upload",callback:function(dialog){var $form,btn,formData;return btn=this,$form=dialog.$form(),formData=new FormData($form[0]),btn.unSetFailedMsg(),$.ajax({url:"/rest/upload_respawn",type:"POST",data:formData,cache:!1,contentType:!1,processData:!1,success:function(data){return btn.setInactive(),data.ok?that.$("#codeshell-wrapper").codeshell("getOptions").lang_display_mapping[data.data.language]?HR.appController.loadCodeMirrorMode(data.data.language,function(){return function(){return that.$("#codeshell-wrapper").codeshell("forkNewBuffer",{language:data.data.language,code:data.data.source}),dialog.destroy()}}(this)):btn.failed("Language not supported for this challenge"):btn.failed(data.message)}})}}],dialog=new HR.util.ShowFormDialog({title:"Upload Dialog",width:650,enctype:"multipart/form-data",fields:fields,buttons:buttons}),dialog.render()},CodeEditorView.prototype.compileTest=function(e,data){var $btn,codeeditor_body_view,compile_test,response_view;return this.cleanupSubmissionMessage(),0===_.size(data)||(response_view=this.parent.parent.response_view,codeeditor_body_view=this.parent.body,this.deleteMarkersOnSource(),$btn=$(e.currentTarget).find("button.bb-compile"),"disabled"===$btn.attr("btn-disabled")||_.isEmpty($("#codeshell-wrapper").codeshell("getOptions").language))?void 0:($btn.attr("btn-disabled","disabled"),$btn.addClass("disabled"),compile_test=new HR.CompileTestModel({code:data.code,language:data.language}),compile_test.setChallenge(this.model),data.custominput?(compile_test.set("customtestcase",!0),compile_test.set("custominput",data.custominput)):compile_test.set("customtestcase",!1),compile_test.save(),compile_test.bind("change:status",this.enableCompileTest,this),compile_test.bind("change:error_markers",this.addMarkersOnSource,this),response_view.setCompileTest(compile_test))},CodeEditorView.prototype.addMarkersOnSource=function(model,error_markers){var editor,error_message,i,line_number,line_offset,marker_node,markers,total_lines;if(error_markers){window.error_marker_widgets||(window.error_marker_widgets=[]),editor=this.$("#codeshell-wrapper").codeshell("getEditor"),line_offset=error_markers.head_code_lines,total_lines=editor.lineCount(),markers=error_markers.markers;for(i in markers)error_message=markers[i].message,line_number=markers[i].line_number-line_offset,total_lines>=line_number&&(marker_node=$("<div class='error-marker'><span class='error-marker-icon'>!</span>"+error_message+"</div>"),window.error_marker_widgets.push(editor.addLineWidget(line_number-1,marker_node[0],{above:!0})));return editor.refresh()}},CodeEditorView.prototype.deleteMarkersOnSource=function(){var editor,i;if(window.error_marker_widgets&&0!==window.error_marker_widgets.length){editor=this.$("#codeshell-wrapper").codeshell("getEditor");for(i in window.error_marker_widgets)editor.removeLineWidget(window.error_marker_widgets[i]);return editor.refresh(),window.error_marker_widgets=[]}},CodeEditorView.prototype.enableCompileTest=function(model,status){var error;return status>0&&(this.$("#codeshell-wrapper").codeshell("enableCompileBtn"),error=model.get("error"))?this.parent.parent.response_view.showError():void 0},CodeEditorView.prototype.submitPopup=function(e,data){var $btn,_timeoutFn,current_text,dialog,error,final_callback,that;return this.cleanupSubmissionMessage(),that=this,$btn=$(e.currentTarget).find("button.bb-submit"),"disabled"!==$btn.attr("btn-disabled")?($btn.attr("btn-disabled","disabled"),$btn.addClass("disabled"),current_text=$btn.html(),this.model.get("submit_disabled")===!0||HR.CONTEST_DISABLED?(error=new HR.util.ShowSubmitDisabledDialog,error.render(),void 0):this.profile.isLoggedIn()?($btn.html("Submitting"),"master"===this.model.get("contest_slug")||"true"===$.cookie("confirm_submit_code")?(final_callback=function(){return function(){return $btn.removeAttr("btn-disabled"),$btn.removeClass("disabled"),$btn.html(current_text)}}(this),this.saveSubmission(data,final_callback)):(dialog=new HR.util.ShowConfirmationDialog({title:"Confirm Submission",body:"Are you sure you want to submit this code? <p class='gray-text' style='font-size: 14px;'> <input id='confirm-submit-checkbox' type='checkbox' class='confirm-submit'> <label style='display: inline-block; font-weight: normal;' for='confirm-submit-checkbox'>Don't ask me again</label> </p>",onDestroy:function(){return $btn.removeAttr("btn-disabled"),$btn.removeClass("disabled"),$btn.html(current_text)},buttons:[{name:"No, do not submit","class":"hr_secondary-btn hr-dialog-button",callback:function(dialog){return that.saveConfirmSubmitChoice(dialog.$body().find("input.confirm-submit").is(":checked")),this.setInactive(),dialog.destroy()}},{name:"Yes, submit my code","class":"hr_primary-btn hr-dialog-button",callback:function(dialog){var btn;return that.saveConfirmSubmitChoice(dialog.$body().find("input.confirm-submit").is(":checked")),btn=this,final_callback=function(){return function(){return dialog.destroy()}}(this),that.saveSubmission(data,final_callback,btn,dialog)}}]}),dialog.render())):($btn.html("Logging in"),_timeoutFn=function(){return that.profile.isLoggedIn()?($btn.removeAttr("btn-disabled"),$btn.removeClass("disabled"),$btn.click()):setTimeout(_timeoutFn,100)},dialog=new HR.util.ShowLoginDialog({body_text:"Please login in order to submit",onDestroy:function(){return $btn.removeAttr("btn-disabled"),$btn.removeClass("disabled"),$btn.html(current_text)},success_callback:function(){return $btn.html(current_text),setTimeout(_timeoutFn,100)},show_sign_up_link:!0}),dialog.render(),void 0)):void 0},CodeEditorView.prototype.saveConfirmSubmitChoice=function(flag){return $.cookie("confirm_submit_code",flag===!0)},CodeEditorView.prototype.saveSubmission=function(data,final_callback,btn,dialog){var submission,that;return null==btn&&(btn=null),null==dialog&&(dialog=null),that=this,that.submitLock&&that.submitLock===!0?void 0:""!==that.$("#codeshell-wrapper").codeshell("getOptions").language?(btn&&btn.setInactive(),that.submitLock=!0,that.$("#codeshell-wrapper").codeshell("deleteLangCode"),submission=HR.model("submission",{code:data.code,language:data.language,contest_slug:that.model.contest_slug||that.model.get("contest_slug")}),submission.setChallenge(that.model),submission.save(null,{success:function(model,response){var failed_error_message;return _gaq.push(["_trackPageview","/submitcode/"+(that.model.get("contest_slug")||that.model.contest_slug)+"/"+that.model.slug+"/"]),HR.QUEUED_SUBMISSIONS||(HR.QUEUED_SUBMISSIONS={}),HR.QUEUED_SUBMISSIONS[model.get("id")]=!0,that.submitLock=!1,response.status?(final_callback(),HR.ABTest.activate("submission_flow"),HR.ABTest.is_variant("submission_flow","treatment")&&!that.model.isGameChallenge()?that.parent.parent.response_view.setSubmissionView(model):(that.parent.unrenderFullScreenView(),model.set("kind",that.model.get("kind"),{silent:!0}),HR.router.navigate(model.pageURL(),!0),$("html body").animate({scrollTop:0},300))):(response.errors?failed_error_message=response.errors[0]:response.message&&(failed_error_message=response.message),btn?(btn.setActive(),btn.setFailedMsg(failed_error_message)):(that.$("#submission-message").html("<p class='error'>"+failed_error_message+"</p>"),final_callback()))},error:function(){return that.submitLock=!1,btn?(btn.setActive(),btn.setFailedMsg("Internal server error occured. Please try again.")):(that.$("#submission-message").html("<p class='error'>Internal server error occured. Please try again.</p>"),final_callback())}})):(btn&&btn.setInactive(),dialog?dialog.showError("Select a language!"):(that.$("#submission-message").html("<p class='error'>Select a language!</p>"),final_callback()))},CodeEditorView.prototype.cleanupSubmissionMessage=function(){return null!=this.hackerCompanyOptInView&&this.hackerCompanyOptInView.autoSelect(),this.$("#submission-message").html("")},CodeEditorView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.CodeEditorView=CodeEditorView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,HackerCompanyOptInView,ref;return HackerCompanyOptInView=function(superClass){function HackerCompanyOptInView(){return HackerCompanyOptInView.__super__.constructor.apply(this,arguments)}return extend(HackerCompanyOptInView,superClass),HackerCompanyOptInView.prototype.initialize=function(options){return this.companySlug=options.companySlug,this.companyName=options.companyName,this.challengeModel=options.challengeModel,this.model=options.model,this.model.fetch({data:{contest_slug:this.model.get("contest_slug"),challenge_slug:this.model.get("challenge_slug")},success:function(_this){return function(){return _this.render()}}(this)})},HackerCompanyOptInView.prototype.events={"click .opt-in-radio":"saveState"},HackerCompanyOptInView.prototype.render=function(){return this.model.sync_status?(0===this.$el.find("#opt-in").length&&null===this.model.get("opt_in_for_challenge")&&this.model.get("opt_in")===!1&&this.$el.append("<div id='opt-in' class='banner mlT'>\n  <p style='text-align: right;'>Can "+this.companyName+" contact you for opportunities?&nbsp;\n    <input class=\"opt-in-radio hr-sleek-input\" id=\"custom-radio-id0\"  type='radio' name='opt_in' value='yes'>\n    <label style='display: inline;' for=\"custom-radio-id0\">\n      <span></span>\n      Yes\n    </label>&nbsp;&nbsp;&nbsp;\n    <input class=\"opt-in-radio hr-sleek-input\" id=\"custom-radio-id1\" type='radio' name='opt_in' value='no'>\n    <label style='display: inline;' for=\"custom-radio-id1\">\n      <span></span>\n      No\n    </label>\n  </p>\n</div>"),this):this},HackerCompanyOptInView.prototype.saveState=function(){var checkedVal;if(this.model.sync_status)return checkedVal=this.$('input[name="opt_in"]:checked').val(),"yes"===checkedVal?this.model.set("opt_in",!0):this.model.set("opt_in",!1),this.model.save({},{success:function(_this){return function(){return _this.$("#opt-in").html("<p>Great! You can always change your preferences in settings</p>"),_this.slideUpOptInBoxWithTimeout()}}(this)})},HackerCompanyOptInView.prototype.slideUpOptInBox=function(){return this.$("#opt-in").slideUp()},HackerCompanyOptInView.prototype.slideUpOptInBoxWithTimeout=function(){return setTimeout(function(_this){return function(){return _this.slideUpOptInBox()}}(this),5e3)},HackerCompanyOptInView.prototype.autoSelect=function(){return this.model.set("opt_in",!1),this.model.save({},{success:function(_this){return function(){return _this.$("#opt-in").slideUp()}}(this)})},HackerCompanyOptInView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.HackerCompanyOptInView=HackerCompanyOptInView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var DataSetsUploadView,HR;return DataSetsUploadView=function(superClass){function DataSetsUploadView(){return DataSetsUploadView.__super__.constructor.apply(this,arguments)}return extend(DataSetsUploadView,superClass),DataSetsUploadView.prototype.template="data-sets-upload",DataSetsUploadView.prototype.className="data-sets-upload-view",DataSetsUploadView.prototype.initialize=function(options){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.parent=options.parent},DataSetsUploadView.prototype.render=function(){return this.model.sync_status?(this.hacker=HR.profile(),this.hacker.isLoggedIn()?(this.contest||(this.contest=HR.contest()),this.data_set_file_submissions||(this.data_set_file_submissions=new HR.DataSetFileSubmissionsCollection,this.data_set_file_submissions.set_challenge_slug(this.model.get("slug")),this.data_set_file_submissions.set_contest_slug(this.contest.get("slug")),this.data_set_file_submissions.fetch(),this.listenTo(this.data_set_file_submissions,"sync",this.render)),this.data_set_file_submissions.sync_status?($(this.el).html(HR.appController.template(this.template,this)()),this.data_sets||(this.data_sets=this.model.get_data_sets(),this.listenTo(this.data_sets,"change",this.render),this.listenTo(this.data_sets,"reset",this.render)),this.dataSets=$(),this.dataSetListViews&&this.dataSetListViews.length>0&&this.destroyDataSetListViews(),this.dataSetListViews=[],$("div#datasets-upload-wrapper").html(),_.each(this.data_sets.models,function(babe){var _view;return _view=new HR.DataSetUploadListView({model:babe,challenge:this.model,data_set_file_submissions:this.data_set_file_submissions,parent:this}),this.dataSets.push(_view.render().el),this.dataSetListViews.push(_view)},this),$(this.el).find("div#datasets-upload-wrapper").append(this.dataSets),this):($(this.el).html("<div class='row'> <div class='span1'>&nbsp</div> <div class='gray light-wrap span8 mlB'>Loading user data</div> </div>"),this)):(this.listenTo(this.hacker,"change",this.render),this.listenTo(this.hacker,"reset",this.render),$(this.el).html("<div class='row'> <div class='span1'>&nbsp</div> <div class='gray light-wrap span8 mlB'>Please login in order to upload your solutions</div> </div>"),this)):this},DataSetsUploadView.prototype.destroyDataSetListViews=function(){return this.dataSetListViews||(this.dataSetListViews=[]),_.each(this.dataSetListViews,function(_view){return _view.destroy()}),this.dataSetListViews=[]},DataSetsUploadView.prototype.destroy=function(){return this.destroyDataSetListViews(),DataSetsUploadView.__super__.destroy.call(this)},DataSetsUploadView}(window.HR.GenericView),HR=window.HR||{},HR.DataSetsUploadView=DataSetsUploadView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var DataSetUploadListView,HR;return DataSetUploadListView=function(superClass){function DataSetUploadListView(){return DataSetUploadListView.__super__.constructor.apply(this,arguments)}return extend(DataSetUploadListView,superClass),DataSetUploadListView.prototype.template="data-set-upload-list",DataSetUploadListView.prototype.className="data-set-upload-list-view",DataSetUploadListView.prototype.initialize=function(options){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.challenge=options.challenge,this.listenTo(this.challenge,"change",this.render),this.listenTo(this.challenge,"reset",this.render),this.parent=options.parent,this.data_set_file_submissions=options.data_set_file_submissions},DataSetUploadListView.prototype.render=function(){return this.challenge.sync_status?($(this.el).html(HR.appController.template(this.template,this)({model:this.model,_model:this.model.toJSON(),challenge:this.challenge,_challenge:this.challenge.toJSON()})),this.data_set_files||(this.data_set_files=this.model.get_data_set_files(),this.listenTo(this.data_set_files,"change",this.render),this.listenTo(this.data_set_files,"reset",this.render)),this.dataSetFiles=$(),this.dataSetFileListViews&&this.dataSetFileListViews.length>0&&this.destroyDataSetFileListViews(),this.dataSetFileListViews=[],$("div#datasets-upload-wrapper").html(),_.each(this.data_set_files.models,function(babe){var _view;return _view=new HR.DataSetFileUploadListView({model:babe,dataset:this.model,challenge:this.challenge,data_set_file_submissions:this.data_set_file_submissions,parent:this}),this.dataSetFiles.push(_view.render().el),this.dataSetFileListViews.push(_view)},this),$(this.el).find("div#data-set-files-wrapper").append(this.dataSetFiles),this):this},DataSetUploadListView.prototype.destroyDataSetFileListViews=function(){return this.dataSetFileListViews||(this.dataSetFileListViews=[]),_.each(this.dataSetFileListViews,function(_view){return _view.destroy()}),this.dataSetFileListViews=[]},DataSetUploadListView.prototype.destroy=function(){return this.destroyDataSetFileListViews(),DataSetUploadListView.__super__.destroy.call(this)},DataSetUploadListView}(window.HR.GenericView),HR=window.HR||{},HR.DataSetUploadListView=DataSetUploadListView})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var DataSetFileUploadListView,HR;return DataSetFileUploadListView=function(superClass){function DataSetFileUploadListView(){return this.poll=bind(this.poll,this),DataSetFileUploadListView.__super__.constructor.apply(this,arguments)}return extend(DataSetFileUploadListView,superClass),DataSetFileUploadListView.prototype.template="data-set-file-upload-list",DataSetFileUploadListView.prototype.className="data-set-file-upload-list-view",DataSetFileUploadListView.prototype.events={"click .js_upload":"uploadSubmissionPrompt","change .js_payload":"uploadSubmission","click .js_delete":"deleteSubmission","click .js_download":"downloadSubmission"},DataSetFileUploadListView.prototype.initialize=function(options){return this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"reset",this.render),this.dataset=options.dataset,this.listenTo(this.dataset,"change",this.render),this.listenTo(this.dataset,"reset",this.render),this.challenge=options.challenge,this.listenTo(this.challenge,"change",this.render),this.listenTo(this.challenge,"reset",this.render),this.parent=options.parent,this.data_set_file_submissions=options.data_set_file_submissions},DataSetFileUploadListView.prototype.render=function(){return this.challenge.sync_status?(this.data_set_file_submission=this.get_data_set_file_submission(),$(this.el).html(HR.appController.template(this.template,this)({model:this.model,_model:this.model.toJSON(),dataset:this.dataset,_dataset:this.dataset.toJSON(),challenge:this.challenge,_challenge:this.challenge.toJSON(),data_set_file_submission:this.data_set_file_submission})),this._tpoll(),this):this},DataSetFileUploadListView.prototype._tpoll=function(){return this.tpoll?void 0:(this.tpoll=_.throttle(this.poll,1e3),this.tpoll())},DataSetFileUploadListView.prototype.poll=function(){var that;return this.data_set_file_submission&&this.data_set_file_submission.get("validation_status")>0&&this.data_set_file_submission.get("validation_status")<3&&!this.polling?this.$(".row").offset()&&this.$(".row").offset().top?(this.polling=!0,that=this,$.ajax({url:this.data_set_file_submission.url(),type:"GET",success:function(data){return that.polling=!1,data&&data.status&&data.model&&data.model.validation_status&&data.model.validation_status>0&&data.model.validation_status<3?setTimeout(function(){return that.tpoll()},1500):data&&data.status&&data.model&&data.model.validation_status&&data.model.validation_status>=3?that.update_validation_status(data.model.validation_status):data&&data.status&&data.model&&0===data.model.validation_status?that.update_validation_status(data.model.validation_status):void 0},error:function(){return that.polling=!1}})):(that=this,setTimeout(function(){return that.tpoll()},1500),void 0):void 0},DataSetFileUploadListView.prototype.update_validation_status=function(status){return this.data_set_file_submission=this.get_data_set_file_submission(),this.data_set_file_submission.get_validation_status(status)?(this.$(".js_validation_status").show(),this.$(".js_validation_status").css("color",this.data_set_file_submission.get_validation_status_color(status)),this.$(".js_validation_status").html(this.data_set_file_submission.get_validation_status(status))):this.$(".js_validation_status").hide()},DataSetFileUploadListView.prototype.get_data_set_file_submission=function(){var challenge_id,contest,data_set_file_submission,dataset_file_id,dataset_id;return challenge_id=this.challenge.get("id"),dataset_id=this.dataset.get("id"),dataset_file_id=this.model.get("id"),contest=HR.contest(),data_set_file_submission=_.first(_.filter(this.data_set_file_submissions.models,function(data_set_file_submission){return data_set_file_submission.get("challenge_id")===challenge_id&&data_set_file_submission.get("data_set_id")===dataset_id&&data_set_file_submission.get("data_set_file_id")===dataset_file_id})),data_set_file_submission&&(data_set_file_submission.set_challenge_slug(this.challenge.get("slug")),data_set_file_submission.set_contest_slug(contest.get("slug"))),data_set_file_submission},DataSetFileUploadListView.prototype.uploadSubmissionPrompt=function(){return this.$(".js_payload").click()},DataSetFileUploadListView.prototype.uploadSubmission=function(e){var data_set_file_submission,file,files,formData,that;return files=$(e.currentTarget).get(0).files,0===files.length||this.$(".js_upload").hasClass("disabled")?void 0:(file=files[0],file.size>this.model.get("upload_limit")?alert("Please upload a file smaller than "+this.model.get("human_readable_upload_limit")):(this.$(".js_upload").addClass("disabled"),this.$(".js_label").html(file.name).show(),this.$(".js_uploading").show(),that=this,data_set_file_submission=this.get_sample_data_set_file_submission(),formData=new FormData(this.$("form").get(0)),$.ajax({url:data_set_file_submission.url().split("?")[0],type:"POST",data:formData,cache:!1,contentType:!1,processData:!1,success:function(response){return that.resetUploadInputBox(),that.$(".js_uploading").hide(),that.$(".js_upload").removeClass("disabled"),response.status?(that.$(".js_upload").hide(),that.$(".js_download").show(),that.$(".js_delete").show(),that.$(".js_label").html(response.model.file_name+" &nbsp;&nbsp;&nbsp;("+response.model.human_readable_file_size+")").show(),that.data_set_file_submissions.add([new HR.DataSetFileSubmissionModel(response.model)],{silent:!0}),that.update_validation_status(response.model.validation_status),that.tpoll()):(that.$(".js_label").hide(),alert(response.message||"Error occured! Please try again"))},error:function(){return that.resetUploadInputBox(),that.$(".js_uploading").hide(),that.$(".js_upload").removeClass("disabled"),that.$(".js_label").hide(),alert("Error occured! Please try again")}})))},DataSetFileUploadListView.prototype.resetUploadInputBox=function(){return this.$("form.js_playload_wrap input[type=file]").unbind().remove(),this.$("form.js_playload_wrap").prepend('<input type="file" class="hide js_payload" name="payload">'),this.delegateEvents()},DataSetFileUploadListView.prototype.downloadSubmission=function(){return window.open(this.get_data_set_file_submission().url().split("?").join("/download?"),"_blank")},DataSetFileUploadListView.prototype.get_sample_data_set_file_submission=function(){var contest,data_set_file_submission,that;return that=this,contest=HR.contest(),data_set_file_submission=new HR.DataSetFileSubmissionModel({data_set_id:this.dataset.get("id"),data_set_file_id:this.model.get("id")}),data_set_file_submission.set_challenge_slug(this.challenge.get("slug")),data_set_file_submission.set_contest_slug(contest.get("slug")),data_set_file_submission},DataSetFileUploadListView.prototype.deleteSubmission=function(e){var challenge,contest,that;if(!$(e.currentTarget).hasClass("disabled"))return $(e.currentTarget).addClass("disabled"),this.$(".js_removing").show(),contest=HR.contest(),challenge=this.challenge,that=this,this.data_set_file_submission=this.get_data_set_file_submission(),this.data_set_file_submission.set_challenge_slug(this.challenge.get("slug")),this.data_set_file_submission.set_contest_slug(contest.get("slug")),this.data_set_file_submission.destroy({success:function(){return that.$(".js_upload").show(),that.$(".js_removing").hide(),that.$(".js_download").hide(),that.$(".js_delete").hide(),that.$(".js_label").hide(),that.data_set_file_submissions.remove([this.data_set_file_submission],{silent:!0}),that.$(".js_validation_status").hide(),$(e.currentTarget).removeClass("disabled")},error:function(){return that.$(".js_removing").hide(),$(e.currentTarget).removeClass("disabled"),alert("Error occured! Please try again")}})},DataSetFileUploadListView}(window.HR.GenericView),HR=window.HR||{},HR.DataSetFileUploadListView=DataSetFileUploadListView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,SubmissionResponseView;return SubmissionResponseView=function(superClass){function SubmissionResponseView(){return SubmissionResponseView.__super__.constructor.apply(this,arguments)}return extend(SubmissionResponseView,superClass),SubmissionResponseView.prototype.template="submission-response",SubmissionResponseView.prototype.className="submission-response-view",SubmissionResponseView.prototype.initialize=function(options){return this.parent=options.parent,this.challenge=options.challenge,this.contest_score=options.contest_score,this.storeOldScores(),this.model.fetch()},SubmissionResponseView.prototype.render=function(){return $(this.el).html(HR.appController.template(this.template,this)),this.renderSubViews(),this},SubmissionResponseView.prototype.renderSubViews=function(){return this.stats_view||(this.stats_view=new HR.SubmissionStatsView({parent:this,hide_score:!0,enable_theatrics:this.enableTheatrics(),in_challenge_view:!0}),this.add_subview(this.stats_view)),this.stats_view.setModel(this.model),this.assign({"#submission-stats-container":this.stats_view}),this.score_view||(this.score_view=new HR.SubmissionScoreView({parent:this,model:this.model,old_challenge_score:this.old_challenge_score,old_domain_score:this.old_domain_score,contest_score:this.contest_score}),this.add_subview(this.score_view)),this.assign({"#submission-score-container":this.score_view}),this.delegateEvents(),this},SubmissionResponseView.prototype.enableTheatrics=function(){return this.model.isInMaster()?!0:!1},SubmissionResponseView.prototype.storeOldScores=function(){var track;return this.old_challenge_score=this.challenge.get("user_score")||0,track=this.challenge.get("track"),this.old_domain_score=track?track.domain_score||0:0},SubmissionResponseView}(window.HR.GenericView),HR=window.HR||{},HR.SubmissionResponseView=SubmissionResponseView})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,SubmissionStatsView,ref;return SubmissionStatsView=function(superClass){function SubmissionStatsView(){return SubmissionStatsView.__super__.constructor.apply(this,arguments)}return extend(SubmissionStatsView,superClass),SubmissionStatsView.prototype.template="submission-stats",SubmissionStatsView.prototype.className="submission-stats-view",SubmissionStatsView.prototype.events={"click a.js-download-test-case":"promptDialog"},SubmissionStatsView.prototype.initialize=function(options){return $(".change-filter").live("click",this.updateSelect),this.parent=options.parent,this.hide_score=options.hide_score||!1,this.enable_theatrics=options.enable_theatrics||!1,this.in_challenge_view=options.in_challenge_view||!1,this.time_factor=1,this.revealed_count=0,this.render()},SubmissionStatsView.prototype.setModel=function(model){return this.model&&(this.model.unbind("change"),this.model.unbind("render")),this.model=model,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"render",this.render),this.render()},SubmissionStatsView.prototype.updateSelect=function(e){var src;return e.preventDefault(),src=$(e.target),$("#selected-filter span.select").html(src.text())},SubmissionStatsView.prototype.render=function(){var live_status_limit,that;return this.model?(0===this.model.get("game_total")&&this.model.set("percent",0),that=this,live_status_limit=this.liveStatusLimit(),HR.requires(["compound/game-views"],function(){var custom_player,data,init;if(custom_player=HR.GameView.prototype.custom_player_count(),$(that.el).html(HR.appController.template(that.template,that)({model:that.model.toJSON(),score_factor:that.parent.challenge.get("factor"),singlePlayer:!!custom_player[that.model.get("codechecker_handle")],hide_score:that.hide_score,checker_processed:that.model.checker_processed(),display_status:that.displayStatus(live_status_limit),live_status:that.model.live_status,live_status_limit:live_status_limit,enable_theatrics:that.enable_theatrics,all_processed:that.allProcessed(live_status_limit),test_case_string:that.freeTestCaseString(live_status_limit),total_test_case_count:that.totalTestCaseCount()})),"game"===that.model.get("kind")){switch(data=[{id:0,text:"All "+that.model.get("game_played")+" Games Played",slug:"all"},{id:1,text:that.model.get("game_won")+" Games Won",slug:"won"},{id:2,text:that.model.get("game_lost")+" Games Lost",slug:"lost"},{id:3,text:that.model.get("game_mid_range")+" Games Tied",slug:"tied"}],init=0,that.model.get("filter")){case"won":init=1;break;case"lost":init=2;break;case"tied":init=3}return $("#submissions-filter").select2({data:data,width:"off"}),$("#submissions-filter").select2("data",data[init]),$("#submissions-filter").bind("change",function(){return Backbone.history.navigate(HR.appController.get_current_contest_namespace()+"/challenges/"+that.parent.model.get("challenge_slug")+"/submissions/game/"+that.model.get("id")+"/"+$("#submissions-filter").select2("data").slug,!0)})}}),this.checkRemaining(live_status_limit),this.scrollToFocus(),this.delegateEvents(),this):void 0},SubmissionStatsView.prototype.promptDialog=function(e){var _model,testcaseIndex,that,url;return e.preventDefault(),testcaseIndex=$(e.target).attr("testcase-num"),that=this,_model=this.model.toJSON(),url="/rest/contests/"+that.contestSlug()+"/testcases/"+_model.challenge_id+"/"+testcaseIndex+"/permission",this.enable_theatrics&&(url+="?submission_id="+this.model.get("id")),$.ajax({url:url,type:"GET",success:function(data){return data.permission===!0?that.renderDownloadTestCase(testcaseIndex):data.permission===!1?that.renderPurchaseTestCase(testcaseIndex,data.cost):void 0}})},SubmissionStatsView.prototype.renderPurchaseTestCase=function(index,cost){var _model,data,dialog_options,hacko_cost,that;return null==cost&&(cost=null),that=this,_model=this.model.toJSON(),data={},this.enable_theatrics&&(data.submission_id=this.model.get("id")),hacko_cost=null!==cost?0===cost?"free":cost+" hackos":"5 hackos",dialog_options={title:"Purchase TestCase",body:"<center><p> Do you wish to purchase test case #"+index+" of "+_model.name+" for "+hacko_cost+"?</p> <p class='block-center'><a href='#' class='btn btn-primary js-buy-test-case' data-analytics='Confirm Purchase Testcase'>Yes</a>&nbsp;&nbsp;&nbsp; <a href='#' class='btn btn-primary js-dont-buy' data-analytics='Cancel Purchase Testcase'>No</a></p> <div class='formgroup clearfix m'> <div class='alert error hide'></div> </div>",events:{"click a.js-buy-test-case":function(_this){return function(e){var current_text;return e.preventDefault(),"disabled"!==$(e.currentTarget).attr("disabled")?(current_text=$(e.currentTarget).html(),$(e.currentTarget).html("Buying testcases..."),$(e.currentTarget).attr("disabled","disabled"),that=_this,$.ajax({url:"/rest/contests/"+that.contestSlug()+"/testcases/"+_model.challenge_id+"/"+index+"/purchase",type:"POST",data:data,beforeSend:function(xhr){return xhr.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))
},success:function(data){return that.dialog.destroy(),that.renderDownloadTestCase(index),HR.profile().set("hacko_amount",data.hacko_amount)},error:function(){return $(".alert.error").show().html("Insufficient Hackos"),$(e.currentTarget).html(current_text),$(e.currentTarget).removeAttr("disabled")}})):void 0}}(this),"click a.js-dont-buy":function(_this){return function(e){return e.preventDefault(),_this.dialog.destroy()}}(this)}},this.dialog=new HR.util.ShowDialog(dialog_options),this.dialog.render()},SubmissionStatsView.prototype.renderDownloadTestCase=function(index){var _model,dialog_options,that;return that=this,_model=this.model.toJSON(),dialog_options={title:"Download TestCase #"+index,body:"<center><p> Download Test Case #"+index+" of "+_model.name+"</p> <p class='block-center'><a href='#' class='btn btn-primary js-download-test-case' command='testcaseinput' data-analytics='Download Input'>Input</a>&nbsp;&nbsp;&nbsp; <a href='#' class='btn btn-primary js-download-test-case' command='testcaseoutput' data-analytics='Download Output'>Output</a></p> <div class='formgroup clearfix m'> <div class='alert error hide'></div> </div>",events:{"click a.js-download-test-case":function(){return function(e){var command;return command=$(e.target).attr("command"),e.preventDefault(),window.open("/rest/contests/"+that.contestSlug()+"/testcases/"+_model.challenge_id+"/"+index+"/"+command,"_blank")}}(this)}},this.dialog=new HR.util.ShowDialog(dialog_options),this.dialog.render()},SubmissionStatsView.prototype.contestSlug=function(){return this.model.get("contest_slug")},SubmissionStatsView.prototype.displayStatus=function(live_status_limit){return this.enable_theatrics?this.allProcessed(live_status_limit)?this.model.get("status"):this.model.get("status").startsWith("Running")||this.model.checker_processed()?"Running testcases":this.model.get("status"):this.model.get("status")},SubmissionStatsView.prototype.liveStatusLimit=function(){return this.enable_theatrics?(this.updateRevealedCount(),this.revealed_count):this.model.totalCases()},SubmissionStatsView.prototype.recordFirstResponseTime=function(){return this.first_response_time?void 0:this.first_response_time=Date.now()},SubmissionStatsView.prototype.recordCheckerProcessedTime=function(){return this.checker_processed_time?void 0:this.checker_processed_time=Date.now()},SubmissionStatsView.prototype.checkRemaining=function(live_status_limit){if(live_status_limit<this.model.totalCases()){if(!this.enable_theatrics||this.canStartTestCaseDisplay())return setTimeout(function(_this){return function(){return _this.render()}}(this),1e3*this.time_factor)}else if(this.model.score_processed()&&this.model.checker_processed())return this.model.trigger("animateScores")},SubmissionStatsView.prototype.updateRevealedCount=function(){return _.throttle(function(_this){return function(){var drip_count,new_revelations;return drip_count=_this.model.totalCases()/8,_this.canStartTestCaseDisplay()?(new_revelations=Math.round(Math.random()*drip_count+1),1>new_revelations&&(new_revelations=1),_this.revealed_count+=new_revelations):void 0}}(this),1e3*this.time_factor)()},SubmissionStatsView.prototype.canStartTestCaseDisplay=function(){return 2===this.model.getDisplayVersion()||this.model.checker_processed()},SubmissionStatsView.prototype.allProcessed=function(live_status_limit){return this.model.checker_processed()&&this.model.score_processed()&&live_status_limit>=this.model.totalCases()},SubmissionStatsView.prototype.freeTestCaseString=function(live_status_limit){var test_case_names;return null==this.model.get("free_test_cases")?"":!this.allProcessed(live_status_limit)||this.model.get("free_test_cases").length<1?"":(test_case_names=this.model.get("free_test_cases").map(function(tcno){return"<a href='#' class='js-download-test-case' testcase-num='"+tcno+"'> Test Case #"+tcno+"</a>"}),1===test_case_names.length?test_case_names[0]:test_case_names.slice(0,test_case_names.length-1).join(", ")+" and "+test_case_names[test_case_names.length-1])},SubmissionStatsView.prototype.scrollToFocus=function(){var $stats_container,sample_testcases;return this.in_challenge_view&&(sample_testcases=this.model.get("is_sample_testcase"),typeof sample_testcases==typeof[]&&sample_testcases.length>0&&"Queued"!==this.model.get("status")&&!this.scrolled&&($stats_container=this.$("#submission-stats-content"),$stats_container.length>0))?(this.scrolled=!0,$("html,body").animate({scrollTop:$stats_container.offset().top},"slow")):void 0},SubmissionStatsView.prototype.adjustCss=function(){return _.throttle(function(_this){return function(){var parent_width;return parent_width=$(".right-sidebar .testcases-results").width(),parent_width>750?_this.changeColumnCount(3):parent_width>500?_this.changeColumnCount(2):_this.changeColumnCount(1)}}(this),500)()},SubmissionStatsView.prototype.changeColumnCount=function(count){var $tc_results;return null==count&&(count=3),$tc_results=$(".right-sidebar .testcases-results"),$tc_results.css("-webkit-column-count",""+count),$tc_results.css("-moz-column-count",""+count),$tc_results.css("column-count",""+count)},SubmissionStatsView.prototype.totalTestCaseCount=function(){return this.model.checker_processed()?null!=this.model.get("testcase_status")?this.model.get("testcase_status").length:0:this.model.get("is_sample_testcase").length},SubmissionStatsView}(window.HR.GenericView),HR=null!=(ref=window.HR)?ref:{},HR.SubmissionStatsView=SubmissionStatsView})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;jQuery(function(){var HR,SubmissionScoreView;return SubmissionScoreView=function(superClass){function SubmissionScoreView(){return this.toggleGreen=bind(this.toggleGreen,this),SubmissionScoreView.__super__.constructor.apply(this,arguments)}return extend(SubmissionScoreView,superClass),SubmissionScoreView.prototype.template="submission-score",SubmissionScoreView.prototype.className="submission-score-view",SubmissionScoreView.prototype.initialize=function(options){return this.old_challenge_score=parseFloat(options.old_challenge_score),this.old_domain_score=parseInt(options.old_domain_score),this.old_contest_score=options.contest_score,this.challenge_score=this.old_challenge_score,this.domain_score=this.old_domain_score,this.contest_score=this.old_contest_score,this.hide_score_view=!0,this.disable_scores=!0,this.listenTo(this.model,"animateScores",this.showScoreView)},SubmissionScoreView.prototype.events={"hover .after-submission-link":"toggleGreen"},SubmissionScoreView.prototype.render=function(){return $(this.el).html(HR.appController.template(this.template,this)({old_challenge_score:this.challenge_score.round(2),total_score:this.totalScore(),hide_score_view:this.hide_score_view,disable_scores:this.disable_scores})),this.delegateEvents(),this},SubmissionScoreView.prototype.showScoreView=function(){var $score_container,that;return this.score_view_displayed?void 0:(this.score_view_displayed=!0,this.hide_score_view=!1,$score_container=this.$("#submission-score-container-inner"),that=this,$score_container.length>0&&$score_container.slideDown(1500,function(){return $("html,body").animate({scrollTop:$score_container.offset().top},"slow").promise().done(function(){return that.animateScores()})}),this.showAfterSubmissionLinks())},SubmissionScoreView.prototype.showAfterSubmissionLinks=function(){return this.next_challenge_slug=this.model.get("next_challenge_slug"),this.random_challenge_slug=this.model.get("random_challenge_slug"),this.namespace=HR.appController.get_current_contest_namespace(),this.random_challenge_link=this.namespace+"/challenges/"+this.random_challenge_slug,this.next_challenge_link=this.namespace+"/challenges/"+this.next_challenge_slug,this.next_challenge_slug&&!this.random_challenge_slug?($("#right-button").attr("href",this.next_challenge_link),$("#right-button").text("Next Challenge"),$("#left-button").hide()):!this.next_challenge_slug&&this.random_challenge_slug?($("#right-button").attr("href",this.random_challenge_link),$("#right-button").text("Random Challenge"),$("#left-button").hide()):this.next_challenge_slug&&this.random_challenge_slug?($("#left-button").attr("href",this.next_challenge_link),$("#left-button").text("Next Challenge"),$("#right-button").attr("href",this.random_challenge_link),$("#right-button").text("Random Challenge")):$(".after-submission-link").parent().hide()},SubmissionScoreView.prototype.toggleGreen=function(e){return $(e.currentTarget).toggleClass("btn-green")},SubmissionScoreView.prototype.animateScores=function(){return this.score_animated?void 0:(this.score_animated=!0,this.disable_scores=!1,this.score_increase=parseFloat(this.model.get("display_score")||0)-this.challenge_score,this.score_increase<0&&(this.score_increase=0),this.$("#problem-score-container").removeClass("disabled"),this.animateProblemScore(this.score_increase))},SubmissionScoreView.prototype.animateProblemScore=function(diff){var ps_count;return diff>0?(this.challenge_score+=.1,this.$("#problem-score-counter span").html(""+this.challenge_score.round(2)),setTimeout(function(_this){return function(){return _this.animateProblemScore(diff-.1)}}(this),5)):(0>=diff&&(this.challenge_score=parseFloat(this.model.get("display_score")),this.$("#problem-score-counter span").html(""+this.challenge_score.round(2)),ps_count=this.$("#problem-score-counter sup"),ps_count.html("+"+this.score_increase),ps_count.fadeOut(8e3)),this.$("#domain-score-container").removeClass("disabled"),this.total_score_increase=2===this.model.get("status_code")?this.score_increase:0,this.animateTotalScore(this.total_score_increase))},SubmissionScoreView.prototype.animateTotalScore=function(diff){var ds_count;return diff>0?(this.model.isInMaster()?(this.domain_score+=1,setTimeout(function(_this){return function(){return _this.animateTotalScore(diff-1)}}(this),50)):(this.contest_score+=.1,setTimeout(function(_this){return function(){return _this.animateTotalScore(diff-.1)}}(this),5)),this.$("#domain-score-counter span").html(""+this.totalScore())):0>=diff?(this.model.isInMaster()?this.domain_score=this.old_domain_score+this.total_score_increase:this.contest_score=this.old_contest_score+this.total_score_increase,this.$("#domain-score-counter span").html(""+this.totalScore()),ds_count=this.$("#domain-score-counter sup"),ds_count.html("+"+this.total_score_increase),ds_count.fadeOut(8e3)):void 0},SubmissionScoreView.prototype.totalScore=function(){return this.model.isInMaster()?HR.util.formatNumber(parseInt(this.domain_score)):this.contest_score.round(2)},SubmissionScoreView}(window.HR.GenericView),HR=window.HR||{},HR.SubmissionScoreView=SubmissionScoreView})}.call(this);